/**-----------------------------------------------------------------------------------------
* Copyright © 2021 Progress Software Corporation. All rights reserved.
* Licensed under commercial license. See LICENSE.md in the project root for more information
*-------------------------------------------------------------------------------------------*/
import { __decorate, __metadata, __param } from 'tslib';
import { EventEmitter, TemplateRef, Input, Output, HostBinding, Component, ElementRef, InjectionToken, Inject, Optional, NgZone, ContentChildren, QueryList, ViewChild, HostListener, Renderer2, ChangeDetectorRef, Injectable, isDevMode, ComponentFactoryResolver, Directive, Host, ContentChild, ViewChildren, ViewContainerRef, forwardRef, NgModule } from '@angular/core';
import { trigger, state, style, transition, animate } from '@angular/animations';
import { LocalizationService, L10N_PREFIX, RTL, MessageService, ComponentMessages } from '@progress/kendo-angular-l10n';
import { take, filter, map, share, tap, switchMap, takeUntil } from 'rxjs/operators';
import { validatePackage } from '@progress/kendo-licensing';
import { Subject, merge, Subscription, of } from 'rxjs';
import { DraggableDirective, isChanged, isDocumentAvailable, DraggableModule } from '@progress/kendo-angular-common';
import { offset, scrollPosition, positionWithScroll, getDocumentElement, getWindowViewPort } from '@progress/kendo-popup-common';
import { Button } from '@progress/kendo-angular-buttons';
import { CommonModule } from '@angular/common';

/**
 * Specifies the action buttons of the Dialog
 * ([see example]({% slug actionbuttons_dialog %})).
 */
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@angular/common';
import * as ɵngcc2 from '@progress/kendo-angular-l10n';
import * as ɵngcc3 from '@progress/kendo-angular-common';

function DialogActionsComponent_ng_content_0_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵprojection(0, 0, ["*ngIf", "!actions"]);
} }
function DialogActionsComponent_ng_container_1_button_1_Template(rf, ctx) { if (rf & 1) {
    const _r6 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 2);
    ɵngcc0.ɵɵlistener("click", function DialogActionsComponent_ng_container_1_button_1_Template_button_click_0_listener($event) { const restoredCtx = ɵngcc0.ɵɵrestoreView(_r6); const action_r4 = restoredCtx.$implicit; const ctx_r5 = ɵngcc0.ɵɵnextContext(2); return ctx_r5.onButtonClick(action_r4, $event); });
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const action_r4 = ctx.$implicit;
    const ctx_r3 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵproperty("ngClass", ctx_r3.buttonClass(action_r4));
    ɵngcc0.ɵɵattribute("aria-label", action_r4.text);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", action_r4.text, " ");
} }
function DialogActionsComponent_ng_container_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵtemplate(1, DialogActionsComponent_ng_container_1_button_1_Template, 2, 3, "button", 1);
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    const ctx_r1 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngForOf", ctx_r1.actions);
} }
function DialogActionsComponent_2_ng_template_0_Template(rf, ctx) { }
function DialogActionsComponent_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, DialogActionsComponent_2_ng_template_0_Template, 0, 0, "ng-template", 3);
} if (rf & 2) {
    const ctx_r2 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("ngTemplateOutlet", ctx_r2.actions);
} }
const _c0 = ["*"];
function DialogComponent_kendo_dialog_titlebar_3_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "kendo-dialog-titlebar", 7);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("closeTitle", ctx_r0.closeTitle)("id", ctx_r0.titleId);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(ctx_r0.title);
} }
function DialogComponent_ng_content_4_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵprojection(0, 0, ["*ngIf", "!title"]);
} }
function DialogComponent_ng_content_6_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵprojection(0, 1, ["*ngIf", "!contentTemplate"]);
} }
function DialogComponent_7_ng_template_0_Template(rf, ctx) { }
function DialogComponent_7_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, DialogComponent_7_ng_template_0_Template, 0, 0, "ng-template", 8);
} if (rf & 2) {
    const ctx_r3 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("ngTemplateOutlet", ctx_r3.contentTemplate);
} }
function DialogComponent_ng_content_8_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵprojection(0, 2, ["*ngIf", "!actions"]);
} }
function DialogComponent_kendo_dialog_actions_9_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "kendo-dialog-actions", 9);
} if (rf & 2) {
    const ctx_r5 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("actions", ctx_r5.actions)("layout", ctx_r5.actionsLayout);
} }
const _c5 = [[["kendo-dialog-titlebar"]], "*", [["kendo-dialog-actions"]]];
const _c6 = ["kendo-dialog-titlebar", "*", "kendo-dialog-actions"];
function WindowTitleBarComponent_ng_content_0_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵprojection(0, 0, ["*ngIf", "!template"]);
} }
function WindowTitleBarComponent_1_ng_template_0_Template(rf, ctx) { }
const _c7 = function (a0) { return { "$implicit": a0 }; };
function WindowTitleBarComponent_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, WindowTitleBarComponent_1_ng_template_0_Template, 0, 0, "ng-template", 1);
} if (rf & 2) {
    const ctx_r1 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("ngTemplateOutlet", ctx_r1.template)("ngTemplateOutletContext", ɵngcc0.ɵɵpureFunction1(2, _c7, ctx_r1.service));
} }
function WindowComponent_kendo_window_titlebar_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "kendo-window-titlebar", 5);
    ɵngcc0.ɵɵelementStart(1, "div", 6);
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(3, "div", 7);
    ɵngcc0.ɵɵelement(4, "button", 8);
    ɵngcc0.ɵɵelement(5, "button", 9);
    ɵngcc0.ɵɵelement(6, "button", 10);
    ɵngcc0.ɵɵelement(7, "button", 11);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("template", ctx_r0.titleBarTemplate);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate(ctx_r0.title);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵattribute("title", ctx_r0.minimizeButtonTitle)("aria-label", ctx_r0.minimizeButtonTitle);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵattribute("title", ctx_r0.maximizeButtonTitle)("aria-label", ctx_r0.maximizeButtonTitle);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵattribute("title", ctx_r0.restoreButtonTitle)("aria-label", ctx_r0.restoreButtonTitle);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵattribute("title", ctx_r0.closeButtonTitle)("aria-label", ctx_r0.closeButtonTitle);
} }
function WindowComponent_ng_content_3_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵprojection(0, 0, ["*ngIf", "!showDefaultTitleBar"]);
} }
function WindowComponent_div_4_ng_content_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵprojection(0, 1, ["*ngIf", "!contentTemplate"]);
} }
function WindowComponent_div_4_2_ng_template_0_Template(rf, ctx) { }
function WindowComponent_div_4_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, WindowComponent_div_4_2_ng_template_0_Template, 0, 0, "ng-template", 13);
} if (rf & 2) {
    const ctx_r5 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵproperty("ngTemplateOutlet", ctx_r5.contentTemplate);
} }
function WindowComponent_div_4_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 12);
    ɵngcc0.ɵɵtemplate(1, WindowComponent_div_4_ng_content_1_Template, 1, 0, "ng-content", 2);
    ɵngcc0.ɵɵtemplate(2, WindowComponent_div_4_2_Template, 1, 1, undefined, 2);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r2 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("hidden", ctx_r2.state === "minimized" && ctx_r2.keepContent);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", !ctx_r2.contentTemplate);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r2.contentTemplate);
} }
function WindowComponent_ng_template_5_div_0_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "div", 15);
} if (rf & 2) {
    const dir_r8 = ctx.$implicit;
    ɵngcc0.ɵɵproperty("direction", dir_r8);
} }
function WindowComponent_ng_template_5_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, WindowComponent_ng_template_5_div_0_Template, 1, 1, "div", 14);
} if (rf & 2) {
    const ctx_r3 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("ngForOf", ctx_r3.resizeDirections);
} }
const _c16 = [[["kendo-window-titlebar"]], "*"];
const _c17 = ["kendo-window-titlebar", "*"];
let DialogActionsComponent = class DialogActionsComponent {
    constructor(el) {
        this.el = el;
        /**
         * Specifies the possible layout of the action buttons.
         */
        this.layout = 'stretched';
        /**
         * Fires when the user clicks an action button.
         */
        this.action = new EventEmitter();
        this.buttonGroupClassName = true;
    }
    get className() {
        return this.layout === 'stretched';
    }
    /**
     * @hidden
     */
    actionTemplate() {
        return this.actions instanceof TemplateRef;
    }
    /**
     * @hidden
     */
    onButtonClick(action, _e) {
        this.action.emit(action);
    }
    /**
     * @hidden
     */
    buttonClass(action) {
        const classes = ['k-button'];
        if (action.primary) {
            classes.push('k-primary');
        }
        return classes.join(' ');
    }
};
DialogActionsComponent.ɵfac = function DialogActionsComponent_Factory(t) { return new (t || DialogActionsComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef)); };
DialogActionsComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: DialogActionsComponent, selectors: [["kendo-dialog-actions"]], hostVars: 6, hostBindings: function DialogActionsComponent_HostBindings(rf, ctx) { if (rf & 2) {
        ɵngcc0.ɵɵclassProp("k-dialog-buttongroup", ctx.buttonGroupClassName)("k-actions", ctx.buttonGroupClassName)("k-actions-stretched", ctx.className);
    } }, inputs: { layout: "layout", actions: "actions" }, outputs: { action: "action" }, ngContentSelectors: _c0, decls: 3, vars: 3, consts: [[4, "ngIf"], ["type", "button", 3, "ngClass", "click", 4, "ngFor", "ngForOf"], ["type", "button", 3, "ngClass", "click"], [3, "ngTemplateOutlet"]], template: function DialogActionsComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵprojectionDef();
        ɵngcc0.ɵɵtemplate(0, DialogActionsComponent_ng_content_0_Template, 1, 0, "ng-content", 0);
        ɵngcc0.ɵɵtemplate(1, DialogActionsComponent_ng_container_1_Template, 2, 1, "ng-container", 0);
        ɵngcc0.ɵɵtemplate(2, DialogActionsComponent_2_Template, 1, 1, undefined, 0);
    } if (rf & 2) {
        ɵngcc0.ɵɵproperty("ngIf", !ctx.actions);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", !ctx.actionTemplate());
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.actionTemplate());
    } }, directives: [ɵngcc1.NgIf, ɵngcc1.NgForOf, ɵngcc1.NgClass, ɵngcc1.NgTemplateOutlet], encapsulation: 2 });
__decorate([
    Input(),
    __metadata("design:type", Object)
], DialogActionsComponent.prototype, "actions", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], DialogActionsComponent.prototype, "layout", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], DialogActionsComponent.prototype, "action", void 0);
__decorate([
    HostBinding('class.k-dialog-buttongroup'),
    HostBinding('class.k-actions'),
    __metadata("design:type", Boolean)
], DialogActionsComponent.prototype, "buttonGroupClassName", void 0);
__decorate([
    HostBinding('class.k-actions-stretched'),
    __metadata("design:type", Boolean),
    __metadata("design:paramtypes", [])
], DialogActionsComponent.prototype, "className", null);
DialogActionsComponent = __decorate([ __metadata("design:paramtypes", [ElementRef])
], DialogActionsComponent);

/**
 * @hidden
 */
class PreventableEvent {
    constructor() {
        this.prevented = false;
    }
    /**
     * Prevents the default action for a specified event.
     * In this way, the source component suppresses the built-in behavior that follows the event.
     */
    preventDefault() {
        this.prevented = true;
    }
    /**
     * If the event is prevented by any of its subscribers, returns `true`.
     *
     * @returns `true` if the default action was prevented. Otherwise, returns `false`.
     */
    isDefaultPrevented() {
        return this.prevented;
    }
}

/**
 * @hidden
 */
const DIALOG_LOCALIZATION_SERVICE = new InjectionToken('Dialog LocalizationService');

/**
 * @hidden
 */
let TitleBarLocalizationService = class TitleBarLocalizationService extends LocalizationService {
    constructor(prefix, messageService, rtl, dialogLocalization) {
        super(prefix, messageService, rtl);
        this.dialogLocalization = dialogLocalization;
    }
    get(shortKey) {
        if (this.dialogLocalization) {
            return this.dialogLocalization.get(shortKey);
        }
        return super.get(shortKey);
    }
};
TitleBarLocalizationService.ɵfac = function TitleBarLocalizationService_Factory(t) { return new (t || TitleBarLocalizationService)(ɵngcc0.ɵɵinject(L10N_PREFIX), ɵngcc0.ɵɵinject(ɵngcc2.MessageService, 8), ɵngcc0.ɵɵinject(RTL, 8), ɵngcc0.ɵɵinject(DIALOG_LOCALIZATION_SERVICE, 8)); };
TitleBarLocalizationService.ɵprov = /*@__PURE__*/ ɵngcc0.ɵɵdefineInjectable({ token: TitleBarLocalizationService, factory: function (t) { return TitleBarLocalizationService.ɵfac(t); } });
TitleBarLocalizationService = __decorate([
    __param(0, Inject(L10N_PREFIX)),
    __param(1, Optional()),
    __param(2, Optional()), __param(2, Inject(RTL)),
    __param(3, Optional()), __param(3, Inject(DIALOG_LOCALIZATION_SERVICE)),
    __metadata("design:paramtypes", [String, MessageService, Boolean, LocalizationService])
], TitleBarLocalizationService);

/**
 * Represents the [Kendo UI DialogTitleBar component for Angular]({% slug api_dialog_dialogtitlebarcomponent %}).
 *
 * It is used as part of the Dialog content when the component is created dynamically by using an [Angular service]({% slug service_dialog %}).
 */
let DialogTitleBarComponent = class DialogTitleBarComponent {
    constructor(zone, hostElement, localizationService) {
        this.zone = zone;
        this.hostElement = hostElement;
        this.localizationService = localizationService;
        /**
         * Fires when the close button of the title-bar is clicked.
         */
        this.close = new EventEmitter();
    }
    get className() {
        return true;
    }
    get closeButtonTitle() {
        return this.closeTitle || this.localizationService.get('closeTitle');
    }
    ngAfterViewInit() {
        this.zone.onStable.pipe(take(1)).subscribe(() => {
            const element = this.hostElement.nativeElement;
            element.setAttribute('id', this.id);
        });
    }
    /**
     * @hidden
     */
    onCloseClick(e) {
        e.preventDefault();
        const eventArgs = new PreventableEvent();
        this.close.emit(eventArgs);
    }
};
DialogTitleBarComponent.ɵfac = function DialogTitleBarComponent_Factory(t) { return new (t || DialogTitleBarComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.LocalizationService, 8)); };
DialogTitleBarComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: DialogTitleBarComponent, selectors: [["kendo-dialog-titlebar"]], hostVars: 4, hostBindings: function DialogTitleBarComponent_HostBindings(rf, ctx) { if (rf & 2) {
        ɵngcc0.ɵɵclassProp("k-window-titlebar", ctx.className)("k-dialog-titlebar", ctx.className);
    } }, inputs: { id: "id", closeTitle: "closeTitle" }, outputs: { close: "close" }, features: [ɵngcc0.ɵɵProvidersFeature([
            TitleBarLocalizationService,
            {
                provide: LocalizationService,
                useExisting: TitleBarLocalizationService
            },
            {
                provide: L10N_PREFIX,
                useValue: 'kendo.dialog'
            }
        ])], ngContentSelectors: _c0, decls: 6, vars: 2, consts: function () { let i18n_1; if (typeof ngI18nClosureMode !== "undefined" && ngI18nClosureMode) {
        /**
         * @desc The title of the close button
         * @meaning kendo.dialog.closeTitle
         */
        const MSG_EXTERNAL_7499923323865444383$$DIST_FESM2015_INDEX_JS_2 = goog.getMsg("Close");
        i18n_1 = MSG_EXTERNAL_7499923323865444383$$DIST_FESM2015_INDEX_JS_2;
    }
    else {
        i18n_1 = $localize `:kendo.dialog.closeTitle|The title of the close button␟9b2bd34897f127e69e5f02f64692fca98a5a7572␟7499923323865444383:Close`;
    } return [["kendoDialogTitleBarLocalizedMessages", "", "closeTitle", i18n_1], [1, "k-window-title", "k-dialog-title"], [1, "k-window-actions", "k-dialog-actions"], ["href", "#", "role", "button", 1, "k-button", "k-flat", "k-button-icon", "k-window-action", "k-dialog-action", "k-dialog-close", 3, "click"], [1, "k-icon", "k-i-x"]]; }, template: function DialogTitleBarComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵprojectionDef();
        ɵngcc0.ɵɵelementContainerStart(0, 0);
        ɵngcc0.ɵɵelementStart(1, "div", 1);
        ɵngcc0.ɵɵprojection(2);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(3, "div", 2);
        ɵngcc0.ɵɵelementStart(4, "a", 3);
        ɵngcc0.ɵɵlistener("click", function DialogTitleBarComponent_Template_a_click_4_listener($event) { return ctx.onCloseClick($event); });
        ɵngcc0.ɵɵelement(5, "span", 4);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementContainerEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(4);
        ɵngcc0.ɵɵattribute("title", ctx.closeButtonTitle)("aria-label", ctx.closeButtonTitle);
    } }, directives: function () { return [LocalizedMessagesDirective]; }, encapsulation: 2 });
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], DialogTitleBarComponent.prototype, "close", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], DialogTitleBarComponent.prototype, "id", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], DialogTitleBarComponent.prototype, "closeTitle", void 0);
__decorate([
    HostBinding('class.k-window-titlebar'),
    HostBinding('class.k-dialog-titlebar'),
    __metadata("design:type", Boolean),
    __metadata("design:paramtypes", [])
], DialogTitleBarComponent.prototype, "className", null);
DialogTitleBarComponent = __decorate([ __param(2, Optional()),
    __metadata("design:paramtypes", [NgZone, ElementRef, LocalizationService])
], DialogTitleBarComponent);

/**
 * @hidden
 */
const packageMetadata = {
    name: '@progress/kendo-angular-dialog',
    productName: 'Kendo UI for Angular',
    productCodes: ['KENDOUIANGULAR', 'KENDOUICOMPLETE'],
    publishDate: 1631198413,
    version: '',
    licensingDocsUrl: 'https://www.telerik.com/kendo-angular-ui/my-license/?utm_medium=product&utm_source=kendoangular&utm_campaign=kendo-ui-angular-purchase-license-keys-warning'
};

/**
 * @hidden
 */
const isPresent = (value) => value !== null && value !== undefined;
/**
 * @hidden
 */
const isTruthy = (value) => !!value;
const toClassList = (classNames) => String(classNames).trim().split(' ');
const focusableRegex = /^(?:a|input|select|textarea|button|object)$/i;
/**
 * @hidden
 */
var Keys;
(function (Keys) {
    Keys[Keys["esc"] = 27] = "esc";
    Keys[Keys["tab"] = 9] = "tab";
    Keys[Keys["enter"] = 13] = "enter";
    Keys[Keys["space"] = 32] = "space";
    Keys[Keys["ctrl"] = 17] = "ctrl";
    Keys[Keys["shift"] = 16] = "shift";
    Keys[Keys["left"] = 37] = "left";
    Keys[Keys["up"] = 38] = "up";
    Keys[Keys["right"] = 39] = "right";
    Keys[Keys["down"] = 40] = "down";
})(Keys || (Keys = {}));
/**
 * @hidden
 */
const DIALOG_ELEMENTS_HANDLING_ESC_KEY = 'k-dialog-wrapper k-dialog-buttongroup k-dialog-action';
/**
 * @hidden
 */
const DIALOG_ELEMENTS_HANDLING_ARROWS = 'k-dialog-buttongroup';
/**
 * @hidden
 */
const WINDOW_CLASSES = 'k-window';
/**
 * @hidden
 */
const hasClasses = (element, classNames) => {
    const namesList = toClassList(classNames);
    return Boolean(toClassList(element.className).find((className) => namesList.indexOf(className) >= 0));
};
/**
 * @hidden
 */
const isVisible = (element) => {
    const rect = element.getBoundingClientRect();
    return !!(rect.width && rect.height) && window.getComputedStyle(element).visibility !== 'hidden';
};
/**
 * @hidden
 */
const isFocusable = (element, checkVisibility = true) => {
    if (element.tagName) {
        const tagName = element.tagName.toLowerCase();
        const tabIndex = element.getAttribute('tabIndex');
        const validTabIndex = tabIndex !== null && !isNaN(tabIndex) && tabIndex > -1;
        let focusable = false;
        if (focusableRegex.test(tagName)) {
            focusable = !element.disabled;
        }
        else {
            focusable = validTabIndex;
        }
        return focusable && (!checkVisibility || isVisible(element));
    }
    return false;
};
/**
 * @hidden
 */
const focusableSelector = [
    'a[href]',
    'area[href]',
    'input:not([disabled])',
    'select:not([disabled])',
    'textarea:not([disabled])',
    'button:not([disabled])',
    'iframe',
    'object',
    'embed',
    '*[tabindex]',
    '*[contenteditable]'
].join(',');
/**
 * @hidden
 */
const preventDefault = ({ originalEvent: event }) => {
    event.stopPropagation();
    event.preventDefault();
};
/**
 * @hidden
 */
const RESIZE_DIRECTIONS = ['n', 'e', 's', 'w', 'se', 'sw', 'ne', 'nw'];
/**
 * @hidden
 */
const OFFSET_STYLES = ['top', 'left', 'width', 'height'];
/**
 * @hidden
 */
const isString = (value) => value instanceof String || typeof value === 'string';
/**
 * @hidden
 */
const isNumber = (value) => typeof value === 'number' && isFinite(value);
/**
 * @hidden
 */
const createValueWithUnit = (value) => value + (isNumber(value) ? 'px' : '');

/**
 * The settings for the Dialog actions when the Dialog is opened through `DialogService`
 * ([see example]({% slug api_dialog_dialogservice %}#toc-open)).
 */
class DialogAction {
}
/**
 * Indicates that the **Close** button is clicked. Used when the results from
 * the Dialogs that are opened through `DialogService` are filtered
 * ([see example]({% slug api_dialog_dialogservice %}#toc-open)).
 */
class DialogCloseResult {
}
/**
 * The settings that can be used when the Dialog is opened through `DialogService`.
 * ([see example]({% slug api_dialog_dialogservice %}#toc-open)).
 */
class DialogSettings {
}
/**
 * Holds references to the object instance and published events of the Dialog.
 * Controls the Dialogs that were opened through the `DialogService`
 * ([see example]({% slug api_dialog_dialogservice %}#toc-open)).
 */
class DialogRef {
}

/**
 * Represents the [Kendo UI Dialog component for Angular]({% slug overview_dialog_dialogs %}).
 */
let DialogComponent = class DialogComponent {
    constructor(_elRef, _renderer, localization, cdr, zone) {
        this._elRef = _elRef;
        this._renderer = _renderer;
        this.cdr = cdr;
        this.zone = zone;
        /**
         * Specifies the layout of the action buttons in the Dialog.
         * This option is only applicable if the action buttons are specified through the `actions` options.
         *
         * @default 'stretched'
         */
        this.actionsLayout = 'stretched';
        /**
         * @hidden
         */
        this.titleId = null;
        /**
         * Fires when the user clicks an action button of the Dialog.
         * The event is fired only when the action buttons are specified through the `actions` options.
         */
        this.action = new EventEmitter();
        /**
         * Fires when the user clicks the **Close** button of the Dialog.
         */
        this.close = new EventEmitter();
        this.tabIndex = 0;
        this.subscriptions = [];
        validatePackage(packageMetadata);
        this.direction = localization.rtl ? 'rtl' : 'ltr';
        this.subscriptions.push(localization.changes.subscribe(({ rtl }) => (this.direction = rtl ? 'rtl' : 'ltr')));
        this.titleId = this.generateTitleId();
    }
    get dir() {
        return this.direction;
    }
    /**
     * @hidden
     */
    onComponentKeydown(event) {
        const target = event.target;
        const parent = target.parentElement;
        if (hasClasses(target, DIALOG_ELEMENTS_HANDLING_ESC_KEY) || hasClasses(parent, DIALOG_ELEMENTS_HANDLING_ESC_KEY)) {
            if (event.keyCode === Keys.esc) {
                this.close.emit(new DialogCloseResult());
            }
        }
        if (hasClasses(target, 'k-button') &&
            hasClasses(parent, DIALOG_ELEMENTS_HANDLING_ARROWS) &&
            (event.keyCode === Keys.left || event.keyCode === Keys.right)) {
            this.handleActionButtonFocus(parent, event.keyCode);
        }
        if (event.keyCode === Keys.tab) {
            this.keepFocusWithinComponent(target, event);
        }
    }
    ngAfterContentInit() {
        this.bubble('close', this.titlebarContent.first);
        if (this.titlebarContent.first) {
            this.titlebarContent.first.id = this.titleId;
        }
        else {
            this.subscriptions.push(this.titlebarContent.changes.subscribe(() => {
                if (isPresent(this.titlebarContent.first)) {
                    this.titlebarContent.first.id = this.titleId;
                    this.zone.onStable.pipe(take(1)).subscribe(() => {
                        this.bubble('close', this.titlebarContent.first);
                        this._renderer.setAttribute(this._elRef.nativeElement.querySelector('.k-dialog'), 'aria-labelledby', this.titleId);
                    });
                }
            }));
        }
    }
    ngOnChanges(changes) {
        if (changes.title && changes.title.currentValue && !changes.title.previousValue) {
            this.zone.onStable.pipe(take(1)).subscribe(() => {
                this.bubble('close', this.titlebarView);
                this._renderer.setAttribute(this._elRef.nativeElement.querySelector('.k-dialog'), 'aria-labelledby', this.titleId);
            });
        }
    }
    ngAfterViewInit() {
        this.handleInitialFocus();
        this.bubble('close', this.titlebarView);
        this.bubble('action', this.actionsView);
        if (this.titlebarView || this.titlebarContent.first) {
            //Needed for Dialogs created via service
            this._renderer.setAttribute(this._elRef.nativeElement.querySelector('.k-dialog'), 'aria-labelledby', this.titleId);
        }
    }
    ngOnInit() {
        this._renderer.removeAttribute(this._elRef.nativeElement, 'title');
        this.cdr.detectChanges();
    }
    ngOnDestroy() {
        this.subscriptions.forEach(s => s.unsubscribe());
        this.subscriptions = [];
    }
    /**
     * Focuses the wrapper of the Dialog component.
     */
    focus() {
        const wrapper = this._elRef.nativeElement;
        if (isPresent(wrapper)) {
            wrapper.focus();
        }
    }
    /**
     * @hidden
     */
    handleInitialFocus() {
        const wrapper = this._elRef.nativeElement;
        const primaryButton = wrapper.querySelector('.k-primary');
        if (this.autoFocusedElement) {
            const initiallyFocusedElement = wrapper.querySelector(this.autoFocusedElement);
            if (initiallyFocusedElement) {
                initiallyFocusedElement.focus();
            }
        }
        else if (this.shouldFocusPrimary(primaryButton)) {
            primaryButton.focus();
        }
        else {
            wrapper.focus();
        }
    }
    /**
     * @hidden
     */
    handleActionButtonFocus(parent, key) {
        const focusableActionButtons = this.getAllFocusableChildren(parent);
        for (let i = 0; i < focusableActionButtons.length; i++) {
            const current = focusableActionButtons[i];
            if (current === document.activeElement) {
                if (key === Keys.left && i > 0) {
                    focusableActionButtons[i - 1].focus();
                    break;
                }
                if (key === Keys.right && i < focusableActionButtons.length - 1) {
                    focusableActionButtons[i + 1].focus();
                    break;
                }
            }
        }
    }
    /**
     * @hidden
     */
    keepFocusWithinComponent(target, event) {
        const firstFocusable = this._elRef.nativeElement;
        const lastFocusable = this.getLastFocusableElement(firstFocusable);
        const tabBeforeFirstFocusable = target === firstFocusable && event.shiftKey;
        const tabAfterLastFocusable = !event.shiftKey && isPresent(lastFocusable) && target === lastFocusable;
        const tabWithNoFocusable = !isPresent(lastFocusable) && !event.shiftKey;
        if (tabBeforeFirstFocusable || tabWithNoFocusable) {
            event.preventDefault();
            firstFocusable.focus();
        }
        if (tabAfterLastFocusable) {
            event.preventDefault();
            lastFocusable.focus();
        }
    }
    /**
     * @hidden
     */
    shouldFocusPrimary(el) {
        return isPresent(el) && isFocusable(el);
    }
    /**
     * @hidden
     */
    getAllFocusableChildren(parent) {
        return parent.querySelectorAll(focusableSelector);
    }
    /**
     * @hidden
     */
    getLastFocusableElement(parent) {
        const all = this.getAllFocusableChildren(parent);
        return all.length > 0 ? all[all.length - 1] : null;
    }
    /**
     * @hidden
     */
    generateTitleId() {
        return 'kendo-dialog-title-' + Math.ceil(Math.random() * 1000000).toString();
    }
    get wrapperClass() {
        return true;
    }
    get styles() {
        const styles = {};
        if (this.width) {
            styles.width = createValueWithUnit(this.width);
        }
        if (this.height) {
            styles.height = createValueWithUnit(this.height);
        }
        if (this.minWidth) {
            styles.minWidth = createValueWithUnit(this.minWidth);
        }
        if (this.maxWidth) {
            styles.maxWidth = createValueWithUnit(this.maxWidth);
        }
        if (this.minHeight) {
            styles.minHeight = createValueWithUnit(this.minHeight);
        }
        if (this.maxHeight) {
            styles.maxHeight = createValueWithUnit(this.maxHeight);
        }
        return styles;
    }
    bubble(eventName, component) {
        if (component) {
            const emit = e => this[eventName].emit(e);
            const s = component[eventName].subscribe(emit);
            this.subscriptions.push(s);
        }
    }
};
DialogComponent.ɵfac = function DialogComponent_Factory(t) { return new (t || DialogComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.LocalizationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ChangeDetectorRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone)); };
DialogComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: DialogComponent, selectors: [["kendo-dialog"]], contentQueries: function DialogComponent_ContentQueries(rf, ctx, dirIndex) { if (rf & 1) {
        ɵngcc0.ɵɵcontentQuery(dirIndex, DialogTitleBarComponent, 4);
    } if (rf & 2) {
        let _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.titlebarContent = _t);
    } }, viewQuery: function DialogComponent_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵviewQuery(DialogTitleBarComponent, 5);
        ɵngcc0.ɵɵviewQuery(DialogActionsComponent, 5);
    } if (rf & 2) {
        let _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.titlebarView = _t.first);
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.actionsView = _t.first);
    } }, hostVars: 4, hostBindings: function DialogComponent_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("keydown", function DialogComponent_keydown_HostBindingHandler($event) { return ctx.onComponentKeydown($event); });
    } if (rf & 2) {
        ɵngcc0.ɵɵattribute("tabIndex", ctx.tabIndex)("dir", ctx.dir);
        ɵngcc0.ɵɵclassProp("k-dialog-wrapper", ctx.wrapperClass);
    } }, inputs: { actionsLayout: "actionsLayout", actions: "actions", autoFocusedElement: "autoFocusedElement", title: "title", width: "width", minWidth: "minWidth", maxWidth: "maxWidth", height: "height", minHeight: "minHeight", maxHeight: "maxHeight" }, outputs: { action: "action", close: "close" }, exportAs: ["kendoDialog"], features: [ɵngcc0.ɵɵProvidersFeature([
            LocalizationService,
            {
                provide: DIALOG_LOCALIZATION_SERVICE,
                useExisting: LocalizationService
            },
            {
                provide: L10N_PREFIX,
                useValue: 'kendo.dialog'
            }
        ]), ɵngcc0.ɵɵNgOnChangesFeature], ngContentSelectors: _c6, decls: 10, vars: 9, consts: function () { let i18n_3; if (typeof ngI18nClosureMode !== "undefined" && ngI18nClosureMode) {
        /**
         * @desc The title of the close button
         * @meaning kendo.dialog.closeTitle
         */
        const MSG_EXTERNAL_7499923323865444383$$DIST_FESM2015_INDEX_JS_4 = goog.getMsg("Close");
        i18n_3 = MSG_EXTERNAL_7499923323865444383$$DIST_FESM2015_INDEX_JS_4;
    }
    else {
        i18n_3 = $localize `:kendo.dialog.closeTitle|The title of the close button␟9b2bd34897f127e69e5f02f64692fca98a5a7572␟7499923323865444383:Close`;
    } return [["kendoDialogLocalizedMessages", "", "closeTitle", i18n_3], [1, "k-overlay"], ["role", "dialog", 1, "k-widget", "k-window", "k-dialog", 3, "ngStyle"], [3, "closeTitle", "id", 4, "ngIf"], [4, "ngIf"], [1, "k-content", "k-window-content", "k-dialog-content"], [3, "actions", "layout", 4, "ngIf"], [3, "closeTitle", "id"], [3, "ngTemplateOutlet"], [3, "actions", "layout"]]; }, template: function DialogComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵprojectionDef(_c5);
        ɵngcc0.ɵɵelementContainerStart(0, 0);
        ɵngcc0.ɵɵelement(1, "div", 1);
        ɵngcc0.ɵɵelementStart(2, "div", 2);
        ɵngcc0.ɵɵtemplate(3, DialogComponent_kendo_dialog_titlebar_3_Template, 2, 3, "kendo-dialog-titlebar", 3);
        ɵngcc0.ɵɵtemplate(4, DialogComponent_ng_content_4_Template, 1, 0, "ng-content", 4);
        ɵngcc0.ɵɵelementStart(5, "div", 5);
        ɵngcc0.ɵɵtemplate(6, DialogComponent_ng_content_6_Template, 1, 0, "ng-content", 4);
        ɵngcc0.ɵɵtemplate(7, DialogComponent_7_Template, 1, 1, undefined, 4);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(8, DialogComponent_ng_content_8_Template, 1, 0, "ng-content", 4);
        ɵngcc0.ɵɵtemplate(9, DialogComponent_kendo_dialog_actions_9_Template, 1, 2, "kendo-dialog-actions", 6);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementContainerEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("@overlayAppear", undefined);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngStyle", ctx.styles)("@dialogSlideInAppear", undefined);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.title);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", !ctx.title);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngIf", !ctx.contentTemplate);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.contentTemplate);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", !ctx.actions);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.actions);
    } }, directives: function () { return [LocalizedMessagesDirective, ɵngcc1.NgStyle, ɵngcc1.NgIf, DialogTitleBarComponent, ɵngcc1.NgTemplateOutlet, DialogActionsComponent]; }, encapsulation: 2, data: { animation: [
            trigger('overlayAppear', [
                state('in', style({ opacity: 1 })),
                transition('void => *', [style({ opacity: 0.1 }), animate('.3s cubic-bezier(.2, .6, .4, 1)')])
            ]),
            trigger('dialogSlideInAppear', [
                state('in', style({ transform: 'translate(0, 0)' })),
                transition('void => *', [style({ transform: 'translate(0, -10%)' }), animate('.3s cubic-bezier(.2, 1, .2, 1)')])
            ])
        ] } });
__decorate([
    Input(),
    __metadata("design:type", Array)
], DialogComponent.prototype, "actions", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], DialogComponent.prototype, "actionsLayout", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], DialogComponent.prototype, "autoFocusedElement", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], DialogComponent.prototype, "title", void 0);
__decorate([
    Input(),
    __metadata("design:type", Object)
], DialogComponent.prototype, "width", void 0);
__decorate([
    Input(),
    __metadata("design:type", Object)
], DialogComponent.prototype, "minWidth", void 0);
__decorate([
    Input(),
    __metadata("design:type", Object)
], DialogComponent.prototype, "maxWidth", void 0);
__decorate([
    Input(),
    __metadata("design:type", Object)
], DialogComponent.prototype, "height", void 0);
__decorate([
    Input(),
    __metadata("design:type", Object)
], DialogComponent.prototype, "minHeight", void 0);
__decorate([
    Input(),
    __metadata("design:type", Object)
], DialogComponent.prototype, "maxHeight", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], DialogComponent.prototype, "action", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], DialogComponent.prototype, "close", void 0);
__decorate([
    HostBinding('attr.dir'),
    __metadata("design:type", String),
    __metadata("design:paramtypes", [])
], DialogComponent.prototype, "dir", null);
__decorate([
    HostBinding('attr.tabIndex'),
    __metadata("design:type", Number)
], DialogComponent.prototype, "tabIndex", void 0);
__decorate([
    ContentChildren(DialogTitleBarComponent, { descendants: false }),
    __metadata("design:type", QueryList)
], DialogComponent.prototype, "titlebarContent", void 0);
__decorate([
    ViewChild(DialogTitleBarComponent, { static: false }),
    __metadata("design:type", DialogTitleBarComponent)
], DialogComponent.prototype, "titlebarView", void 0);
__decorate([
    ViewChild(DialogActionsComponent, { static: false }),
    __metadata("design:type", DialogActionsComponent)
], DialogComponent.prototype, "actionsView", void 0);
__decorate([
    HostListener('keydown', ['$event']),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", void 0)
], DialogComponent.prototype, "onComponentKeydown", null);
__decorate([
    HostBinding('class.k-dialog-wrapper'),
    __metadata("design:type", Boolean),
    __metadata("design:paramtypes", [])
], DialogComponent.prototype, "wrapperClass", null);
DialogComponent = __decorate([ __metadata("design:paramtypes", [ElementRef,
        Renderer2,
        LocalizationService,
        ChangeDetectorRef,
        NgZone])
], DialogComponent);

/**
 * The base class  which will be extended by a component that is provided as content through `content`
 * ([see example]({% slug service_dialog %}#toc-passing-title-content-and-actions-as-a-single-component)).
 */
class DialogContentBase {
    constructor(dialog) {
        this.dialog = dialog;
    }
    /**
     * @hidden
     */
    ngAfterViewInit() {
        if (this.dialogTitleBar) {
            // when opening component inside dialog with service AND the component has defined its own titlebar
            this.dialogTitleBar.close.pipe(filter((e) => !e.isDefaultPrevented())).subscribe(() => {
                this.dialog.close();
            });
        }
        if (this.dialogActions) {
            if (this.dialogActions.actions) {
                this.dialogActions.action.subscribe(action => this.dialog.dialog.instance.action.emit(action));
            }
        }
    }
}
DialogContentBase.ɵfac = function DialogContentBase_Factory(t) { ɵngcc0.ɵɵinvalidFactory(); };
DialogContentBase.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: DialogContentBase, viewQuery: function DialogContentBase_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵviewQuery(DialogTitleBarComponent, 5);
        ɵngcc0.ɵɵviewQuery(DialogActionsComponent, 5);
    } if (rf & 2) {
        let _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.dialogTitleBar = _t.first);
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.dialogActions = _t.first);
    } } });
__decorate([
    ViewChild(DialogTitleBarComponent, { static: false }),
    __metadata("design:type", DialogTitleBarComponent)
], DialogContentBase.prototype, "dialogTitleBar", void 0);
__decorate([
    ViewChild(DialogActionsComponent, { static: false }),
    __metadata("design:type", DialogActionsComponent)
], DialogContentBase.prototype, "dialogActions", void 0);

var DialogContainerService_1;
/**
 * @hidden
 */
let DialogContainerService = DialogContainerService_1 = class DialogContainerService {
    set container(container) {
        DialogContainerService_1.container = container;
    }
    get container() {
        return DialogContainerService_1.container;
    }
};
DialogContainerService.ɵfac = function DialogContainerService_Factory(t) { return new (t || DialogContainerService)(); };
DialogContainerService.ɵprov = /*@__PURE__*/ ɵngcc0.ɵɵdefineInjectable({ token: DialogContainerService, factory: function (t) { return DialogContainerService.ɵfac(t); } });
DialogContainerService.container = null;

const isNotComponent = (component) => isString(component) || component instanceof TemplateRef;
class DialogInjector {
    constructor(getDialogRef, parentInjector) {
        this.getDialogRef = getDialogRef;
        this.parentInjector = parentInjector;
    }
    get(token, notFoundValue) {
        if (token === DialogRef) {
            return this.getDialogRef();
        }
        return this.parentInjector.get(token, notFoundValue);
    }
}
/**
 * A service for opening Dialog windows dynamically
 * ([see example]({% slug service_dialog %})).
 */
let DialogService = class DialogService {
    constructor(
    /**
     * @hidden
     */
    resolver, containerService) {
        this.resolver = resolver;
        this.containerService = containerService;
    }
    /**
     * Opens a Dialog window. Requires an element in the application that uses the
     * [`kendoDialogContainer`]({% slug api_dialog_dialogcontainerdirective %}) directive.
     * Created Dialogs will be mounted in the DOM directly after that element.
     *
     * @param {DialogAction} options - The options that define the Dialog.
     * @returns {DialogRef} - A reference to the Dialog object and the convenience properties.
     *
     * @example
     *
     * ```ts-no-run
     * _@Component({
     *   selector: 'my-app',
     *   template: `
     *     <button kendoButton (click)="open()">Harmless button</button>
     *     <div kendoDialogContainer></div>
     *   `
     * })
     * export class AppComponent {
     *     constructor( private dialogService: DialogService ) {}
     *
     *     public open() {
     *         var dialog = this.dialogService.open({
     *           title: "Please confirm",
     *           content: "Are you sure?",
     *           actions: [
     *             { text: "No" },
     *             { text: "Yes", primary: true }
     *           ]
     *         });
     *
     *         dialog.result.subscribe((result) => {
     *           if (result instanceof DialogCloseResult) {
     *             console.log("close");
     *           } else {
     *             console.log("action", result);
     *           }
     *         });
     *     }
     * }
     * ```
     *
     */
    open(options) {
        const factory = this.resolver.resolveComponentFactory(DialogComponent);
        const container = options.appendTo || this.containerService.container;
        if (!container) {
            throw new Error(`
Cannot attach dialog to the page.
Add an element that uses the kendoDialogContainer directive, or set the 'appendTo' property.
See https://www.telerik.com/kendo-angular-ui/components/dialogs/dialog/service/.
          `);
        }
        // create DialogRef to (1) pass as result, (2) provide through injector
        const dialogRef = {
            close: () => {
                /* noop */
            },
            content: null,
            dialog: null,
            result: null
        };
        return this.initializeDialog(options.content, factory, container, dialogRef, options);
    }
    initializeDialog(component, factory, container, dialogRef, options) {
        const content = this.contentFrom(component, container, dialogRef);
        const dialog = container.createComponent(factory, undefined, undefined, content.nodes);
        dialogRef.dialog = dialog;
        dialog.changeDetectorRef.markForCheck();
        // copy @Input options to dialog instance
        this.applyOptions(dialog.instance, options);
        // create close handler and result stream
        const apiClose = new Subject();
        const close = (e) => {
            if (e instanceof PreventableEvent) {
                e = new DialogCloseResult();
            }
            apiClose.next(e || new DialogCloseResult());
            if (content.componentRef) {
                content.componentRef.destroy();
            }
            dialog.destroy();
        };
        const result = merge(apiClose, 
        // triggered when the titlebar or actions are defined in DialogSettings
        merge(dialog.instance.close, dialog.instance.action).pipe(map(e => (e instanceof PreventableEvent ? new DialogCloseResult() : e)), filter(e => {
            if (options.preventAction) {
                // add dialogRef only when using component
                const dialogRefParameter = isNotComponent(component) ? undefined : dialogRef;
                return !options.preventAction(e, dialogRefParameter);
            }
            return true;
        }))).pipe(take(1), 
        // Takes care for multiple subscriptions:
        // We subscribe internaly and the user may subscribe to get a close result - dialog.result.subscribe().
        // This causes multiple subscriptions to the same source and thus multiple emissions. share() solves that.
        share());
        result.subscribe(close);
        dialogRef.close = close;
        dialogRef.result = result;
        if (component && isDevMode()) {
            const hasContentTitle = content.nodes[0] && content.nodes[0].length > 0;
            const hasContentActions = content.nodes[2] && content.nodes[2].length > 0;
            const multipleTitles = options.title && hasContentTitle;
            const multipleActions = options.actions && hasContentActions;
            if (component.prototype instanceof DialogContentBase) {
                // content component extends DialogContentBase
                if (multipleTitles || multipleActions) {
                    console.warn(`
                    Multiple Title and/or Actions configurations detected.
                    When using a component as content, provide the title and actions either in the component's markup
                    or via the title and actions properties of the DialogSettings object, but not both.
                    See https://www.telerik.com/kendo-angular-ui/components/dialogs/dialog/service/#toc-passing-title-content-and-actions-as-a-single-component'`);
                }
            }
            else {
                if (hasContentTitle || hasContentActions) {
                    console.warn(`
                    When Title and/or Actions markup is provided in content component's template,
                    the component needs to inherit the DialogContentBase class to ensure that close and result events are properly hooked.
                    See https://www.telerik.com/kendo-angular-ui/components/dialogs/dialog/service/#toc-passing-title-content-and-actions-as-a-single-component'`);
                }
            }
        }
        return dialogRef;
    }
    applyOptions(instance, options) {
        instance.title = options.title;
        instance.actions = options.actions;
        instance.actionsLayout = options.actionsLayout || 'stretched';
        instance.width = options.width;
        instance.minWidth = options.minWidth;
        instance.maxWidth = options.maxWidth;
        instance.height = options.height;
        instance.minHeight = options.minHeight;
        instance.maxHeight = options.maxHeight;
        instance.autoFocusedElement = options.autoFocusedElement;
        instance.closeTitle = options.closeTitle;
        if (options.content instanceof TemplateRef) {
            instance.contentTemplate = options.content;
        }
    }
    contentFrom(content, container, dialogRef) {
        const renderer = container.injector.get(Renderer2);
        let nodes = [];
        let titleNodes = [];
        let actionNodes = [];
        let componentRef = null;
        if (typeof content === 'string') {
            nodes = [renderer.createText(content)];
        }
        else if (content && !(content instanceof TemplateRef)) {
            // Component
            const injector = new DialogInjector(() => dialogRef, container.injector);
            const factory = this.resolver.resolveComponentFactory(content);
            componentRef = container.createComponent(factory, undefined, injector);
            titleNodes = Array.from(componentRef.location.nativeElement.querySelectorAll('kendo-dialog-titlebar'));
            nodes = [componentRef.location.nativeElement];
            actionNodes = Array.from(componentRef.location.nativeElement.querySelectorAll('kendo-dialog-actions'));
            dialogRef.content = componentRef;
        }
        return {
            componentRef,
            nodes: [
                titleNodes,
                nodes,
                actionNodes // <ng-content select="kendo-dialog-actions">
            ]
        };
    }
};
DialogService.ɵfac = function DialogService_Factory(t) { return new (t || DialogService)(ɵngcc0.ɵɵinject(ɵngcc0.ComponentFactoryResolver), ɵngcc0.ɵɵinject(DialogContainerService)); };
DialogService.ɵprov = /*@__PURE__*/ ɵngcc0.ɵɵdefineInjectable({ token: DialogService, factory: function (t) { return DialogService.ɵfac(t); } });
DialogService = __decorate([ __param(1, Inject(DialogContainerService)),
    __metadata("design:paramtypes", [ComponentFactoryResolver,
        DialogContainerService])
], DialogService);

/**
 * @hidden
 */
let newZIndex = 10002;
/**
 * @hidden
 */
const DEFAULT_OPTIONS = {
    draggable: true,
    height: null,
    left: null,
    minHeight: 100,
    minWidth: 120,
    position: 'absolute',
    resizable: true,
    state: 'default',
    top: null,
    width: null
};
/**
 * @hidden
 */
const createMoveStream = (el, ev) => mouseDown => {
    return el.kendoDrag
        .pipe(takeUntil(el.kendoRelease.pipe(tap(() => { ev.emit(); }))), map(({ pageX, pageY }) => ({
        originalX: mouseDown.pageX,
        originalY: mouseDown.pageY,
        pageX,
        pageY
    })));
};
/**
 * @hidden
 */
let DragResizeService = class DragResizeService {
    constructor(ngZone) {
        this.ngZone = ngZone;
        this.close = new EventEmitter();
        this.focus = new EventEmitter();
        this.change = new EventEmitter();
        this.stateChange = new EventEmitter();
        this.dragStart = new EventEmitter();
        this.dragEnd = new EventEmitter();
        this.resizeStart = new EventEmitter();
        this.resizeEnd = new EventEmitter();
        this.options = Object.assign({}, DEFAULT_OPTIONS);
        this.lastAction = null;
        this.subscriptions = new Subscription();
        this.dragSubscription = new Subscription();
    }
    ngOnDestroy() {
        if (this.subscriptions) {
            this.subscriptions.unsubscribe();
        }
        if (this.dragSubscription) {
            this.dragSubscription.unsubscribe();
        }
    }
    init(el) {
        const state$$1 = this.options.state;
        let options = this.options;
        this.window = el;
        if (state$$1 !== 'default') {
            this.restoreOptions = Object.assign({}, options);
        }
        if (state$$1 === 'minimized') {
            options.height = 0;
            options.minHeight = 0;
        }
        if (state$$1 === 'maximized') {
            options.position = 'fixed';
        }
    }
    onDrag(el) {
        this.subscriptions.add(this.ngZone.runOutsideAngular(() => {
            let startPosition;
            let dragStarted;
            this.dragSubscription = el.kendoPress
                .pipe(tap((ev) => {
                if (!ev.isTouch) {
                    preventDefault(ev);
                }
                this.focus.emit();
                startPosition = this.currentPosition();
                dragStarted = false;
            }), switchMap(createMoveStream(el, this.dragEnd)))
                .subscribe(({ pageX, pageY, originalX, originalY }) => {
                if (!dragStarted) {
                    this.ensureWidth();
                    this.dragStart.emit();
                    dragStarted = true;
                }
                this.handleDrag({
                    originalX, originalY,
                    pageX, pageY, startPosition
                });
            });
        }));
    }
    handleDrag({ originalX, originalY, pageX, pageY, startPosition }) {
        this.options.left = startPosition.x + pageX - originalX;
        this.options.top = startPosition.y + pageY - originalY;
        if (this.options.state === 'minimized' && isPresent(this.restoreOptions)) {
            this.restoreOptions.left = this.options.left;
            this.restoreOptions.top = this.options.top;
        }
        this.change.emit({
            left: startPosition.x + pageX - originalX,
            top: startPosition.y + pageY - originalY
        });
    }
    onResize(handle, direction) {
        this.subscriptions.add(this.ngZone.runOutsideAngular(() => {
            let startOffsetAndPosition;
            let resizeStarted = false;
            handle.kendoPress.pipe(tap((ev) => {
                preventDefault(ev);
                this.focus.emit();
                startOffsetAndPosition = this.currentOffsetAndPosition();
                resizeStarted = false;
            }), switchMap(createMoveStream(handle, this.resizeEnd)))
                .subscribe(({ pageX, pageY, originalX, originalY }) => {
                if (!resizeStarted) {
                    this.resizeStart.emit(direction);
                    resizeStarted = true;
                }
                let deltaX = pageX - originalX;
                let deltaY = pageY - originalY;
                this.handleResize(startOffsetAndPosition, direction, deltaX, deltaY);
            });
        }));
    }
    handleResize(initial, dir, deltaX, deltaY) {
        const old = this.options;
        let ev = {};
        if (dir.indexOf('e') >= 0) {
            const newWidth = initial.width + deltaX;
            if (newWidth !== old.width && newWidth >= old.minWidth) {
                ev.width = newWidth;
            }
        }
        if (dir.indexOf('n') >= 0) {
            const newHeight = initial.height - deltaY;
            const newTop = initial.y + deltaY;
            if (newHeight !== old.height && newHeight >= old.minHeight && newTop !== old.top) {
                ev.height = newHeight;
                ev.top = newTop;
            }
        }
        if (dir.indexOf('s') >= 0) {
            const newHeight = initial.height + deltaY;
            if (newHeight !== old.height && newHeight >= old.minHeight) {
                ev.height = newHeight;
            }
        }
        if (dir.indexOf('w') >= 0) {
            const newLeft = initial.x + deltaX;
            const newWidth = initial.width - deltaX;
            if (newWidth !== old.width && newWidth >= old.minWidth && newLeft !== old.left) {
                ev.width = newWidth;
                ev.left = newLeft;
            }
        }
        if (isPresent(ev.width) || isPresent(ev.height)) {
            OFFSET_STYLES.forEach((style$$1) => {
                if (isPresent(ev[style$$1])) {
                    this.options[style$$1] = ev[style$$1];
                }
            });
            this.change.emit(ev);
        }
    }
    restoreAction() {
        this.lastAction = 'restore';
        this.defaultState();
    }
    defaultState() {
        if (isPresent(this.restoreOptions)) {
            this.options = Object.assign({}, this.restoreOptions);
        }
        this.options.state = 'default';
        this.stateChange.emit('default');
    }
    storeOptions() {
        this.restoreOptions = Object.assign({}, this.options);
    }
    maximizeAction() {
        this.lastAction = 'maximize';
        this.maximizeState();
    }
    maximizeState() {
        this.storeOptions();
        const wnd = this.windowViewPort;
        this.options = Object.assign({}, this.options, {
            height: wnd.height,
            left: 0,
            position: 'fixed',
            state: 'maximized',
            top: 0,
            width: wnd.width
        });
        this.stateChange.emit('maximized');
    }
    minimizeAction() {
        this.lastAction = 'minimize';
        this.minimizeState();
    }
    minimizeState() {
        this.storeOptions();
        this.options = Object.assign({}, this.options, {
            height: null,
            minHeight: 0,
            state: 'minimized'
        });
        this.stateChange.emit('minimized');
    }
    /**
     * Handles manual changes of the 'state' property.
     * Required to distinguish them from action clicks.
     */
    applyManualState() {
        const state$$1 = this.options.state;
        switch (state$$1) {
            case 'default':
                this.clearHeight();
                this.defaultState();
                break;
            case 'maximized':
                this.clearHeight();
                this.maximizeState();
                break;
            case 'minimized':
                this.minimizeState();
                break;
            default:
                break;
        }
    }
    closeAction() {
        this.close.emit();
    }
    ensureWidth() {
        const windowOffset = offset(this.window.nativeElement);
        if (!isPresent(this.options.width)) {
            this.options.width = windowOffset.width;
            this.change.emit({ width: windowOffset.width });
        }
    }
    clearHeight() {
        if (this.options.height === 0) {
            delete this.options.height;
        }
        if (this.options.minHeight === 0) {
            delete this.options.minHeight;
        }
    }
    center() {
        if (this.options.state === 'maximized') {
            return;
        }
        let scroll = scrollPosition(this.window.nativeElement);
        let wnd = this.windowViewPort;
        let wrapper = offset(this.window.nativeElement);
        let ev = {};
        if (!isPresent(this.options.left)) {
            this.options.left = scroll.x + Math.max(0, (wnd.width - wrapper.width) / 2);
            ev.left = this.options.left;
        }
        if (!isPresent(this.options.top)) {
            this.options.top = scroll.y + Math.max(0, (wnd.height - wrapper.height) / 2);
            ev.top = this.options.top;
        }
        this.change.emit(ev);
    }
    currentOffsetAndPosition() {
        const o = this.options;
        const off = offset(this.window.nativeElement);
        return Object.assign({}, this.currentPosition(), {
            height: o.height ? o.height : off.height,
            width: o.width ? o.width : off.width
        });
    }
    currentPosition() {
        const o = this.options;
        if (!o.top || !o.left) {
            this.setPosition();
        }
        return {
            x: this.options.left,
            y: this.options.top
        };
    }
    setPosition() {
        const wrapper = positionWithScroll(this.window.nativeElement, getDocumentElement(this.window.nativeElement));
        this.options.left = wrapper.left;
        this.options.top = wrapper.top;
    }
    setRestoreOption(style$$1, value) {
        if (isPresent(this.restoreOptions)) {
            this.restoreOptions[style$$1] = value;
        }
    }
    get nextPossibleZIndex() {
        return newZIndex;
    }
    get nextZIndex() {
        return newZIndex++;
    }
    get windowViewPort() {
        return getWindowViewPort(this.window.nativeElement);
    }
};
DragResizeService.ɵfac = function DragResizeService_Factory(t) { return new (t || DragResizeService)(ɵngcc0.ɵɵinject(ɵngcc0.NgZone)); };
DragResizeService.ɵprov = /*@__PURE__*/ ɵngcc0.ɵɵdefineInjectable({ token: DragResizeService, factory: function (t) { return DragResizeService.ɵfac(t); } });
DragResizeService = __decorate([ __metadata("design:paramtypes", [NgZone])
], DragResizeService);

/**
 * @hidden
 */
let ResizeHandleDirective = class ResizeHandleDirective {
    constructor(draggable, el, renderer, service) {
        this.draggable = draggable;
        this.el = el;
        this.renderer = renderer;
        this.service = service;
        this.subscriptions = new Subscription();
    }
    get hostClass() {
        return true;
    }
    ngOnInit() {
        this.setDisplay();
        this.renderer.addClass(this.el.nativeElement, 'k-resize-' + this.direction);
        this.subscriptions.add(of(this.draggable).subscribe(handle => {
            this.service.onResize(handle, this.direction);
        }));
        this.subscriptions.add(this.service.resizeStart.subscribe((dir) => {
            if (dir !== this.direction) {
                this.setDisplay('none');
            }
        }));
        this.subscriptions.add(this.service.dragStart.subscribe(() => {
            this.setDisplay('none');
        }));
        this.subscriptions.add(merge(this.service.resizeEnd, this.service.dragEnd).subscribe(() => {
            this.setDisplay('block');
        }));
        this.subscriptions.add(this.service.stateChange.subscribe((state$$1) => {
            this.setDisplay(state$$1 === 'default' ? 'block' : 'none');
        }));
    }
    ngOnDestroy() {
        this.subscriptions.unsubscribe();
    }
    setDisplay(value = 'block') {
        this.renderer.setStyle(this.el.nativeElement, 'display', this.service.options.state === 'default' ? value : 'none');
    }
};
ResizeHandleDirective.ɵfac = function ResizeHandleDirective_Factory(t) { return new (t || ResizeHandleDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc3.DraggableDirective, 1), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(DragResizeService)); };
ResizeHandleDirective.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: ResizeHandleDirective, selectors: [["", "kendoWindowResizeHandle", ""]], hostVars: 2, hostBindings: function ResizeHandleDirective_HostBindings(rf, ctx) { if (rf & 2) {
        ɵngcc0.ɵɵclassProp("k-resize-handle", ctx.hostClass);
    } }, inputs: { direction: "direction" } });
__decorate([
    Input(),
    __metadata("design:type", String)
], ResizeHandleDirective.prototype, "direction", void 0);
__decorate([
    HostBinding('class.k-resize-handle'),
    __metadata("design:type", Boolean),
    __metadata("design:paramtypes", [])
], ResizeHandleDirective.prototype, "hostClass", null);
ResizeHandleDirective = __decorate([ __param(0, Host()),
    __metadata("design:paramtypes", [DraggableDirective,
        ElementRef,
        Renderer2,
        DragResizeService])
], ResizeHandleDirective);

let WindowTitleBarComponent = class WindowTitleBarComponent {
    constructor(el, service, ngZone) {
        this.el = el;
        this.ngZone = ngZone;
        this.service = service;
    }
    ngOnInit() {
        this.dragDirective = new DraggableDirective(this.el, this.ngZone);
        this.dragDirective.ngOnInit();
        if (this.isDraggable) {
            this.subscribeDrag();
        }
        this.subscribeStateChange();
    }
    ngOnDestroy() {
        this.dragDirective.ngOnDestroy();
        this.unsubscribeDrag();
        this.unsubscribeState();
    }
    /**
     * @hidden
     */
    subscribeDrag() {
        this.unsubscribeDrag();
        this.dragSubscription = of(this.dragDirective).subscribe(titleBar => {
            this.service.onDrag(titleBar);
        });
    }
    /**
     * @hidden
     */
    subscribeStateChange() {
        this.stateSubscription = this.service.stateChange.subscribe((state$$1) => {
            if (this.service.options.draggable) {
                if (state$$1 === 'maximized') {
                    this.unsubscribeDrag();
                }
                else {
                    this.subscribeDrag();
                }
            }
        });
    }
    /**
     * @hidden
     */
    unsubscribeDrag() {
        if (this.dragSubscription) {
            this.service.dragSubscription.unsubscribe();
            this.dragSubscription.unsubscribe();
            this.dragSubscription = null;
        }
    }
    /**
     * @hidden
     */
    unsubscribeState() {
        if (this.stateSubscription) {
            this.stateSubscription.unsubscribe();
            this.stateSubscription = null;
        }
    }
    get className() {
        return true;
    }
    get touchAction() {
        if (this.isDraggable) {
            return 'none';
        }
    }
    /**
     * @hidden
     */
    handle(ev) {
        const target = ev.target;
        const state$$1 = this.service.options.state;
        if (!hasClasses(target, 'k-icon') && !isFocusable(target, false) && this.service.options.resizable) {
            if (state$$1 === 'default') {
                this.service.maximizeAction();
            }
            else if (state$$1 === 'maximized') {
                this.service.restoreAction();
            }
        }
    }
    get isDraggable() {
        const options = this.service.options;
        return options.draggable && options.state !== 'maximized';
    }
};
WindowTitleBarComponent.ɵfac = function WindowTitleBarComponent_Factory(t) { return new (t || WindowTitleBarComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(DragResizeService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone)); };
WindowTitleBarComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: WindowTitleBarComponent, selectors: [["kendo-window-titlebar"]], hostVars: 6, hostBindings: function WindowTitleBarComponent_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("dblclick", function WindowTitleBarComponent_dblclick_HostBindingHandler($event) { return ctx.handle($event); });
    } if (rf & 2) {
        ɵngcc0.ɵɵstyleProp("touch-action", ctx.touchAction);
        ɵngcc0.ɵɵclassProp("k-window-titlebar", ctx.className)("k-dialog-titlebar", ctx.className);
    } }, inputs: { template: "template" }, ngContentSelectors: _c0, decls: 2, vars: 2, consts: [[4, "ngIf"], [3, "ngTemplateOutlet", "ngTemplateOutletContext"]], template: function WindowTitleBarComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵprojectionDef();
        ɵngcc0.ɵɵtemplate(0, WindowTitleBarComponent_ng_content_0_Template, 1, 0, "ng-content", 0);
        ɵngcc0.ɵɵtemplate(1, WindowTitleBarComponent_1_Template, 1, 4, undefined, 0);
    } if (rf & 2) {
        ɵngcc0.ɵɵproperty("ngIf", !ctx.template);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.template);
    } }, directives: [ɵngcc1.NgIf, ɵngcc1.NgTemplateOutlet], encapsulation: 2 });
__decorate([
    Input(),
    __metadata("design:type", TemplateRef)
], WindowTitleBarComponent.prototype, "template", void 0);
__decorate([
    HostBinding('class.k-window-titlebar'),
    HostBinding('class.k-dialog-titlebar'),
    __metadata("design:type", Boolean),
    __metadata("design:paramtypes", [])
], WindowTitleBarComponent.prototype, "className", null);
__decorate([
    HostBinding('style.touch-action'),
    __metadata("design:type", String),
    __metadata("design:paramtypes", [])
], WindowTitleBarComponent.prototype, "touchAction", null);
__decorate([
    HostListener('dblclick', ['$event']),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", void 0)
], WindowTitleBarComponent.prototype, "handle", null);
WindowTitleBarComponent = __decorate([ __metadata("design:paramtypes", [ElementRef, DragResizeService, NgZone])
], WindowTitleBarComponent);

/**
 * @hidden
 */
let NavigationService = class NavigationService {
    constructor(window) {
        this.window = window;
    }
    process(ev) {
        const key = ev.keyCode;
        switch (key) {
            case Keys.up:
            case Keys.down:
            case Keys.left:
            case Keys.right: {
                ev.preventDefault();
                this.handleArrow(key, ev);
                break;
            }
            case Keys.esc:
                this.handleEscape();
                break;
            default:
                break;
        }
    }
    handleArrow(key, ev) {
        const options = this.window.options;
        if (ev.altKey) {
            this.handleStateChange(key, options.state);
            return;
        }
        if ((ev.ctrlKey || ev.metaKey) && options.state === 'default') {
            this.handleResize(key);
        }
        else {
            this.handleDrag(key);
        }
    }
    handleEscape() {
        this.window.closeAction();
    }
    handleDrag(key) {
        let options = this.window.options;
        if (!options.draggable) {
            return;
        }
        const offset$$1 = this.window.currentOffsetAndPosition();
        let restoreOptions = this.window.restoreOptions;
        let ev = {};
        let delta = 10;
        if (key === Keys.left || key === Keys.up) {
            delta *= -1;
        }
        switch (key) {
            case Keys.left:
            case Keys.right: {
                ev.left = offset$$1.x + delta;
                options.left = ev.left;
                break;
            }
            case Keys.up:
            case Keys.down: {
                ev.top = offset$$1.y + delta;
                options.top = ev.top;
                break;
            }
            default:
                break;
        }
        if (options.state === 'minimized' && isPresent(restoreOptions)) {
            restoreOptions.left = options.left;
            restoreOptions.top = options.top;
        }
        this.window.change.emit(ev);
    }
    handleResize(key) {
        const options = this.window.options;
        if (!options.resizable) {
            return;
        }
        const offset$$1 = this.window.currentOffsetAndPosition();
        let newWidth;
        let newHeight;
        let ev = {};
        let delta = 10;
        if (key === Keys.left || key === Keys.up) {
            delta *= -1;
        }
        switch (key) {
            case Keys.left:
            case Keys.right: {
                newWidth = offset$$1.width + delta;
                if (newWidth !== options.width && newWidth >= options.minWidth) {
                    ev.width = newWidth;
                }
                break;
            }
            case Keys.up:
            case Keys.down: {
                newHeight = offset$$1.height + delta;
                if (newHeight !== options.height && newHeight >= options.minHeight) {
                    ev.height = newHeight;
                }
                break;
            }
            default:
                break;
        }
        if (isPresent(ev.width) || isPresent(ev.height)) {
            OFFSET_STYLES.forEach((style$$1) => {
                if (isPresent(ev[style$$1])) {
                    this.window.options[style$$1] = ev[style$$1];
                }
            });
            this.window.change.emit(ev);
        }
    }
    handleStateChange(key, state$$1) {
        if ((state$$1 === 'minimized' && key === Keys.up) ||
            (state$$1 === 'maximized' && key === Keys.down)) {
            this.window.restoreAction();
            return;
        }
        if (state$$1 === 'default') {
            if (key === Keys.up) {
                this.window.maximizeAction();
            }
            else if (key === Keys.down) {
                this.window.minimizeAction();
            }
        }
    }
};
NavigationService.ɵfac = function NavigationService_Factory(t) { return new (t || NavigationService)(ɵngcc0.ɵɵinject(DragResizeService)); };
NavigationService.ɵprov = /*@__PURE__*/ ɵngcc0.ɵɵdefineInjectable({ token: NavigationService, factory: function (t) { return NavigationService.ɵfac(t); } });
NavigationService = __decorate([ __metadata("design:paramtypes", [DragResizeService])
], NavigationService);

/**
 * Represents the [Kendo UI Window component for Angular]({% slug overview_window_dialogs %}).
 */
let WindowComponent = class WindowComponent {
    constructor(el, renderer, service, navigation, ngZone, localization) {
        this.el = el;
        this.renderer = renderer;
        this.service = service;
        this.navigation = navigation;
        this.ngZone = ngZone;
        this.localization = localization;
        /**
         * Specifies if the content of the component is persisted in the DOM when minimized.
         * @default false
         */
        this.keepContent = false;
        /**
         * Fires when the user starts to move the Window.
         */
        this.dragStart = new EventEmitter();
        /**
         * Fires when the Window was moved by the user.
         */
        this.dragEnd = new EventEmitter();
        /**
         * Fires when the user starts to resize the Window.
         */
        this.resizeStart = new EventEmitter();
        /**
         * Fires when the Window was resized by the user.
         */
        this.resizeEnd = new EventEmitter();
        /**
         * Fires when the user closes the Window.
         */
        this.close = new EventEmitter();
        /**
         * Fires when the `width` property of the component was updated. The event is triggered only after the resizing
         * has ended. The event data contains the new width. Allows a two-way binding of the `width` property.
         */
        this.widthChange = new EventEmitter();
        /**
         * Fires when the `height` property of the component was updated. The event is triggered only after the resizing
         * has ended. The event data contains the new height. Allows a two-way binding of the `height` property.
         */
        this.heightChange = new EventEmitter();
        /**
         * Fires when the `top` property of the component was updated. The event is triggered only after the dragging
         * and resizing have ended. The event data contains the new top offset. Allows a two-way binding of the `top` property.
         */
        this.topChange = new EventEmitter();
        /**
         * Fires when the `left` property of the component was updated. The event is triggered only after the dragging
         * and resizing have ended. The event data contains the new left offset. Allows a two-way binding of the `left` property.
         */
        this.leftChange = new EventEmitter();
        /**
         * Fires when the `state` property of the component was updated. The event data contains the new state. Allows a
         * two-way binding of the `state` property.
         */
        this.stateChange = new EventEmitter();
        this.tabIndex = 0;
        this.draged = false;
        this.resized = false;
        this.windowSubscription = new Subscription();
        validatePackage(packageMetadata);
        this.direction = this.localization.rtl ? 'rtl' : 'ltr';
        this.localizationChangeSubscription = this.localization.changes
            .subscribe(({ rtl }) => this.direction = rtl ? 'rtl' : 'ltr');
        this.resizeDirections = RESIZE_DIRECTIONS;
        this.subscribeEvents();
    }
    /**
     * Specifies whether the user will be able to drag the component.
     * @default true
     */
    set draggable(value) {
        this.options.draggable = value;
    }
    get draggable() {
        return this.options.draggable;
    }
    /**
     * Specifies whether the user will be able to resize the component.
     * @default true
     */
    set resizable(value) {
        this.options.resizable = value;
    }
    get resizable() {
        return this.options.resizable;
    }
    /**
     * Specifies the initial state of the component.
     * If not specified, the value is set to `default`.
     *
     * The possible values are:
     * * `minimized`
     * * `maximized`
     * * `default`
     */
    set state(value) {
        this.options.state = value;
    }
    get state() {
        return this.options.state;
    }
    /**
     * Specifies the minimum width of the component.
     * The `minWidth` property has to be set in pixels.
     * @default 120
     */
    set minWidth(value) {
        this.setOption('minWidth', value);
    }
    get minWidth() {
        return this.options.minWidth;
    }
    /**
     * Specifies the minimum height of the Window.
     * The `minHeight` property has to be set in pixels.
     * @default 100
     */
    set minHeight(value) {
        this.setOption('minHeight', value);
    }
    get minHeight() {
        return this.options.minHeight;
    }
    /**
     * Specifies the width of the Window.
     * The `width` property has to be set in pixels.
     */
    set width(value) {
        this.setOption('width', value);
    }
    get width() {
        return this.options.width;
    }
    /**
     * Specifies the height of the Window.
     * The `height` property has to be set in pixels.
     */
    set height(value) {
        this.setOption('height', value);
    }
    get height() {
        return this.options.height;
    }
    /**
     * Specifies the initial top offset of the Window.
     * The `top` property has to be set in pixels.
     */
    set top(value) {
        this.setOption('top', value);
    }
    get top() {
        return this.options.top;
    }
    /**
     * Specifies the initial left offset of the Window.
     * Numeric values are treated as pixels.
     */
    set left(value) {
        this.setOption('left', value);
    }
    get left() {
        return this.options.left;
    }
    get closeButtonTitle() {
        if (this.messages && this.messages.closeTitle) {
            return this.messages.closeTitle;
        }
        return this.localization.get('closeTitle');
    }
    get restoreButtonTitle() {
        if (this.messages && this.messages.restoreTitle) {
            return this.messages.restoreTitle;
        }
        return this.localization.get('restoreTitle');
    }
    get maximizeButtonTitle() {
        if (this.messages && this.messages.maximizeTitle) {
            return this.messages.maximizeTitle;
        }
        return this.localization.get('maximizeTitle');
    }
    get minimizeButtonTitle() {
        if (this.messages && this.messages.minimizeTitle) {
            return this.messages.minimizeTitle;
        }
        return this.localization.get('minimizeTitle');
    }
    get hostClasses() {
        return true;
    }
    get dir() {
        return this.direction;
    }
    ngAfterViewInit() {
        this.setNextZIndex();
        this.handleInitialFocus();
        this.ngZone.runOutsideAngular(() => Promise.resolve(null).then(() => this.setInitialOffset()));
    }
    ngOnInit() {
        this.renderer.removeAttribute(this.el.nativeElement, 'title');
        this.service.init(this.el);
    }
    ngOnChanges(changes) {
        OFFSET_STYLES.forEach((style$$1) => {
            if (isChanged(style$$1, changes)) {
                this.setStyle(style$$1, this.options[style$$1]);
            }
        });
        if (isChanged('draggable', changes)) {
            const titleBar = isPresent(this.titleBarContent) ? this.titleBarContent : this.titleBarView;
            if (isTruthy(changes.draggable.currentValue)) {
                titleBar.subscribeDrag();
            }
            else {
                titleBar.unsubscribeDrag();
            }
        }
        if (isChanged('state', changes)) {
            if (isPresent(this.service.lastAction)) {
                this.service.lastAction = null;
            }
            else {
                this.service.applyManualState();
                this.updateAllOffset();
            }
        }
    }
    ngOnDestroy() {
        if (this.windowSubscription) {
            this.windowSubscription.unsubscribe();
        }
        this.localizationChangeSubscription.unsubscribe();
    }
    /**
     * Focuses the wrapper of the Window component.
     */
    focus() {
        const wrapper = this.el.nativeElement;
        if (isPresent(wrapper)) {
            wrapper.focus();
        }
    }
    /**
     * Brings the current Window component on top of other Window components on the page.
     */
    bringToFront() {
        this.setNextZIndex();
    }
    /**
     * Manually updates the `width` or `height` option of the Window.
     * The required style will be applied to the Window wrapper element and the
     * corresponding property of the component instance will be updated.
     * This method is intended to be used for sizing dynamically created components using the
     * [`WindowService`]({% slug api_dialog_windowservice %})
     * @param {WindowDimensionSetting} dimension - The option that will be updated
     * @param {number} value - The value set in pixels
     */
    setDimension(dimension, value) {
        this.setOption(dimension, value);
        this.setStyle(dimension, value);
    }
    /**
     * Manually updates the `top` or `left` offset of the Window.
     * The required style will be applied to the Window wrapper element and the
     * corresponding property of the component instance will be updated.
     * This method is intended to be used for positioning dynamically created components using the
     * [`WindowService`]({% slug api_dialog_windowservice %})
     * @param {WindowOffsetSetting} offset - The option that will be updated
     * @param {number} value - The value set in pixels
     */
    setOffset(offset$$1, value) {
        this.setOption(offset$$1, value);
        this.setStyle(offset$$1, value);
    }
    get showDefaultTitleBar() {
        return !isPresent(this.titleBarContent);
    }
    get styleMinWidth() {
        return this.minWidth + 'px';
    }
    get styleMinHeight() {
        return this.minHeight + 'px';
    }
    get stylePosition() {
        return this.options.position;
    }
    get wrapperMaximizedClass() {
        return this.state === 'maximized';
    }
    get wrapperMinimizedClass() {
        return this.state === 'minimized';
    }
    /**
     * @hidden
     */
    onComponentKeydown(event) {
        if (hasClasses(event.target, WINDOW_CLASSES)) {
            this.navigation.process(event);
        }
    }
    /**
     * @hidden
     */
    onComponentFocus() {
        this.renderer.addClass(this.el.nativeElement, 'k-state-focused');
        this.setNextZIndex();
    }
    /**
     * @hidden
     */
    onComponentBlur() {
        this.renderer.removeClass(this.el.nativeElement, 'k-state-focused');
    }
    subscribeEvents() {
        if (!isDocumentAvailable()) {
            return;
        }
        this.windowSubscription.add(this.service.focus.subscribe(() => {
            this.el.nativeElement.focus();
        }));
        this.windowSubscription.add(this.service.dragStart.subscribe(() => {
            this.draged = true;
            this.ngZone.run(() => {
                this.dragStart.emit();
            });
        }));
        this.windowSubscription.add(this.service.dragEnd.subscribe(() => {
            if (this.draged) {
                this.draged = false;
                this.ngZone.run(() => {
                    this.dragEnd.emit();
                });
            }
        }));
        this.windowSubscription.add(this.service.close.subscribe(() => {
            this.close.emit();
        }));
        this.windowSubscription.add(this.service.resizeStart.subscribe(() => {
            this.resized = true;
            this.ngZone.run(() => {
                this.resizeStart.emit();
            });
        }));
        this.windowSubscription.add(this.service.resizeEnd.subscribe(() => {
            if (this.resized) {
                this.resized = false;
                this.ngZone.run(() => {
                    this.resizeEnd.emit();
                });
            }
        }));
        this.windowSubscription.add(this.service.change.subscribe((ev) => {
            OFFSET_STYLES.forEach((style$$1) => {
                if (isPresent(ev[style$$1])) {
                    this.setStyle(style$$1, ev[style$$1]);
                    if (this.state !== 'maximized') {
                        const emitter = this[style$$1 + 'Change'];
                        if (emitter.observers.length) {
                            this.ngZone.run(() => {
                                emitter.emit(ev[style$$1]);
                            });
                        }
                    }
                }
            });
        }));
        this.windowSubscription.add(this.service.stateChange.subscribe((state$$1) => {
            if (isPresent(this.service.lastAction)) {
                this.updateAllOffset();
                this.stateChange.emit(state$$1);
            }
        }));
    }
    setNextZIndex() {
        const currentZIndex = this.el.nativeElement.style['z-index'];
        const nextPossibleZIndex = this.service.nextPossibleZIndex;
        if (!currentZIndex || (nextPossibleZIndex - currentZIndex > 1)) {
            this.renderer.setStyle(this.el.nativeElement, "z-index", this.service.nextZIndex);
        }
    }
    setInitialOffset() {
        if (this.state !== 'maximized') {
            this.updateAllOffset();
            if (!isPresent(this.left) || !isPresent(this.top)) {
                this.service.center();
            }
        }
        else {
            const viewPort = this.service.windowViewPort;
            this.setStyle('width', viewPort.width);
            this.setStyle('height', viewPort.height);
            this.setStyle('top', 0);
            this.setStyle('left', 0);
        }
    }
    updateAllOffset() {
        OFFSET_STYLES.forEach((style$$1) => {
            if (isPresent(this[style$$1])) {
                this.setStyle(style$$1, this[style$$1]);
            }
            else {
                this.removeStyle(style$$1);
            }
        });
    }
    setStyle(style$$1, value) {
        this.renderer.setStyle(this.el.nativeElement, style$$1, value + 'px');
    }
    removeStyle(style$$1) {
        this.renderer.removeStyle(this.el.nativeElement, style$$1);
    }
    get options() {
        return this.service.options;
    }
    setOption(style$$1, value) {
        if (typeof value !== 'number' && typeof value !== 'string') {
            return;
        }
        const parsedValue = (typeof value === 'number') ? value : parseInt(value, 10);
        this.options[style$$1] = parsedValue;
        this.service.setRestoreOption(style$$1, parsedValue);
    }
    handleInitialFocus() {
        const wrapper = this.el.nativeElement;
        if (this.autoFocusedElement) {
            const initiallyFocusedElement = wrapper.querySelector(this.autoFocusedElement);
            if (initiallyFocusedElement) {
                initiallyFocusedElement.focus();
            }
        }
        else {
            this.focus();
        }
    }
};
WindowComponent.ɵfac = function WindowComponent_Factory(t) { return new (t || WindowComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(DragResizeService), ɵngcc0.ɵɵdirectiveInject(NavigationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.LocalizationService)); };
WindowComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: WindowComponent, selectors: [["kendo-window"]], contentQueries: function WindowComponent_ContentQueries(rf, ctx, dirIndex) { if (rf & 1) {
        ɵngcc0.ɵɵcontentQuery(dirIndex, WindowTitleBarComponent, 5);
    } if (rf & 2) {
        let _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.titleBarContent = _t.first);
    } }, viewQuery: function WindowComponent_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵviewQuery(WindowTitleBarComponent, 5);
        ɵngcc0.ɵɵviewQuery(ResizeHandleDirective, 5);
    } if (rf & 2) {
        let _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.titleBarView = _t.first);
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.resizeHandles = _t);
    } }, hostVars: 16, hostBindings: function WindowComponent_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("keydown", function WindowComponent_keydown_HostBindingHandler($event) { return ctx.onComponentKeydown($event); })("focus", function WindowComponent_focus_HostBindingHandler() { return ctx.onComponentFocus(); })("blur", function WindowComponent_blur_HostBindingHandler() { return ctx.onComponentBlur(); });
    } if (rf & 2) {
        ɵngcc0.ɵɵattribute("tabIndex", ctx.tabIndex)("dir", ctx.dir);
        ɵngcc0.ɵɵstyleProp("min-width", ctx.styleMinWidth)("min-height", ctx.styleMinHeight)("position", ctx.stylePosition);
        ɵngcc0.ɵɵclassProp("k-widget", ctx.hostClasses)("k-window", ctx.hostClasses)("k-window-maximized", ctx.wrapperMaximizedClass)("k-window-minimized", ctx.wrapperMinimizedClass);
    } }, inputs: { keepContent: "keepContent", draggable: "draggable", resizable: "resizable", state: "state", minWidth: "minWidth", minHeight: "minHeight", width: "width", height: "height", top: "top", left: "left", autoFocusedElement: "autoFocusedElement", title: "title" }, outputs: { dragStart: "dragStart", dragEnd: "dragEnd", resizeStart: "resizeStart", resizeEnd: "resizeEnd", close: "close", widthChange: "widthChange", heightChange: "heightChange", topChange: "topChange", leftChange: "leftChange", stateChange: "stateChange" }, exportAs: ["kendoWindow"], features: [ɵngcc0.ɵɵProvidersFeature([
            DragResizeService,
            NavigationService,
            LocalizationService,
            {
                provide: L10N_PREFIX,
                useValue: 'kendo.window'
            }
        ]), ɵngcc0.ɵɵNgOnChangesFeature], ngContentSelectors: _c17, decls: 6, vars: 4, consts: function () { let i18n_8; if (typeof ngI18nClosureMode !== "undefined" && ngI18nClosureMode) {
        /**
         * @desc The title of the close button
         * @meaning kendo.window.closeTitle
         */
        const MSG_EXTERNAL_2849207436137160812$$DIST_FESM2015_INDEX_JS_9 = goog.getMsg("Close");
        i18n_8 = MSG_EXTERNAL_2849207436137160812$$DIST_FESM2015_INDEX_JS_9;
    }
    else {
        i18n_8 = $localize `:kendo.window.closeTitle|The title of the close button␟bb50cb526949482fc976fd868573ab283580ee69␟2849207436137160812:Close`;
    } let i18n_10; if (typeof ngI18nClosureMode !== "undefined" && ngI18nClosureMode) {
        /**
         * @desc The title of the restore button
         * @meaning kendo.window.restoreTitle
         */
        const MSG_EXTERNAL_3443120027481340803$$DIST_FESM2015_INDEX_JS_11 = goog.getMsg("Restore");
        i18n_10 = MSG_EXTERNAL_3443120027481340803$$DIST_FESM2015_INDEX_JS_11;
    }
    else {
        i18n_10 = $localize `:kendo.window.restoreTitle|The title of the restore button␟9a9ce231f0396e40adcfa80bfa76e546e0085be0␟3443120027481340803:Restore`;
    } let i18n_12; if (typeof ngI18nClosureMode !== "undefined" && ngI18nClosureMode) {
        /**
         * @desc The title of the maximize button
         * @meaning kendo.window.maximizeTitle
         */
        const MSG_EXTERNAL_7793415109119115257$$DIST_FESM2015_INDEX_JS_13 = goog.getMsg("Maximize");
        i18n_12 = MSG_EXTERNAL_7793415109119115257$$DIST_FESM2015_INDEX_JS_13;
    }
    else {
        i18n_12 = $localize `:kendo.window.maximizeTitle|The title of the maximize button␟42bc654ef8767c5df5277aa88941b94f8d373b4d␟7793415109119115257:Maximize`;
    } let i18n_14; if (typeof ngI18nClosureMode !== "undefined" && ngI18nClosureMode) {
        /**
         * @desc The title of the minimize button
         * @meaning kendo.window.minimizeTitle
         */
        const MSG_EXTERNAL_7581084655285341827$$DIST_FESM2015_INDEX_JS_15 = goog.getMsg("Minimize");
        i18n_14 = MSG_EXTERNAL_7581084655285341827$$DIST_FESM2015_INDEX_JS_15;
    }
    else {
        i18n_14 = $localize `:kendo.window.minimizeTitle|The title of the minimize button␟7ca9f9b41a23760f7f74e91ee4c76d5a5f4a706c␟7581084655285341827:Minimize`;
    } return [["kendoWindowLocalizedMessages", "", "closeTitle", i18n_8, "restoreTitle", i18n_10, "maximizeTitle", i18n_12, "minimizeTitle", i18n_14], [3, "template", 4, "ngIf"], [4, "ngIf"], ["class", "k-content k-window-content", 3, "hidden", 4, "ngIf"], [3, "ngIf"], [3, "template"], [1, "k-window-title"], [1, "k-window-actions"], ["kendoWindowMinimizeAction", ""], ["kendoWindowMaximizeAction", ""], ["kendoWindowRestoreAction", ""], ["kendoWindowCloseAction", ""], [1, "k-content", "k-window-content", 3, "hidden"], [3, "ngTemplateOutlet"], ["kendoWindowResizeHandle", "", "kendoDraggable", "", 3, "direction", 4, "ngFor", "ngForOf"], ["kendoWindowResizeHandle", "", "kendoDraggable", "", 3, "direction"]]; }, template: function WindowComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵprojectionDef(_c16);
        ɵngcc0.ɵɵelementContainerStart(0, 0);
        ɵngcc0.ɵɵelementContainerStart(1);
        ɵngcc0.ɵɵtemplate(2, WindowComponent_kendo_window_titlebar_2_Template, 8, 10, "kendo-window-titlebar", 1);
        ɵngcc0.ɵɵtemplate(3, WindowComponent_ng_content_3_Template, 1, 0, "ng-content", 2);
        ɵngcc0.ɵɵtemplate(4, WindowComponent_div_4_Template, 3, 3, "div", 3);
        ɵngcc0.ɵɵtemplate(5, WindowComponent_ng_template_5_Template, 1, 1, "ng-template", 4);
        ɵngcc0.ɵɵelementContainerEnd();
        ɵngcc0.ɵɵelementContainerEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngIf", ctx.showDefaultTitleBar);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", !ctx.showDefaultTitleBar);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.state !== "minimized" || ctx.keepContent);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.resizable);
    } }, directives: function () { return [LocalizedMessagesDirective, ɵngcc1.NgIf, WindowTitleBarComponent, WindowMinimizeActionDirective, WindowMaximizeActionDirective, WindowRestoreActionDirective, WindowCloseActionDirective, ɵngcc1.NgTemplateOutlet, ɵngcc1.NgForOf, ResizeHandleDirective, ɵngcc3.DraggableDirective]; }, encapsulation: 2 });
__decorate([
    Input(),
    __metadata("design:type", String)
], WindowComponent.prototype, "autoFocusedElement", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], WindowComponent.prototype, "title", void 0);
__decorate([
    Input(),
    __metadata("design:type", Boolean),
    __metadata("design:paramtypes", [Boolean])
], WindowComponent.prototype, "draggable", null);
__decorate([
    Input(),
    __metadata("design:type", Boolean),
    __metadata("design:paramtypes", [Boolean])
], WindowComponent.prototype, "resizable", null);
__decorate([
    Input(),
    __metadata("design:type", Boolean)
], WindowComponent.prototype, "keepContent", void 0);
__decorate([
    Input(),
    __metadata("design:type", String),
    __metadata("design:paramtypes", [String])
], WindowComponent.prototype, "state", null);
__decorate([
    Input(),
    __metadata("design:type", Number),
    __metadata("design:paramtypes", [Number])
], WindowComponent.prototype, "minWidth", null);
__decorate([
    Input(),
    __metadata("design:type", Number),
    __metadata("design:paramtypes", [Number])
], WindowComponent.prototype, "minHeight", null);
__decorate([
    Input(),
    __metadata("design:type", Number),
    __metadata("design:paramtypes", [Number])
], WindowComponent.prototype, "width", null);
__decorate([
    Input(),
    __metadata("design:type", Number),
    __metadata("design:paramtypes", [Number])
], WindowComponent.prototype, "height", null);
__decorate([
    Input(),
    __metadata("design:type", Number),
    __metadata("design:paramtypes", [Number])
], WindowComponent.prototype, "top", null);
__decorate([
    Input(),
    __metadata("design:type", Number),
    __metadata("design:paramtypes", [Number])
], WindowComponent.prototype, "left", null);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], WindowComponent.prototype, "dragStart", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], WindowComponent.prototype, "dragEnd", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], WindowComponent.prototype, "resizeStart", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], WindowComponent.prototype, "resizeEnd", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], WindowComponent.prototype, "close", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], WindowComponent.prototype, "widthChange", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], WindowComponent.prototype, "heightChange", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], WindowComponent.prototype, "topChange", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], WindowComponent.prototype, "leftChange", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], WindowComponent.prototype, "stateChange", void 0);
__decorate([
    HostBinding('attr.tabIndex'),
    __metadata("design:type", Number)
], WindowComponent.prototype, "tabIndex", void 0);
__decorate([
    HostBinding('class.k-widget'),
    HostBinding('class.k-window'),
    __metadata("design:type", Boolean),
    __metadata("design:paramtypes", [])
], WindowComponent.prototype, "hostClasses", null);
__decorate([
    HostBinding('attr.dir'),
    __metadata("design:type", String),
    __metadata("design:paramtypes", [])
], WindowComponent.prototype, "dir", null);
__decorate([
    ViewChild(WindowTitleBarComponent, { static: false }),
    __metadata("design:type", WindowTitleBarComponent)
], WindowComponent.prototype, "titleBarView", void 0);
__decorate([
    ContentChild(WindowTitleBarComponent, { static: false }),
    __metadata("design:type", WindowTitleBarComponent)
], WindowComponent.prototype, "titleBarContent", void 0);
__decorate([
    ViewChildren(ResizeHandleDirective),
    __metadata("design:type", QueryList)
], WindowComponent.prototype, "resizeHandles", void 0);
__decorate([
    HostBinding('style.minWidth'),
    __metadata("design:type", String),
    __metadata("design:paramtypes", [])
], WindowComponent.prototype, "styleMinWidth", null);
__decorate([
    HostBinding('style.minHeight'),
    __metadata("design:type", String),
    __metadata("design:paramtypes", [])
], WindowComponent.prototype, "styleMinHeight", null);
__decorate([
    HostBinding('style.position'),
    __metadata("design:type", String),
    __metadata("design:paramtypes", [])
], WindowComponent.prototype, "stylePosition", null);
__decorate([
    HostBinding('class.k-window-maximized'),
    __metadata("design:type", Boolean),
    __metadata("design:paramtypes", [])
], WindowComponent.prototype, "wrapperMaximizedClass", null);
__decorate([
    HostBinding('class.k-window-minimized'),
    __metadata("design:type", Boolean),
    __metadata("design:paramtypes", [])
], WindowComponent.prototype, "wrapperMinimizedClass", null);
__decorate([
    HostListener('keydown', ['$event']),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", void 0)
], WindowComponent.prototype, "onComponentKeydown", null);
__decorate([
    HostListener('focus'),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", void 0)
], WindowComponent.prototype, "onComponentFocus", null);
__decorate([
    HostListener('blur'),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", void 0)
], WindowComponent.prototype, "onComponentBlur", null);
WindowComponent = __decorate([ __metadata("design:paramtypes", [ElementRef,
        Renderer2,
        DragResizeService,
        NavigationService,
        NgZone,
        LocalizationService])
], WindowComponent);

let WindowMaximizeActionDirective = class WindowMaximizeActionDirective extends Button {
    constructor(el, renderer, _service, localization, ngZone) {
        super(el, renderer, null, localization, ngZone);
        this.buttonType = 'button';
        this.window = _service;
        this.look = 'bare';
        this.icon = 'window-maximize';
    }
    /**
     * @hidden
     */
    onClick() {
        if (!this.isDisabled) {
            this.window.maximizeAction();
        }
    }
    get visible() {
        return this.window.options.state === 'default' ? 'inline-flex' : 'none';
    }
};
WindowMaximizeActionDirective.ɵfac = function WindowMaximizeActionDirective_Factory(t) { return new (t || WindowMaximizeActionDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(DragResizeService, 8), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.LocalizationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone)); };
WindowMaximizeActionDirective.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: WindowMaximizeActionDirective, selectors: [["button", "kendoWindowMaximizeAction", ""]], hostVars: 3, hostBindings: function WindowMaximizeActionDirective_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("click", function WindowMaximizeActionDirective_click_HostBindingHandler() { return ctx.onClick(); });
    } if (rf & 2) {
        ɵngcc0.ɵɵattribute("type", ctx.buttonType);
        ɵngcc0.ɵɵstyleProp("display", ctx.visible);
    } }, inputs: { window: "window" }, exportAs: ["kendoWindowMaximizeAction"], features: [ɵngcc0.ɵɵProvidersFeature([
            LocalizationService,
            {
                provide: L10N_PREFIX,
                useValue: 'kendo.button'
            }
        ]), ɵngcc0.ɵɵInheritDefinitionFeature] });
__decorate([
    Input(),
    __metadata("design:type", Object)
], WindowMaximizeActionDirective.prototype, "window", void 0);
__decorate([
    HostBinding('attr.type'),
    __metadata("design:type", String)
], WindowMaximizeActionDirective.prototype, "buttonType", void 0);
__decorate([
    HostListener('click'),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", void 0)
], WindowMaximizeActionDirective.prototype, "onClick", null);
__decorate([
    HostBinding('style.display'),
    __metadata("design:type", String),
    __metadata("design:paramtypes", [])
], WindowMaximizeActionDirective.prototype, "visible", null);
WindowMaximizeActionDirective = __decorate([ __param(2, Optional()),
    __metadata("design:paramtypes", [ElementRef,
        Renderer2,
        DragResizeService,
        LocalizationService,
        NgZone])
], WindowMaximizeActionDirective);

let WindowMinimizeActionDirective = class WindowMinimizeActionDirective extends Button {
    constructor(el, renderer, _service, localization, ngZone) {
        super(el, renderer, null, localization, ngZone);
        this.buttonType = 'button';
        this.window = _service;
        this.look = 'bare';
        this.icon = 'window-minimize';
    }
    /**
     * @hidden
     */
    onClick() {
        if (!this.isDisabled) {
            this.window.minimizeAction();
        }
    }
    get visible() {
        return this.window.options.state === 'default' ? 'inline-flex' : 'none';
    }
};
WindowMinimizeActionDirective.ɵfac = function WindowMinimizeActionDirective_Factory(t) { return new (t || WindowMinimizeActionDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(DragResizeService, 8), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.LocalizationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone)); };
WindowMinimizeActionDirective.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: WindowMinimizeActionDirective, selectors: [["button", "kendoWindowMinimizeAction", ""]], hostVars: 3, hostBindings: function WindowMinimizeActionDirective_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("click", function WindowMinimizeActionDirective_click_HostBindingHandler() { return ctx.onClick(); });
    } if (rf & 2) {
        ɵngcc0.ɵɵattribute("type", ctx.buttonType);
        ɵngcc0.ɵɵstyleProp("display", ctx.visible);
    } }, inputs: { window: "window" }, exportAs: ["kendoWindowMinimizeAction"], features: [ɵngcc0.ɵɵProvidersFeature([
            LocalizationService,
            {
                provide: L10N_PREFIX,
                useValue: 'kendo.button'
            }
        ]), ɵngcc0.ɵɵInheritDefinitionFeature] });
__decorate([
    Input(),
    __metadata("design:type", Object)
], WindowMinimizeActionDirective.prototype, "window", void 0);
__decorate([
    HostBinding('attr.type'),
    __metadata("design:type", String)
], WindowMinimizeActionDirective.prototype, "buttonType", void 0);
__decorate([
    HostListener('click'),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", void 0)
], WindowMinimizeActionDirective.prototype, "onClick", null);
__decorate([
    HostBinding('style.display'),
    __metadata("design:type", String),
    __metadata("design:paramtypes", [])
], WindowMinimizeActionDirective.prototype, "visible", null);
WindowMinimizeActionDirective = __decorate([ __param(2, Optional()),
    __metadata("design:paramtypes", [ElementRef,
        Renderer2,
        DragResizeService,
        LocalizationService,
        NgZone])
], WindowMinimizeActionDirective);

let WindowCloseActionDirective = class WindowCloseActionDirective extends Button {
    constructor(el, renderer, _service, localization, ngZone) {
        super(el, renderer, null, localization, ngZone);
        this.buttonType = 'button';
        this.window = _service;
        this.look = 'bare';
        this.icon = 'close';
    }
    /**
     * @hidden
     */
    onClick() {
        if (!this.isDisabled) {
            this.window.closeAction();
        }
    }
};
WindowCloseActionDirective.ɵfac = function WindowCloseActionDirective_Factory(t) { return new (t || WindowCloseActionDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(DragResizeService, 8), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.LocalizationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone)); };
WindowCloseActionDirective.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: WindowCloseActionDirective, selectors: [["button", "kendoWindowCloseAction", ""]], hostVars: 1, hostBindings: function WindowCloseActionDirective_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("click", function WindowCloseActionDirective_click_HostBindingHandler() { return ctx.onClick(); });
    } if (rf & 2) {
        ɵngcc0.ɵɵattribute("type", ctx.buttonType);
    } }, inputs: { window: "window" }, exportAs: ["kendoWindowCloseAction"], features: [ɵngcc0.ɵɵProvidersFeature([
            LocalizationService,
            {
                provide: L10N_PREFIX,
                useValue: 'kendo.button'
            }
        ]), ɵngcc0.ɵɵInheritDefinitionFeature] });
__decorate([
    Input(),
    __metadata("design:type", Object)
], WindowCloseActionDirective.prototype, "window", void 0);
__decorate([
    HostBinding('attr.type'),
    __metadata("design:type", String)
], WindowCloseActionDirective.prototype, "buttonType", void 0);
__decorate([
    HostListener('click'),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", void 0)
], WindowCloseActionDirective.prototype, "onClick", null);
WindowCloseActionDirective = __decorate([ __param(2, Optional()),
    __metadata("design:paramtypes", [ElementRef,
        Renderer2,
        DragResizeService,
        LocalizationService,
        NgZone])
], WindowCloseActionDirective);

let WindowRestoreActionDirective = class WindowRestoreActionDirective extends Button {
    constructor(el, renderer, _service, localization, ngZone) {
        super(el, renderer, null, localization, ngZone);
        this.buttonType = 'button';
        this.window = _service;
        this.look = 'bare';
        this.icon = 'window-restore';
    }
    /**
     * @hidden
     */
    onClick() {
        if (!this.isDisabled) {
            this.window.restoreAction();
        }
    }
    get visible() {
        return this.window.options.state === 'default' ? 'none' : 'inline-flex';
    }
};
WindowRestoreActionDirective.ɵfac = function WindowRestoreActionDirective_Factory(t) { return new (t || WindowRestoreActionDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(DragResizeService, 8), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.LocalizationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone)); };
WindowRestoreActionDirective.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: WindowRestoreActionDirective, selectors: [["button", "kendoWindowRestoreAction", ""]], hostVars: 3, hostBindings: function WindowRestoreActionDirective_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("click", function WindowRestoreActionDirective_click_HostBindingHandler() { return ctx.onClick(); });
    } if (rf & 2) {
        ɵngcc0.ɵɵattribute("type", ctx.buttonType);
        ɵngcc0.ɵɵstyleProp("display", ctx.visible);
    } }, inputs: { window: "window" }, exportAs: ["kendoWindowRestoreAction"], features: [ɵngcc0.ɵɵProvidersFeature([
            LocalizationService,
            {
                provide: L10N_PREFIX,
                useValue: 'kendo.button'
            }
        ]), ɵngcc0.ɵɵInheritDefinitionFeature] });
__decorate([
    Input(),
    __metadata("design:type", Object)
], WindowRestoreActionDirective.prototype, "window", void 0);
__decorate([
    HostBinding('attr.type'),
    __metadata("design:type", String)
], WindowRestoreActionDirective.prototype, "buttonType", void 0);
__decorate([
    HostListener('click'),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", void 0)
], WindowRestoreActionDirective.prototype, "onClick", null);
__decorate([
    HostBinding('style.display'),
    __metadata("design:type", String),
    __metadata("design:paramtypes", [])
], WindowRestoreActionDirective.prototype, "visible", null);
WindowRestoreActionDirective = __decorate([ __param(2, Optional()),
    __metadata("design:paramtypes", [ElementRef,
        Renderer2,
        DragResizeService,
        LocalizationService,
        NgZone])
], WindowRestoreActionDirective);

/**
 * The settings for the Window actions when the Window is opened through `WindowService`
 * ([see example]({% slug api_dialog_windowservice %}#toc-open)).
 */
class WindowSettings {
}
/**
 * Indicates that the **Close** button of a Window that is opened through `WindowService` is clicked.
 */
class WindowCloseResult {
}
/**
 * Holds references to the object instance of the Window.
 * Controls the Windows that were opened through `WindowService`
 * ([see example]({% slug api_dialog_windowservice %}#toc-open)).
 */
class WindowRef {
}

var WindowContainerService_1;
/**
 * @hidden
 */
let WindowContainerService = WindowContainerService_1 = class WindowContainerService {
    set container(container) {
        WindowContainerService_1.container = container;
    }
    get container() {
        return WindowContainerService_1.container;
    }
};
WindowContainerService.ɵfac = function WindowContainerService_Factory(t) { return new (t || WindowContainerService)(); };
WindowContainerService.ɵprov = /*@__PURE__*/ ɵngcc0.ɵɵdefineInjectable({ token: WindowContainerService, factory: function (t) { return WindowContainerService.ɵfac(t); } });
WindowContainerService.container = null;

const isNotComponent$1 = (component) => isString(component) || component instanceof TemplateRef;
class WindowInjector {
    constructor(getWindowRef, parentInjector) {
        this.getWindowRef = getWindowRef;
        this.parentInjector = parentInjector;
    }
    get(token, notFoundValue) {
        if (token === WindowRef) {
            return this.getWindowRef();
        }
        return this.parentInjector.get(token, notFoundValue);
    }
}
/**
 * A service for opening Windows dynamically
 * ([see example]({% slug service_window %})).
 */
let WindowService = class WindowService {
    constructor(
    /**
     * @hidden
     */
    resolver, containerService) {
        this.resolver = resolver;
        this.containerService = containerService;
    }
    /**
     * Opens a Window component.
     *
     * @param {WindowSettings} settings - The settings that define the Window.
     * @returns {WindowRef} - A reference to the Window object.
     *
     * @example
     *
     * ```ts-no-run
     * _@Component({
     *   selector: 'my-app',
     *   template: `
     *     <button kendoButton (click)="open()">Open window</button>
     *     <div kendoWindowContainer></div>
     *   `
     * })
     * export class AppComponent {
     *     constructor( private windowService: WindowService ) {}
     *
     *     public open() {
     *         var window = this.windowService.open({
     *           title: "My window",
     *           content: "My content!"
     *         });
     *
     *         window.result.subscribe((result) => {
     *           if (result instanceof WindowCloseResult) {
     *             console.log("Window was closed");
     *           }
     *         });
     *     }
     * }
     * ```
     *
     */
    open(settings) {
        const factory = this.resolver.resolveComponentFactory(WindowComponent);
        const container = settings.appendTo || this.containerService.container;
        if (!container) {
            throw new Error(`Cannot attach window to the page.
                Add an element that uses the kendoWindowContainer directive, or set the 'appendTo' property.
                See https://www.telerik.com/kendo-angular-ui/components/dialogs/window/service/
            `);
        }
        const windowRef = {
            close: () => { },
            content: null,
            result: null,
            window: null
        };
        const content = this.contentFrom(settings.content, container, windowRef);
        const window = container.createComponent(factory, undefined, undefined, content.nodes);
        windowRef.window = window;
        this.applyOptions(window.instance, settings);
        const apiClose = new Subject();
        const close = (e) => {
            apiClose.next(e || new WindowCloseResult());
            if (content.componentRef) {
                content.componentRef.destroy();
            }
            window.destroy();
        };
        const result = merge(apiClose, window.instance.close.pipe(map(e => (e ? e : new WindowCloseResult())), filter((e) => {
            if (settings.preventClose) {
                // add windowRef only when using component
                const windowRefParameter = isNotComponent$1(settings.content) ? undefined : windowRef;
                return !settings.preventClose(e, windowRefParameter);
            }
            return true;
        }))).pipe(take(1), 
        // Takes care for multiple subscriptions:
        // We subscribe internally and the user may subscribe to get a close result - window.result.subscribe().
        // This causes multiple subscriptions to the same source and thus multiple emissions. share() solves that.
        share());
        result.subscribe(close);
        windowRef.close = close;
        windowRef.result = result;
        window.changeDetectorRef.markForCheck();
        return windowRef;
    }
    applyOptions(instance, options) {
        if (isPresent(options.title)) {
            instance.title = options.title;
        }
        if (isPresent(options.keepContent)) {
            instance.keepContent = options.keepContent;
        }
        if (isPresent(options.width)) {
            instance.width = options.width;
        }
        if (isPresent(options.minWidth)) {
            instance.minWidth = options.minWidth;
        }
        if (isPresent(options.height)) {
            instance.height = options.height;
        }
        if (isPresent(options.minHeight)) {
            instance.minHeight = options.minHeight;
        }
        if (isPresent(options.left)) {
            instance.left = options.left;
        }
        if (isPresent(options.top)) {
            instance.top = options.top;
        }
        if (isPresent(options.draggable)) {
            instance.draggable = options.draggable;
        }
        if (isPresent(options.resizable)) {
            instance.resizable = options.resizable;
        }
        if (isPresent(options.messages && options.messages.closeTitle)) {
            instance.messages.closeTitle = options.messages.closeTitle;
        }
        if (isPresent(options.messages && options.messages.restoreTitle)) {
            instance.messages.restoreTitle = options.messages.restoreTitle;
        }
        if (isPresent(options.messages && options.messages.maximizeTitle)) {
            instance.messages.maximizeTitle = options.messages.maximizeTitle;
        }
        if (isPresent(options.messages && options.messages.minimizeTitle)) {
            instance.messages.minimizeTitle = options.messages.minimizeTitle;
        }
        if (isPresent(options.autoFocusedElement)) {
            instance.autoFocusedElement = options.autoFocusedElement;
        }
        if (isPresent(options.state)) {
            instance.state = options.state;
            if (options.state === 'minimized') {
                instance.keepContent = true;
            }
        }
        if (options.content instanceof TemplateRef) {
            instance.contentTemplate = options.content;
        }
        if (options.titleBarContent instanceof TemplateRef) {
            instance.titleBarTemplate = options.titleBarContent;
        }
    }
    contentFrom(content, container, windowRef) {
        const renderer = container.injector.get(Renderer2);
        let nodes = [];
        let componentRef = null;
        if (typeof content === 'string') {
            nodes = [renderer.createText(content)];
        }
        else if (content && !(content instanceof TemplateRef)) {
            const injector = new WindowInjector(() => windowRef, container.injector);
            const factory = this.resolver.resolveComponentFactory(content);
            componentRef = container.createComponent(factory, undefined, injector);
            nodes = [componentRef.location.nativeElement];
            windowRef.content = componentRef;
        }
        return {
            componentRef,
            nodes: [
                [],
                nodes // Content
            ]
        };
    }
};
WindowService.ɵfac = function WindowService_Factory(t) { return new (t || WindowService)(ɵngcc0.ɵɵinject(ɵngcc0.ComponentFactoryResolver), ɵngcc0.ɵɵinject(WindowContainerService)); };
WindowService.ɵprov = /*@__PURE__*/ ɵngcc0.ɵɵdefineInjectable({ token: WindowService, factory: function (t) { return WindowService.ɵfac(t); } });
WindowService = __decorate([ __param(1, Inject(WindowContainerService)),
    __metadata("design:paramtypes", [ComponentFactoryResolver,
        WindowContainerService])
], WindowService);

/**
 * Provides an insertion point for the Dialogs which are created through the
 * Dialog service ([see example]({% slug api_dialog_dialogservice %}#toc-open)).
 * Created Dialogs will be mounted after that element.
 *
 * @example
 * ```html-no-run
 * <div kendoDialogContainer></div>
 * ```
 */
let DialogContainerDirective = class DialogContainerDirective {
    constructor(container, service) {
        service.container = container;
    }
};
DialogContainerDirective.ɵfac = function DialogContainerDirective_Factory(t) { return new (t || DialogContainerDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ViewContainerRef), ɵngcc0.ɵɵdirectiveInject(DialogContainerService)); };
DialogContainerDirective.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: DialogContainerDirective, selectors: [["", "kendoDialogContainer", ""]] });
DialogContainerDirective = __decorate([ __metadata("design:paramtypes", [ViewContainerRef,
        DialogContainerService])
], DialogContainerDirective);

/**
 * @hidden
 */
class Messages extends ComponentMessages {
}
Messages.ɵfac = /*@__PURE__*/ function () { let ɵMessages_BaseFactory; return function Messages_Factory(t) { return (ɵMessages_BaseFactory || (ɵMessages_BaseFactory = ɵngcc0.ɵɵgetInheritedFactory(Messages)))(t || Messages); }; }();
Messages.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: Messages, inputs: { closeTitle: "closeTitle", restoreTitle: "restoreTitle", maximizeTitle: "maximizeTitle", minimizeTitle: "minimizeTitle" }, features: [ɵngcc0.ɵɵInheritDefinitionFeature] });
__decorate([
    Input(),
    __metadata("design:type", String)
], Messages.prototype, "closeTitle", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], Messages.prototype, "restoreTitle", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], Messages.prototype, "maximizeTitle", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], Messages.prototype, "minimizeTitle", void 0);

var LocalizedMessagesDirective_1;
/**
 * @hidden
 */
let LocalizedMessagesDirective = LocalizedMessagesDirective_1 = class LocalizedMessagesDirective extends Messages {
    constructor(service) {
        super();
        this.service = service;
    }
};
LocalizedMessagesDirective.ɵfac = function LocalizedMessagesDirective_Factory(t) { return new (t || LocalizedMessagesDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc2.LocalizationService)); };
LocalizedMessagesDirective.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: LocalizedMessagesDirective, selectors: [["", "kendoDialogLocalizedMessages", ""], ["", "kendoWindowLocalizedMessages", ""], ["", "kendoDialogTitleBarLocalizedMessages", ""]], features: [ɵngcc0.ɵɵProvidersFeature([
            {
                provide: Messages,
                useExisting: forwardRef(() => LocalizedMessagesDirective_1)
            }
        ]), ɵngcc0.ɵɵInheritDefinitionFeature] });
LocalizedMessagesDirective = LocalizedMessagesDirective_1 = __decorate([ __metadata("design:paramtypes", [LocalizationService])
], LocalizedMessagesDirective);

var CustomMessagesComponent_1;
/**
 * Custom component messages override default component messages
 * ([see example]({% slug globalization_dialogs %}#toc-localization)).
 */
let CustomMessagesComponent = CustomMessagesComponent_1 = class CustomMessagesComponent extends Messages {
    constructor(service) {
        super();
        this.service = service;
    }
    get override() {
        return true;
    }
};
CustomMessagesComponent.ɵfac = function CustomMessagesComponent_Factory(t) { return new (t || CustomMessagesComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc2.LocalizationService)); };
CustomMessagesComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: CustomMessagesComponent, selectors: [["kendo-dialog-messages"], ["kendo-window-messages"]], features: [ɵngcc0.ɵɵProvidersFeature([
            {
                provide: Messages,
                useExisting: forwardRef(() => CustomMessagesComponent_1) // tslint:disable-line:no-forward-ref
            }
        ]), ɵngcc0.ɵɵInheritDefinitionFeature], decls: 0, vars: 0, template: function CustomMessagesComponent_Template(rf, ctx) { }, encapsulation: 2 });
CustomMessagesComponent = CustomMessagesComponent_1 = __decorate([ __metadata("design:paramtypes", [LocalizationService])
], CustomMessagesComponent);

/**
 * @hidden
 */
const SHARED_DIRECTIVES = [
    DialogActionsComponent,
    CustomMessagesComponent,
    LocalizedMessagesDirective
];
/**
 * @hidden
 */
let SharedModule = class SharedModule {
};
SharedModule.ɵfac = function SharedModule_Factory(t) { return new (t || SharedModule)(); };
SharedModule.ɵmod = /*@__PURE__*/ ɵngcc0.ɵɵdefineNgModule({ type: SharedModule });
SharedModule.ɵinj = /*@__PURE__*/ ɵngcc0.ɵɵdefineInjector({ imports: [[CommonModule], CommonModule] });

/**
 * @hidden
 */
const DIALOG_DIRECTIVES = [
    DialogComponent,
    DialogTitleBarComponent
];
/**
 * Represents the [NgModule]({{ site.data.urls.angular['ngmoduleapi'] }})
 * definition for the Dialog component that includes all Dialog components and directives.
 * Imports `DialogModule` into the [root module]({{ site.data.urls.angular['ngmodules'] }}#angular-modularity)
 * of your application or into any other sub-module that will use the Dialog component.
 *
 * @example
 * ```ts-no-run
 * import { NgModule } from '@angular/core';
 * import { BrowserModule } from '@angular/platform-browser';
 * import { DialogModule } from '@progress/kendo-angular-dialog';
 * import { AppComponent } from './app.component';
 *
 * _@NgModule({
 *     bootstrap:    [AppComponent],
 *     declarations: [AppComponent],
 *     imports:      [BrowserModule, DialogModule]
 * })
 * export class AppModule {
 * }
 * ```
 */
let DialogModule = class DialogModule {
};
DialogModule.ɵfac = function DialogModule_Factory(t) { return new (t || DialogModule)(); };
DialogModule.ɵmod = /*@__PURE__*/ ɵngcc0.ɵɵdefineNgModule({ type: DialogModule });
DialogModule.ɵinj = /*@__PURE__*/ ɵngcc0.ɵɵdefineInjector({ providers: [DialogContainerService, DialogService], imports: [[SharedModule]] });

/**
 * Provides an insertion point for the Windows which are created through the
 * Window service ([see example]({% slug api_dialog_windowservice %}#toc-open)).
 * Created Windows will be mounted after that element.
 *
 * @example
 * ```html-no-run
 * <div kendoWindowContainer></div>
 * ```
 */
let WindowContainerDirective = class WindowContainerDirective {
    constructor(container, service) {
        service.container = container;
    }
};
WindowContainerDirective.ɵfac = function WindowContainerDirective_Factory(t) { return new (t || WindowContainerDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ViewContainerRef), ɵngcc0.ɵɵdirectiveInject(WindowContainerService)); };
WindowContainerDirective.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: WindowContainerDirective, selectors: [["", "kendoWindowContainer", ""]] });
WindowContainerDirective = __decorate([ __metadata("design:paramtypes", [ViewContainerRef,
        WindowContainerService])
], WindowContainerDirective);

const WINDOW_DIRECTIVES = [
    ResizeHandleDirective,
    WindowComponent,
    WindowTitleBarComponent,
    WindowCloseActionDirective,
    WindowMinimizeActionDirective,
    WindowMaximizeActionDirective,
    WindowRestoreActionDirective
];
const ENTRY_COMPONENTS = [
    WindowComponent,
    WindowTitleBarComponent
];
const exportedModules = [
    WindowComponent,
    WindowCloseActionDirective,
    WindowMinimizeActionDirective,
    WindowMaximizeActionDirective,
    WindowRestoreActionDirective,
    WindowTitleBarComponent
];
/**
 * Represents the [NgModule]({{ site.data.urls.angular['ngmoduleapi'] }})
 * definition for the Window component. Imports `WindowModule` into the
 * [root module]({{ site.data.urls.angular['ngmodules'] }}#angular-modularity)
 * of your application or into any other sub-module that will use the Window component.
 *
 * @example
 * ```ts-no-run
 * import { NgModule } from '@angular/core';
 * import { BrowserModule } from '@angular/platform-browser';
 * import { WindowModule } from '@progress/kendo-angular-window';
 * import { AppComponent } from './app.component';
 *
 * _@NgModule({
 *     bootstrap:    [AppComponent],
 *     declarations: [AppComponent],
 *     imports:      [BrowserModule, WindowModule]
 * })
 * export class AppModule {
 * }
 * ```
 */
let WindowModule = class WindowModule {
};
WindowModule.ɵfac = function WindowModule_Factory(t) { return new (t || WindowModule)(); };
WindowModule.ɵmod = /*@__PURE__*/ ɵngcc0.ɵɵdefineNgModule({ type: WindowModule });
WindowModule.ɵinj = /*@__PURE__*/ ɵngcc0.ɵɵdefineInjector({ providers: [WindowContainerService, WindowService], imports: [[SharedModule, DraggableModule]] });

/**
 * Represents the [NgModule]({{ site.data.urls.angular['ngmoduleapi'] }})
 * definition for the Dialogs components.
 *
 * @example
 *
 * ```ts-no-run
 * import { DialogsModule } from '@progress/kendo-angular-dialog';
 *
 * import { platformBrowserDynamic } from '@angular/platform-browser-dynamic';
 * import { NgModule } from '@angular/core';
 *
 * import { AppComponent } from './app.component';
 *
 * _@NgModule({
 *     declarations: [AppComponent],
 *     imports:      [BrowserModule, DialogsModule],
 *     bootstrap:    [AppComponent]
 * })
 * export class AppModule {}
 *
 * platformBrowserDynamic().bootstrapModule(AppModule);
 *
 * ```
 */
let DialogsModule = class DialogsModule {
};
DialogsModule.ɵfac = function DialogsModule_Factory(t) { return new (t || DialogsModule)(); };
DialogsModule.ɵmod = /*@__PURE__*/ ɵngcc0.ɵɵdefineNgModule({ type: DialogsModule });
DialogsModule.ɵinj = /*@__PURE__*/ ɵngcc0.ɵɵdefineInjector({ imports: [DialogModule, WindowModule] });
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(DialogActionsComponent, [{
        type: Component,
        args: [{
                selector: 'kendo-dialog-actions',
                template: `
        <ng-content *ngIf="!actions"></ng-content>
        <ng-container *ngIf="!actionTemplate()">
            <button
                type="button"
                [ngClass]="buttonClass(action)"
                (click)="onButtonClick(action, $event)"
                *ngFor="let action of actions"
                [attr.aria-label]="action.text"
            >
                {{ action.text }}
            </button>
        </ng-container>
        <ng-template [ngTemplateOutlet]="actions" *ngIf="actionTemplate()"></ng-template>
    `
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }]; }, { layout: [{
            type: Input
        }], action: [{
            type: Output
        }], buttonGroupClassName: [{
            type: HostBinding,
            args: ['class.k-dialog-buttongroup']
        }, {
            type: HostBinding,
            args: ['class.k-actions']
        }], className: [{
            type: HostBinding,
            args: ['class.k-actions-stretched']
        }], actions: [{
            type: Input
        }] }); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(DialogTitleBarComponent, [{
        type: Component,
        args: [{
                selector: 'kendo-dialog-titlebar',
                providers: [
                    TitleBarLocalizationService,
                    {
                        provide: LocalizationService,
                        useExisting: TitleBarLocalizationService
                    },
                    {
                        provide: L10N_PREFIX,
                        useValue: 'kendo.dialog'
                    }
                ],
                template: `
         <ng-container
            kendoDialogTitleBarLocalizedMessages
            i18n-closeTitle="kendo.dialog.closeTitle|The title of the close button"
            closeTitle="Close"
        >
            <div class="k-window-title k-dialog-title">
                <ng-content></ng-content>
            </div>

            <div class="k-window-actions k-dialog-actions">
                <a
                    href="#"
                    role="button"
                    [attr.title]="closeButtonTitle"
                    [attr.aria-label]="closeButtonTitle"
                    class="k-button k-flat k-button-icon k-window-action k-dialog-action k-dialog-close"
                    (click)="onCloseClick($event)"
                >
                    <span class="k-icon k-i-x"></span>
                </a>
            </div>
        </ng-container>
    `
            }]
    }], function () { return [{ type: ɵngcc0.NgZone }, { type: ɵngcc0.ElementRef }, { type: ɵngcc2.LocalizationService, decorators: [{
                type: Optional
            }] }]; }, { close: [{
            type: Output
        }], className: [{
            type: HostBinding,
            args: ['class.k-window-titlebar']
        }, {
            type: HostBinding,
            args: ['class.k-dialog-titlebar']
        }], id: [{
            type: Input
        }], closeTitle: [{
            type: Input
        }] }); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(DialogComponent, [{
        type: Component,
        args: [{
                animations: [
                    trigger('overlayAppear', [
                        state('in', style({ opacity: 1 })),
                        transition('void => *', [style({ opacity: 0.1 }), animate('.3s cubic-bezier(.2, .6, .4, 1)')])
                    ]),
                    trigger('dialogSlideInAppear', [
                        state('in', style({ transform: 'translate(0, 0)' })),
                        transition('void => *', [style({ transform: 'translate(0, -10%)' }), animate('.3s cubic-bezier(.2, 1, .2, 1)')])
                    ])
                ],
                exportAs: 'kendoDialog',
                providers: [
                    LocalizationService,
                    {
                        provide: DIALOG_LOCALIZATION_SERVICE,
                        useExisting: LocalizationService
                    },
                    {
                        provide: L10N_PREFIX,
                        useValue: 'kendo.dialog'
                    }
                ],
                selector: 'kendo-dialog',
                template: `
        <ng-container
            kendoDialogLocalizedMessages
            i18n-closeTitle="kendo.dialog.closeTitle|The title of the close button"
            closeTitle="Close"
        >
        <div class="k-overlay" @overlayAppear></div>

        <div class="k-widget k-window k-dialog" role="dialog" [ngStyle]="styles" @dialogSlideInAppear>
            <kendo-dialog-titlebar *ngIf="title" [closeTitle]="closeTitle" [id]="titleId">{{ title }}</kendo-dialog-titlebar>
            <ng-content select="kendo-dialog-titlebar" *ngIf="!title"></ng-content>

            <div class="k-content k-window-content k-dialog-content">
                <ng-content *ngIf="!contentTemplate"></ng-content>
                <ng-template [ngTemplateOutlet]="contentTemplate" *ngIf="contentTemplate"></ng-template>
            </div>

            <ng-content select="kendo-dialog-actions" *ngIf="!actions"></ng-content>
            <kendo-dialog-actions *ngIf="actions" [actions]="actions" [layout]="actionsLayout"> </kendo-dialog-actions>
        </div>
    </ng-container>
    `
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: ɵngcc0.Renderer2 }, { type: ɵngcc2.LocalizationService }, { type: ɵngcc0.ChangeDetectorRef }, { type: ɵngcc0.NgZone }]; }, { actionsLayout: [{
            type: Input
        }], action: [{
            type: Output
        }], close: [{
            type: Output
        }], tabIndex: [{
            type: HostBinding,
            args: ['attr.tabIndex']
        }], dir: [{
            type: HostBinding,
            args: ['attr.dir']
        }], 
    /**
     * @hidden
     */
    onComponentKeydown: [{
            type: HostListener,
            args: ['keydown', ['$event']]
        }], wrapperClass: [{
            type: HostBinding,
            args: ['class.k-dialog-wrapper']
        }], actions: [{
            type: Input
        }], autoFocusedElement: [{
            type: Input
        }], title: [{
            type: Input
        }], width: [{
            type: Input
        }], minWidth: [{
            type: Input
        }], maxWidth: [{
            type: Input
        }], height: [{
            type: Input
        }], minHeight: [{
            type: Input
        }], maxHeight: [{
            type: Input
        }], titlebarContent: [{
            type: ContentChildren,
            args: [DialogTitleBarComponent, { descendants: false }]
        }], titlebarView: [{
            type: ViewChild,
            args: [DialogTitleBarComponent, { static: false }]
        }], actionsView: [{
            type: ViewChild,
            args: [DialogActionsComponent, { static: false }]
        }] }); })();

(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(DialogContainerService, [{
        type: Injectable
    }], null, null); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(DialogService, [{
        type: Injectable
    }], function () { return [{ type: ɵngcc0.ComponentFactoryResolver }, { type: DialogContainerService, decorators: [{
                type: Inject,
                args: [DialogContainerService]
            }] }]; }, null); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(DragResizeService, [{
        type: Injectable
    }], function () { return [{ type: ɵngcc0.NgZone }]; }, null); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(ResizeHandleDirective, [{
        type: Directive,
        args: [{
                selector: '[kendoWindowResizeHandle]'
            }]
    }], function () { return [{ type: ɵngcc3.DraggableDirective, decorators: [{
                type: Host
            }] }, { type: ɵngcc0.ElementRef }, { type: ɵngcc0.Renderer2 }, { type: DragResizeService }]; }, { hostClass: [{
            type: HostBinding,
            args: ['class.k-resize-handle']
        }], direction: [{
            type: Input
        }] }); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(WindowTitleBarComponent, [{
        type: Component,
        args: [{
                selector: 'kendo-window-titlebar',
                template: `
    <ng-content *ngIf="!template"></ng-content>
    <ng-template
      [ngTemplateOutlet]="template"
      [ngTemplateOutletContext]="{'$implicit': service}" *ngIf="template">
    </ng-template>
  `
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: DragResizeService }, { type: ɵngcc0.NgZone }]; }, { className: [{
            type: HostBinding,
            args: ['class.k-window-titlebar']
        }, {
            type: HostBinding,
            args: ['class.k-dialog-titlebar']
        }], touchAction: [{
            type: HostBinding,
            args: ['style.touch-action']
        }], 
    /**
     * @hidden
     */
    handle: [{
            type: HostListener,
            args: ['dblclick', ['$event']]
        }], template: [{
            type: Input
        }] }); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(NavigationService, [{
        type: Injectable
    }], function () { return [{ type: DragResizeService }]; }, null); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(WindowComponent, [{
        type: Component,
        args: [{
                exportAs: 'kendoWindow',
                providers: [
                    DragResizeService,
                    NavigationService,
                    LocalizationService,
                    {
                        provide: L10N_PREFIX,
                        useValue: 'kendo.window'
                    }
                ],
                selector: 'kendo-window',
                template: `
        <ng-container kendoWindowLocalizedMessages
            i18n-closeTitle="kendo.window.closeTitle|The title of the close button"
            closeTitle="Close"

            i18n-restoreTitle="kendo.window.restoreTitle|The title of the restore button"
            restoreTitle="Restore"

            i18n-maximizeTitle="kendo.window.maximizeTitle|The title of the maximize button"
            maximizeTitle="Maximize"

            i18n-minimizeTitle="kendo.window.minimizeTitle|The title of the minimize button"
            minimizeTitle="Minimize"
        >
        <ng-container>

        <kendo-window-titlebar *ngIf="showDefaultTitleBar" [template]="titleBarTemplate">
            <div class="k-window-title">{{ title }}</div>
            <div class="k-window-actions">
                <button kendoWindowMinimizeAction  [attr.title]="minimizeButtonTitle" [attr.aria-label]="minimizeButtonTitle"></button>
                <button kendoWindowMaximizeAction [attr.title]="maximizeButtonTitle" [attr.aria-label]="maximizeButtonTitle"></button>
                <button kendoWindowRestoreAction [attr.title]="restoreButtonTitle" [attr.aria-label]="restoreButtonTitle"></button>
                <button kendoWindowCloseAction [attr.title]="closeButtonTitle" [attr.aria-label]="closeButtonTitle"></button>
            </div>
        </kendo-window-titlebar>
        <ng-content select="kendo-window-titlebar" *ngIf="!showDefaultTitleBar"></ng-content>

        <div *ngIf="state !== 'minimized' || keepContent"
            [hidden]="state === 'minimized' && keepContent"
            class="k-content k-window-content"
        >
            <ng-content *ngIf="!contentTemplate"></ng-content>
            <ng-template [ngTemplateOutlet]="contentTemplate" *ngIf="contentTemplate"></ng-template>
        </div>

        <ng-template [ngIf]='resizable'>
            <div *ngFor='let dir of resizeDirections'
                [direction]="dir"
                kendoWindowResizeHandle
                kendoDraggable>
            </div>
        </ng-template>
    `
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: ɵngcc0.Renderer2 }, { type: DragResizeService }, { type: NavigationService }, { type: ɵngcc0.NgZone }, { type: ɵngcc2.LocalizationService }]; }, { keepContent: [{
            type: Input
        }], dragStart: [{
            type: Output
        }], dragEnd: [{
            type: Output
        }], resizeStart: [{
            type: Output
        }], resizeEnd: [{
            type: Output
        }], close: [{
            type: Output
        }], widthChange: [{
            type: Output
        }], heightChange: [{
            type: Output
        }], topChange: [{
            type: Output
        }], leftChange: [{
            type: Output
        }], stateChange: [{
            type: Output
        }], tabIndex: [{
            type: HostBinding,
            args: ['attr.tabIndex']
        }], draggable: [{
            type: Input
        }], resizable: [{
            type: Input
        }], state: [{
            type: Input
        }], minWidth: [{
            type: Input
        }], minHeight: [{
            type: Input
        }], width: [{
            type: Input
        }], height: [{
            type: Input
        }], top: [{
            type: Input
        }], left: [{
            type: Input
        }], hostClasses: [{
            type: HostBinding,
            args: ['class.k-widget']
        }, {
            type: HostBinding,
            args: ['class.k-window']
        }], dir: [{
            type: HostBinding,
            args: ['attr.dir']
        }], styleMinWidth: [{
            type: HostBinding,
            args: ['style.minWidth']
        }], styleMinHeight: [{
            type: HostBinding,
            args: ['style.minHeight']
        }], stylePosition: [{
            type: HostBinding,
            args: ['style.position']
        }], wrapperMaximizedClass: [{
            type: HostBinding,
            args: ['class.k-window-maximized']
        }], wrapperMinimizedClass: [{
            type: HostBinding,
            args: ['class.k-window-minimized']
        }], 
    /**
     * @hidden
     */
    onComponentKeydown: [{
            type: HostListener,
            args: ['keydown', ['$event']]
        }], 
    /**
     * @hidden
     */
    onComponentFocus: [{
            type: HostListener,
            args: ['focus']
        }], 
    /**
     * @hidden
     */
    onComponentBlur: [{
            type: HostListener,
            args: ['blur']
        }], autoFocusedElement: [{
            type: Input
        }], title: [{
            type: Input
        }], titleBarView: [{
            type: ViewChild,
            args: [WindowTitleBarComponent, { static: false }]
        }], titleBarContent: [{
            type: ContentChild,
            args: [WindowTitleBarComponent, { static: false }]
        }], resizeHandles: [{
            type: ViewChildren,
            args: [ResizeHandleDirective]
        }] }); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(WindowMaximizeActionDirective, [{
        type: Directive,
        args: [{
                exportAs: 'kendoWindowMaximizeAction',
                providers: [
                    LocalizationService,
                    {
                        provide: L10N_PREFIX,
                        useValue: 'kendo.button'
                    }
                ],
                selector: 'button[kendoWindowMaximizeAction]' // tslint:disable-line
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: ɵngcc0.Renderer2 }, { type: DragResizeService, decorators: [{
                type: Optional
            }] }, { type: ɵngcc2.LocalizationService }, { type: ɵngcc0.NgZone }]; }, { buttonType: [{
            type: HostBinding,
            args: ['attr.type']
        }], window: [{
            type: Input
        }], 
    /**
     * @hidden
     */
    onClick: [{
            type: HostListener,
            args: ['click']
        }], visible: [{
            type: HostBinding,
            args: ['style.display']
        }] }); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(WindowMinimizeActionDirective, [{
        type: Directive,
        args: [{
                exportAs: 'kendoWindowMinimizeAction',
                providers: [
                    LocalizationService,
                    {
                        provide: L10N_PREFIX,
                        useValue: 'kendo.button'
                    }
                ],
                selector: 'button[kendoWindowMinimizeAction]' // tslint:disable-line
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: ɵngcc0.Renderer2 }, { type: DragResizeService, decorators: [{
                type: Optional
            }] }, { type: ɵngcc2.LocalizationService }, { type: ɵngcc0.NgZone }]; }, { buttonType: [{
            type: HostBinding,
            args: ['attr.type']
        }], window: [{
            type: Input
        }], 
    /**
     * @hidden
     */
    onClick: [{
            type: HostListener,
            args: ['click']
        }], visible: [{
            type: HostBinding,
            args: ['style.display']
        }] }); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(WindowCloseActionDirective, [{
        type: Directive,
        args: [{
                exportAs: 'kendoWindowCloseAction',
                providers: [
                    LocalizationService,
                    {
                        provide: L10N_PREFIX,
                        useValue: 'kendo.button'
                    }
                ],
                selector: 'button[kendoWindowCloseAction]' // tslint:disable-line
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: ɵngcc0.Renderer2 }, { type: DragResizeService, decorators: [{
                type: Optional
            }] }, { type: ɵngcc2.LocalizationService }, { type: ɵngcc0.NgZone }]; }, { buttonType: [{
            type: HostBinding,
            args: ['attr.type']
        }], window: [{
            type: Input
        }], 
    /**
     * @hidden
     */
    onClick: [{
            type: HostListener,
            args: ['click']
        }] }); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(WindowRestoreActionDirective, [{
        type: Directive,
        args: [{
                exportAs: 'kendoWindowRestoreAction',
                providers: [
                    LocalizationService,
                    {
                        provide: L10N_PREFIX,
                        useValue: 'kendo.button'
                    }
                ],
                selector: 'button[kendoWindowRestoreAction]' // tslint:disable-line
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: ɵngcc0.Renderer2 }, { type: DragResizeService, decorators: [{
                type: Optional
            }] }, { type: ɵngcc2.LocalizationService }, { type: ɵngcc0.NgZone }]; }, { buttonType: [{
            type: HostBinding,
            args: ['attr.type']
        }], window: [{
            type: Input
        }], 
    /**
     * @hidden
     */
    onClick: [{
            type: HostListener,
            args: ['click']
        }], visible: [{
            type: HostBinding,
            args: ['style.display']
        }] }); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(WindowContainerService, [{
        type: Injectable
    }], null, null); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(WindowService, [{
        type: Injectable
    }], function () { return [{ type: ɵngcc0.ComponentFactoryResolver }, { type: WindowContainerService, decorators: [{
                type: Inject,
                args: [WindowContainerService]
            }] }]; }, null); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(DialogContainerDirective, [{
        type: Directive,
        args: [{
                selector: '[kendoDialogContainer]'
            }]
    }], function () { return [{ type: ɵngcc0.ViewContainerRef }, { type: DialogContainerService }]; }, null); })();

(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(LocalizedMessagesDirective, [{
        type: Directive,
        args: [{
                providers: [
                    {
                        provide: Messages,
                        useExisting: forwardRef(() => LocalizedMessagesDirective_1)
                    }
                ],
                selector: `
    [kendoDialogLocalizedMessages],
    [kendoWindowLocalizedMessages],
    [kendoDialogTitleBarLocalizedMessages]
  `
            }]
    }], function () { return [{ type: ɵngcc2.LocalizationService }]; }, null); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(CustomMessagesComponent, [{
        type: Component,
        args: [{
                providers: [
                    {
                        provide: Messages,
                        useExisting: forwardRef(() => CustomMessagesComponent_1) // tslint:disable-line:no-forward-ref
                    }
                ],
                selector: 'kendo-dialog-messages, kendo-window-messages',
                template: ``
            }]
    }], function () { return [{ type: ɵngcc2.LocalizationService }]; }, null); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(SharedModule, [{
        type: NgModule,
        args: [{
                declarations: [SHARED_DIRECTIVES],
                exports: [SHARED_DIRECTIVES, CommonModule],
                imports: [CommonModule]
            }]
    }], null, null); })();
(function () { (typeof ngJitMode === "undefined" || ngJitMode) && ɵngcc0.ɵɵsetNgModuleScope(SharedModule, { declarations: function () { return [DialogActionsComponent, CustomMessagesComponent, LocalizedMessagesDirective]; }, imports: function () { return [CommonModule]; }, exports: function () { return [DialogActionsComponent, CustomMessagesComponent, LocalizedMessagesDirective, CommonModule]; } }); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(DialogModule, [{
        type: NgModule,
        args: [{
                declarations: [DIALOG_DIRECTIVES, DialogContainerDirective],
                entryComponents: [DIALOG_DIRECTIVES],
                exports: [DIALOG_DIRECTIVES, SHARED_DIRECTIVES, DialogContainerDirective],
                imports: [SharedModule],
                providers: [DialogContainerService, DialogService]
            }]
    }], null, null); })();
(function () { (typeof ngJitMode === "undefined" || ngJitMode) && ɵngcc0.ɵɵsetNgModuleScope(DialogModule, { declarations: [DialogComponent, DialogTitleBarComponent, DialogContainerDirective], imports: [SharedModule], exports: [DialogComponent, DialogTitleBarComponent, DialogActionsComponent, CustomMessagesComponent, LocalizedMessagesDirective, DialogContainerDirective] }); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(WindowContainerDirective, [{
        type: Directive,
        args: [{
                selector: '[kendoWindowContainer]'
            }]
    }], function () { return [{ type: ɵngcc0.ViewContainerRef }, { type: WindowContainerService }]; }, null); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(WindowModule, [{
        type: NgModule,
        args: [{
                declarations: [WINDOW_DIRECTIVES, WindowContainerDirective],
                entryComponents: [ENTRY_COMPONENTS],
                exports: [exportedModules, SHARED_DIRECTIVES, WindowContainerDirective],
                imports: [SharedModule, DraggableModule],
                providers: [WindowContainerService, WindowService]
            }]
    }], null, null); })();
(function () { (typeof ngJitMode === "undefined" || ngJitMode) && ɵngcc0.ɵɵsetNgModuleScope(WindowModule, { declarations: function () { return [ResizeHandleDirective, WindowComponent, WindowTitleBarComponent, WindowCloseActionDirective, WindowMinimizeActionDirective, WindowMaximizeActionDirective, WindowRestoreActionDirective, WindowContainerDirective]; }, imports: function () { return [SharedModule, DraggableModule]; }, exports: function () { return [WindowComponent, WindowCloseActionDirective, WindowMinimizeActionDirective, WindowMaximizeActionDirective, WindowRestoreActionDirective, WindowTitleBarComponent, DialogActionsComponent, CustomMessagesComponent, LocalizedMessagesDirective, WindowContainerDirective]; } }); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(DialogsModule, [{
        type: NgModule,
        args: [{
                exports: [DialogModule, WindowModule]
            }]
    }], null, null); })();
(function () { (typeof ngJitMode === "undefined" || ngJitMode) && ɵngcc0.ɵɵsetNgModuleScope(DialogsModule, { exports: [DialogModule, WindowModule] }); })();


/**
 * Generated bundle index. Do not edit.
 */

export { DIALOG_DIRECTIVES, DialogContainerDirective, DialogContainerService, CustomMessagesComponent, DIALOG_LOCALIZATION_SERVICE, LocalizedMessagesDirective, Messages, TitleBarLocalizationService, SHARED_DIRECTIVES, SharedModule, DragResizeService, NavigationService, WindowContainerDirective, WindowContainerService, ResizeHandleDirective, DialogComponent, DialogTitleBarComponent, DialogContentBase, DialogActionsComponent, DialogService, DialogCloseResult, DialogRef, DialogSettings, DialogAction, WindowComponent, WindowTitleBarComponent, WindowMaximizeActionDirective, WindowMinimizeActionDirective, WindowCloseActionDirective, WindowRestoreActionDirective, WindowSettings, WindowRef, WindowCloseResult, WindowService, DialogModule, WindowModule, DialogsModule };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7OztpSEFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUNBbUJHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OzJMQUFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OzsrRkFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNDQXVDRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7ZUFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFnREc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7O1dBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OzRLQUFFO0FBQ0Ysd0NBRzJCO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7aUpBQUU7QUFDRiw0QkFFRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs2SkFBRTtBQUNGLGdDQUVHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OzsrQ0FBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUlHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7aUZBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQ0FXRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7NkpBQUU7QUFDRixnQ0FFRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozt3VkFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkF5REc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7a0RBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRDQVlHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7O2tEQUFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0Q0FZRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7O2tEQUFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlDQVlHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7O2tEQUFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQ0FZRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OzRLQUFFO0FBQ0Ysd0NBRzJCO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7aUpBQUU7QUFDRiw0QkFFRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzswSkFBRTtBQUNGLHVDQUlHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OFBBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7a0RBQUU7QUFDRix3RUFjRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O3lKQUFFO0FBQ0Ysa0VBV0c7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozt1R0FPaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OzZJQVNpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7MEpBQUU7QUFDRix1Q0FJRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OzhKQVNpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBS2tCO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXNDb250ZW50IjpbIi8qKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4qIENvcHlyaWdodCDCqSAyMDIxIFByb2dyZXNzIFNvZnR3YXJlIENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuKiBMaWNlbnNlZCB1bmRlciBjb21tZXJjaWFsIGxpY2Vuc2UuIFNlZSBMSUNFTlNFLm1kIGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIG1vcmUgaW5mb3JtYXRpb25cbiotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cbmltcG9ydCB7IF9fZGVjb3JhdGUsIF9fbWV0YWRhdGEsIF9fcGFyYW0gfSBmcm9tICd0c2xpYic7XG5pbXBvcnQgeyBFdmVudEVtaXR0ZXIsIFRlbXBsYXRlUmVmLCBJbnB1dCwgT3V0cHV0LCBIb3N0QmluZGluZywgQ29tcG9uZW50LCBFbGVtZW50UmVmLCBJbmplY3Rpb25Ub2tlbiwgSW5qZWN0LCBPcHRpb25hbCwgTmdab25lLCBDb250ZW50Q2hpbGRyZW4sIFF1ZXJ5TGlzdCwgVmlld0NoaWxkLCBIb3N0TGlzdGVuZXIsIFJlbmRlcmVyMiwgQ2hhbmdlRGV0ZWN0b3JSZWYsIEluamVjdGFibGUsIGlzRGV2TW9kZSwgQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLCBEaXJlY3RpdmUsIEhvc3QsIENvbnRlbnRDaGlsZCwgVmlld0NoaWxkcmVuLCBWaWV3Q29udGFpbmVyUmVmLCBmb3J3YXJkUmVmLCBOZ01vZHVsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgdHJpZ2dlciwgc3RhdGUsIHN0eWxlLCB0cmFuc2l0aW9uLCBhbmltYXRlIH0gZnJvbSAnQGFuZ3VsYXIvYW5pbWF0aW9ucyc7XG5pbXBvcnQgeyBMb2NhbGl6YXRpb25TZXJ2aWNlLCBMMTBOX1BSRUZJWCwgUlRMLCBNZXNzYWdlU2VydmljZSwgQ29tcG9uZW50TWVzc2FnZXMgfSBmcm9tICdAcHJvZ3Jlc3Mva2VuZG8tYW5ndWxhci1sMTBuJztcbmltcG9ydCB7IHRha2UsIGZpbHRlciwgbWFwLCBzaGFyZSwgdGFwLCBzd2l0Y2hNYXAsIHRha2VVbnRpbCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IHZhbGlkYXRlUGFja2FnZSB9IGZyb20gJ0Bwcm9ncmVzcy9rZW5kby1saWNlbnNpbmcnO1xuaW1wb3J0IHsgU3ViamVjdCwgbWVyZ2UsIFN1YnNjcmlwdGlvbiwgb2YgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IERyYWdnYWJsZURpcmVjdGl2ZSwgaXNDaGFuZ2VkLCBpc0RvY3VtZW50QXZhaWxhYmxlLCBEcmFnZ2FibGVNb2R1bGUgfSBmcm9tICdAcHJvZ3Jlc3Mva2VuZG8tYW5ndWxhci1jb21tb24nO1xuaW1wb3J0IHsgb2Zmc2V0LCBzY3JvbGxQb3NpdGlvbiwgcG9zaXRpb25XaXRoU2Nyb2xsLCBnZXREb2N1bWVudEVsZW1lbnQsIGdldFdpbmRvd1ZpZXdQb3J0IH0gZnJvbSAnQHByb2dyZXNzL2tlbmRvLXBvcHVwLWNvbW1vbic7XG5pbXBvcnQgeyBCdXR0b24gfSBmcm9tICdAcHJvZ3Jlc3Mva2VuZG8tYW5ndWxhci1idXR0b25zJztcbmltcG9ydCB7IENvbW1vbk1vZHVsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5cbi8qKlxuICogU3BlY2lmaWVzIHRoZSBhY3Rpb24gYnV0dG9ucyBvZiB0aGUgRGlhbG9nXG4gKiAoW3NlZSBleGFtcGxlXSh7JSBzbHVnIGFjdGlvbmJ1dHRvbnNfZGlhbG9nICV9KSkuXG4gKi9cbmxldCBEaWFsb2dBY3Rpb25zQ29tcG9uZW50ID0gY2xhc3MgRGlhbG9nQWN0aW9uc0NvbXBvbmVudCB7XG4gICAgY29uc3RydWN0b3IoZWwpIHtcbiAgICAgICAgdGhpcy5lbCA9IGVsO1xuICAgICAgICAvKipcbiAgICAgICAgICogU3BlY2lmaWVzIHRoZSBwb3NzaWJsZSBsYXlvdXQgb2YgdGhlIGFjdGlvbiBidXR0b25zLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5sYXlvdXQgPSAnc3RyZXRjaGVkJztcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEZpcmVzIHdoZW4gdGhlIHVzZXIgY2xpY2tzIGFuIGFjdGlvbiBidXR0b24uXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmFjdGlvbiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgdGhpcy5idXR0b25Hcm91cENsYXNzTmFtZSA9IHRydWU7XG4gICAgfVxuICAgIGdldCBjbGFzc05hbWUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmxheW91dCA9PT0gJ3N0cmV0Y2hlZCc7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBhY3Rpb25UZW1wbGF0ZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYWN0aW9ucyBpbnN0YW5jZW9mIFRlbXBsYXRlUmVmO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgb25CdXR0b25DbGljayhhY3Rpb24sIF9lKSB7XG4gICAgICAgIHRoaXMuYWN0aW9uLmVtaXQoYWN0aW9uKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIGJ1dHRvbkNsYXNzKGFjdGlvbikge1xuICAgICAgICBjb25zdCBjbGFzc2VzID0gWydrLWJ1dHRvbiddO1xuICAgICAgICBpZiAoYWN0aW9uLnByaW1hcnkpIHtcbiAgICAgICAgICAgIGNsYXNzZXMucHVzaCgnay1wcmltYXJ5Jyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNsYXNzZXMuam9pbignICcpO1xuICAgIH1cbn07XG5fX2RlY29yYXRlKFtcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBPYmplY3QpXG5dLCBEaWFsb2dBY3Rpb25zQ29tcG9uZW50LnByb3RvdHlwZSwgXCJhY3Rpb25zXCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBTdHJpbmcpXG5dLCBEaWFsb2dBY3Rpb25zQ29tcG9uZW50LnByb3RvdHlwZSwgXCJsYXlvdXRcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIE91dHB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBFdmVudEVtaXR0ZXIpXG5dLCBEaWFsb2dBY3Rpb25zQ29tcG9uZW50LnByb3RvdHlwZSwgXCJhY3Rpb25cIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIEhvc3RCaW5kaW5nKCdjbGFzcy5rLWRpYWxvZy1idXR0b25ncm91cCcpLFxuICAgIEhvc3RCaW5kaW5nKCdjbGFzcy5rLWFjdGlvbnMnKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgQm9vbGVhbilcbl0sIERpYWxvZ0FjdGlvbnNDb21wb25lbnQucHJvdG90eXBlLCBcImJ1dHRvbkdyb3VwQ2xhc3NOYW1lXCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBIb3N0QmluZGluZygnY2xhc3Muay1hY3Rpb25zLXN0cmV0Y2hlZCcpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBCb29sZWFuKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW10pXG5dLCBEaWFsb2dBY3Rpb25zQ29tcG9uZW50LnByb3RvdHlwZSwgXCJjbGFzc05hbWVcIiwgbnVsbCk7XG5EaWFsb2dBY3Rpb25zQ29tcG9uZW50ID0gX19kZWNvcmF0ZShbXG4gICAgQ29tcG9uZW50KHtcbiAgICAgICAgc2VsZWN0b3I6ICdrZW5kby1kaWFsb2ctYWN0aW9ucycsXG4gICAgICAgIHRlbXBsYXRlOiBgXG4gICAgICAgIDxuZy1jb250ZW50ICpuZ0lmPVwiIWFjdGlvbnNcIj48L25nLWNvbnRlbnQ+XG4gICAgICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCIhYWN0aW9uVGVtcGxhdGUoKVwiPlxuICAgICAgICAgICAgPGJ1dHRvblxuICAgICAgICAgICAgICAgIHR5cGU9XCJidXR0b25cIlxuICAgICAgICAgICAgICAgIFtuZ0NsYXNzXT1cImJ1dHRvbkNsYXNzKGFjdGlvbilcIlxuICAgICAgICAgICAgICAgIChjbGljayk9XCJvbkJ1dHRvbkNsaWNrKGFjdGlvbiwgJGV2ZW50KVwiXG4gICAgICAgICAgICAgICAgKm5nRm9yPVwibGV0IGFjdGlvbiBvZiBhY3Rpb25zXCJcbiAgICAgICAgICAgICAgICBbYXR0ci5hcmlhLWxhYmVsXT1cImFjdGlvbi50ZXh0XCJcbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICB7eyBhY3Rpb24udGV4dCB9fVxuICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgIDwvbmctY29udGFpbmVyPlxuICAgICAgICA8bmctdGVtcGxhdGUgW25nVGVtcGxhdGVPdXRsZXRdPVwiYWN0aW9uc1wiICpuZ0lmPVwiYWN0aW9uVGVtcGxhdGUoKVwiPjwvbmctdGVtcGxhdGU+XG4gICAgYFxuICAgIH0pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbRWxlbWVudFJlZl0pXG5dLCBEaWFsb2dBY3Rpb25zQ29tcG9uZW50KTtcblxuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmNsYXNzIFByZXZlbnRhYmxlRXZlbnQge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLnByZXZlbnRlZCA9IGZhbHNlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBQcmV2ZW50cyB0aGUgZGVmYXVsdCBhY3Rpb24gZm9yIGEgc3BlY2lmaWVkIGV2ZW50LlxuICAgICAqIEluIHRoaXMgd2F5LCB0aGUgc291cmNlIGNvbXBvbmVudCBzdXBwcmVzc2VzIHRoZSBidWlsdC1pbiBiZWhhdmlvciB0aGF0IGZvbGxvd3MgdGhlIGV2ZW50LlxuICAgICAqL1xuICAgIHByZXZlbnREZWZhdWx0KCkge1xuICAgICAgICB0aGlzLnByZXZlbnRlZCA9IHRydWU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIElmIHRoZSBldmVudCBpcyBwcmV2ZW50ZWQgYnkgYW55IG9mIGl0cyBzdWJzY3JpYmVycywgcmV0dXJucyBgdHJ1ZWAuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGRlZmF1bHQgYWN0aW9uIHdhcyBwcmV2ZW50ZWQuIE90aGVyd2lzZSwgcmV0dXJucyBgZmFsc2VgLlxuICAgICAqL1xuICAgIGlzRGVmYXVsdFByZXZlbnRlZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucHJldmVudGVkO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmNvbnN0IERJQUxPR19MT0NBTElaQVRJT05fU0VSVklDRSA9IG5ldyBJbmplY3Rpb25Ub2tlbignRGlhbG9nIExvY2FsaXphdGlvblNlcnZpY2UnKTtcblxuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmxldCBUaXRsZUJhckxvY2FsaXphdGlvblNlcnZpY2UgPSBjbGFzcyBUaXRsZUJhckxvY2FsaXphdGlvblNlcnZpY2UgZXh0ZW5kcyBMb2NhbGl6YXRpb25TZXJ2aWNlIHtcbiAgICBjb25zdHJ1Y3RvcihwcmVmaXgsIG1lc3NhZ2VTZXJ2aWNlLCBydGwsIGRpYWxvZ0xvY2FsaXphdGlvbikge1xuICAgICAgICBzdXBlcihwcmVmaXgsIG1lc3NhZ2VTZXJ2aWNlLCBydGwpO1xuICAgICAgICB0aGlzLmRpYWxvZ0xvY2FsaXphdGlvbiA9IGRpYWxvZ0xvY2FsaXphdGlvbjtcbiAgICB9XG4gICAgZ2V0KHNob3J0S2V5KSB7XG4gICAgICAgIGlmICh0aGlzLmRpYWxvZ0xvY2FsaXphdGlvbikge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGlhbG9nTG9jYWxpemF0aW9uLmdldChzaG9ydEtleSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHN1cGVyLmdldChzaG9ydEtleSk7XG4gICAgfVxufTtcblRpdGxlQmFyTG9jYWxpemF0aW9uU2VydmljZSA9IF9fZGVjb3JhdGUoW1xuICAgIF9fcGFyYW0oMCwgSW5qZWN0KEwxME5fUFJFRklYKSksXG4gICAgX19wYXJhbSgxLCBPcHRpb25hbCgpKSxcbiAgICBfX3BhcmFtKDIsIE9wdGlvbmFsKCkpLCBfX3BhcmFtKDIsIEluamVjdChSVEwpKSxcbiAgICBfX3BhcmFtKDMsIE9wdGlvbmFsKCkpLCBfX3BhcmFtKDMsIEluamVjdChESUFMT0dfTE9DQUxJWkFUSU9OX1NFUlZJQ0UpKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW1N0cmluZywgTWVzc2FnZVNlcnZpY2UsIEJvb2xlYW4sIExvY2FsaXphdGlvblNlcnZpY2VdKVxuXSwgVGl0bGVCYXJMb2NhbGl6YXRpb25TZXJ2aWNlKTtcblxuLyoqXG4gKiBSZXByZXNlbnRzIHRoZSBbS2VuZG8gVUkgRGlhbG9nVGl0bGVCYXIgY29tcG9uZW50IGZvciBBbmd1bGFyXSh7JSBzbHVnIGFwaV9kaWFsb2dfZGlhbG9ndGl0bGViYXJjb21wb25lbnQgJX0pLlxuICpcbiAqIEl0IGlzIHVzZWQgYXMgcGFydCBvZiB0aGUgRGlhbG9nIGNvbnRlbnQgd2hlbiB0aGUgY29tcG9uZW50IGlzIGNyZWF0ZWQgZHluYW1pY2FsbHkgYnkgdXNpbmcgYW4gW0FuZ3VsYXIgc2VydmljZV0oeyUgc2x1ZyBzZXJ2aWNlX2RpYWxvZyAlfSkuXG4gKi9cbmxldCBEaWFsb2dUaXRsZUJhckNvbXBvbmVudCA9IGNsYXNzIERpYWxvZ1RpdGxlQmFyQ29tcG9uZW50IHtcbiAgICBjb25zdHJ1Y3Rvcih6b25lLCBob3N0RWxlbWVudCwgbG9jYWxpemF0aW9uU2VydmljZSkge1xuICAgICAgICB0aGlzLnpvbmUgPSB6b25lO1xuICAgICAgICB0aGlzLmhvc3RFbGVtZW50ID0gaG9zdEVsZW1lbnQ7XG4gICAgICAgIHRoaXMubG9jYWxpemF0aW9uU2VydmljZSA9IGxvY2FsaXphdGlvblNlcnZpY2U7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBGaXJlcyB3aGVuIHRoZSBjbG9zZSBidXR0b24gb2YgdGhlIHRpdGxlLWJhciBpcyBjbGlja2VkLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5jbG9zZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICB9XG4gICAgZ2V0IGNsYXNzTmFtZSgpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGdldCBjbG9zZUJ1dHRvblRpdGxlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jbG9zZVRpdGxlIHx8IHRoaXMubG9jYWxpemF0aW9uU2VydmljZS5nZXQoJ2Nsb3NlVGl0bGUnKTtcbiAgICB9XG4gICAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgICAgICB0aGlzLnpvbmUub25TdGFibGUucGlwZSh0YWtlKDEpKS5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZWxlbWVudCA9IHRoaXMuaG9zdEVsZW1lbnQubmF0aXZlRWxlbWVudDtcbiAgICAgICAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKCdpZCcsIHRoaXMuaWQpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIG9uQ2xvc2VDbGljayhlKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgY29uc3QgZXZlbnRBcmdzID0gbmV3IFByZXZlbnRhYmxlRXZlbnQoKTtcbiAgICAgICAgdGhpcy5jbG9zZS5lbWl0KGV2ZW50QXJncyk7XG4gICAgfVxufTtcbl9fZGVjb3JhdGUoW1xuICAgIE91dHB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBFdmVudEVtaXR0ZXIpXG5dLCBEaWFsb2dUaXRsZUJhckNvbXBvbmVudC5wcm90b3R5cGUsIFwiY2xvc2VcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIElucHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIFN0cmluZylcbl0sIERpYWxvZ1RpdGxlQmFyQ29tcG9uZW50LnByb3RvdHlwZSwgXCJpZFwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgSW5wdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgU3RyaW5nKVxuXSwgRGlhbG9nVGl0bGVCYXJDb21wb25lbnQucHJvdG90eXBlLCBcImNsb3NlVGl0bGVcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIEhvc3RCaW5kaW5nKCdjbGFzcy5rLXdpbmRvdy10aXRsZWJhcicpLFxuICAgIEhvc3RCaW5kaW5nKCdjbGFzcy5rLWRpYWxvZy10aXRsZWJhcicpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBCb29sZWFuKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW10pXG5dLCBEaWFsb2dUaXRsZUJhckNvbXBvbmVudC5wcm90b3R5cGUsIFwiY2xhc3NOYW1lXCIsIG51bGwpO1xuRGlhbG9nVGl0bGVCYXJDb21wb25lbnQgPSBfX2RlY29yYXRlKFtcbiAgICBDb21wb25lbnQoe1xuICAgICAgICBzZWxlY3RvcjogJ2tlbmRvLWRpYWxvZy10aXRsZWJhcicsXG4gICAgICAgIHByb3ZpZGVyczogW1xuICAgICAgICAgICAgVGl0bGVCYXJMb2NhbGl6YXRpb25TZXJ2aWNlLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHByb3ZpZGU6IExvY2FsaXphdGlvblNlcnZpY2UsXG4gICAgICAgICAgICAgICAgdXNlRXhpc3Rpbmc6IFRpdGxlQmFyTG9jYWxpemF0aW9uU2VydmljZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBwcm92aWRlOiBMMTBOX1BSRUZJWCxcbiAgICAgICAgICAgICAgICB1c2VWYWx1ZTogJ2tlbmRvLmRpYWxvZydcbiAgICAgICAgICAgIH1cbiAgICAgICAgXSxcbiAgICAgICAgdGVtcGxhdGU6IGBcbiAgICAgICAgIDxuZy1jb250YWluZXJcbiAgICAgICAgICAgIGtlbmRvRGlhbG9nVGl0bGVCYXJMb2NhbGl6ZWRNZXNzYWdlc1xuICAgICAgICAgICAgaTE4bi1jbG9zZVRpdGxlPVwia2VuZG8uZGlhbG9nLmNsb3NlVGl0bGV8VGhlIHRpdGxlIG9mIHRoZSBjbG9zZSBidXR0b25cIlxuICAgICAgICAgICAgY2xvc2VUaXRsZT1cIkNsb3NlXCJcbiAgICAgICAgPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImstd2luZG93LXRpdGxlIGstZGlhbG9nLXRpdGxlXCI+XG4gICAgICAgICAgICAgICAgPG5nLWNvbnRlbnQ+PC9uZy1jb250ZW50PlxuICAgICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJrLXdpbmRvdy1hY3Rpb25zIGstZGlhbG9nLWFjdGlvbnNcIj5cbiAgICAgICAgICAgICAgICA8YVxuICAgICAgICAgICAgICAgICAgICBocmVmPVwiI1wiXG4gICAgICAgICAgICAgICAgICAgIHJvbGU9XCJidXR0b25cIlxuICAgICAgICAgICAgICAgICAgICBbYXR0ci50aXRsZV09XCJjbG9zZUJ1dHRvblRpdGxlXCJcbiAgICAgICAgICAgICAgICAgICAgW2F0dHIuYXJpYS1sYWJlbF09XCJjbG9zZUJ1dHRvblRpdGxlXCJcbiAgICAgICAgICAgICAgICAgICAgY2xhc3M9XCJrLWJ1dHRvbiBrLWZsYXQgay1idXR0b24taWNvbiBrLXdpbmRvdy1hY3Rpb24gay1kaWFsb2ctYWN0aW9uIGstZGlhbG9nLWNsb3NlXCJcbiAgICAgICAgICAgICAgICAgICAgKGNsaWNrKT1cIm9uQ2xvc2VDbGljaygkZXZlbnQpXCJcbiAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwiay1pY29uIGstaS14XCI+PC9zcGFuPlxuICAgICAgICAgICAgICAgIDwvYT5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L25nLWNvbnRhaW5lcj5cbiAgICBgXG4gICAgfSksXG4gICAgX19wYXJhbSgyLCBPcHRpb25hbCgpKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW05nWm9uZSwgRWxlbWVudFJlZiwgTG9jYWxpemF0aW9uU2VydmljZV0pXG5dLCBEaWFsb2dUaXRsZUJhckNvbXBvbmVudCk7XG5cbi8qKlxuICogQGhpZGRlblxuICovXG5jb25zdCBwYWNrYWdlTWV0YWRhdGEgPSB7XG4gICAgbmFtZTogJ0Bwcm9ncmVzcy9rZW5kby1hbmd1bGFyLWRpYWxvZycsXG4gICAgcHJvZHVjdE5hbWU6ICdLZW5kbyBVSSBmb3IgQW5ndWxhcicsXG4gICAgcHJvZHVjdENvZGVzOiBbJ0tFTkRPVUlBTkdVTEFSJywgJ0tFTkRPVUlDT01QTEVURSddLFxuICAgIHB1Ymxpc2hEYXRlOiAxNjMxMTk4NDEzLFxuICAgIHZlcnNpb246ICcnLFxuICAgIGxpY2Vuc2luZ0RvY3NVcmw6ICdodHRwczovL3d3dy50ZWxlcmlrLmNvbS9rZW5kby1hbmd1bGFyLXVpL215LWxpY2Vuc2UvP3V0bV9tZWRpdW09cHJvZHVjdCZ1dG1fc291cmNlPWtlbmRvYW5ndWxhciZ1dG1fY2FtcGFpZ249a2VuZG8tdWktYW5ndWxhci1wdXJjaGFzZS1saWNlbnNlLWtleXMtd2FybmluZydcbn07XG5cbi8qKlxuICogQGhpZGRlblxuICovXG5jb25zdCBpc1ByZXNlbnQgPSAodmFsdWUpID0+IHZhbHVlICE9PSBudWxsICYmIHZhbHVlICE9PSB1bmRlZmluZWQ7XG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY29uc3QgaXNUcnV0aHkgPSAodmFsdWUpID0+ICEhdmFsdWU7XG5jb25zdCB0b0NsYXNzTGlzdCA9IChjbGFzc05hbWVzKSA9PiBTdHJpbmcoY2xhc3NOYW1lcykudHJpbSgpLnNwbGl0KCcgJyk7XG5jb25zdCBmb2N1c2FibGVSZWdleCA9IC9eKD86YXxpbnB1dHxzZWxlY3R8dGV4dGFyZWF8YnV0dG9ufG9iamVjdCkkL2k7XG4vKipcbiAqIEBoaWRkZW5cbiAqL1xudmFyIEtleXM7XG4oZnVuY3Rpb24gKEtleXMpIHtcbiAgICBLZXlzW0tleXNbXCJlc2NcIl0gPSAyN10gPSBcImVzY1wiO1xuICAgIEtleXNbS2V5c1tcInRhYlwiXSA9IDldID0gXCJ0YWJcIjtcbiAgICBLZXlzW0tleXNbXCJlbnRlclwiXSA9IDEzXSA9IFwiZW50ZXJcIjtcbiAgICBLZXlzW0tleXNbXCJzcGFjZVwiXSA9IDMyXSA9IFwic3BhY2VcIjtcbiAgICBLZXlzW0tleXNbXCJjdHJsXCJdID0gMTddID0gXCJjdHJsXCI7XG4gICAgS2V5c1tLZXlzW1wic2hpZnRcIl0gPSAxNl0gPSBcInNoaWZ0XCI7XG4gICAgS2V5c1tLZXlzW1wibGVmdFwiXSA9IDM3XSA9IFwibGVmdFwiO1xuICAgIEtleXNbS2V5c1tcInVwXCJdID0gMzhdID0gXCJ1cFwiO1xuICAgIEtleXNbS2V5c1tcInJpZ2h0XCJdID0gMzldID0gXCJyaWdodFwiO1xuICAgIEtleXNbS2V5c1tcImRvd25cIl0gPSA0MF0gPSBcImRvd25cIjtcbn0pKEtleXMgfHwgKEtleXMgPSB7fSkpO1xuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmNvbnN0IERJQUxPR19FTEVNRU5UU19IQU5ETElOR19FU0NfS0VZID0gJ2stZGlhbG9nLXdyYXBwZXIgay1kaWFsb2ctYnV0dG9uZ3JvdXAgay1kaWFsb2ctYWN0aW9uJztcbi8qKlxuICogQGhpZGRlblxuICovXG5jb25zdCBESUFMT0dfRUxFTUVOVFNfSEFORExJTkdfQVJST1dTID0gJ2stZGlhbG9nLWJ1dHRvbmdyb3VwJztcbi8qKlxuICogQGhpZGRlblxuICovXG5jb25zdCBXSU5ET1dfQ0xBU1NFUyA9ICdrLXdpbmRvdyc7XG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY29uc3QgaGFzQ2xhc3NlcyA9IChlbGVtZW50LCBjbGFzc05hbWVzKSA9PiB7XG4gICAgY29uc3QgbmFtZXNMaXN0ID0gdG9DbGFzc0xpc3QoY2xhc3NOYW1lcyk7XG4gICAgcmV0dXJuIEJvb2xlYW4odG9DbGFzc0xpc3QoZWxlbWVudC5jbGFzc05hbWUpLmZpbmQoKGNsYXNzTmFtZSkgPT4gbmFtZXNMaXN0LmluZGV4T2YoY2xhc3NOYW1lKSA+PSAwKSk7XG59O1xuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmNvbnN0IGlzVmlzaWJsZSA9IChlbGVtZW50KSA9PiB7XG4gICAgY29uc3QgcmVjdCA9IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgcmV0dXJuICEhKHJlY3Qud2lkdGggJiYgcmVjdC5oZWlnaHQpICYmIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGVsZW1lbnQpLnZpc2liaWxpdHkgIT09ICdoaWRkZW4nO1xufTtcbi8qKlxuICogQGhpZGRlblxuICovXG5jb25zdCBpc0ZvY3VzYWJsZSA9IChlbGVtZW50LCBjaGVja1Zpc2liaWxpdHkgPSB0cnVlKSA9PiB7XG4gICAgaWYgKGVsZW1lbnQudGFnTmFtZSkge1xuICAgICAgICBjb25zdCB0YWdOYW1lID0gZWxlbWVudC50YWdOYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIGNvbnN0IHRhYkluZGV4ID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ3RhYkluZGV4Jyk7XG4gICAgICAgIGNvbnN0IHZhbGlkVGFiSW5kZXggPSB0YWJJbmRleCAhPT0gbnVsbCAmJiAhaXNOYU4odGFiSW5kZXgpICYmIHRhYkluZGV4ID4gLTE7XG4gICAgICAgIGxldCBmb2N1c2FibGUgPSBmYWxzZTtcbiAgICAgICAgaWYgKGZvY3VzYWJsZVJlZ2V4LnRlc3QodGFnTmFtZSkpIHtcbiAgICAgICAgICAgIGZvY3VzYWJsZSA9ICFlbGVtZW50LmRpc2FibGVkO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZm9jdXNhYmxlID0gdmFsaWRUYWJJbmRleDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZm9jdXNhYmxlICYmICghY2hlY2tWaXNpYmlsaXR5IHx8IGlzVmlzaWJsZShlbGVtZW50KSk7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbn07XG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY29uc3QgZm9jdXNhYmxlU2VsZWN0b3IgPSBbXG4gICAgJ2FbaHJlZl0nLFxuICAgICdhcmVhW2hyZWZdJyxcbiAgICAnaW5wdXQ6bm90KFtkaXNhYmxlZF0pJyxcbiAgICAnc2VsZWN0Om5vdChbZGlzYWJsZWRdKScsXG4gICAgJ3RleHRhcmVhOm5vdChbZGlzYWJsZWRdKScsXG4gICAgJ2J1dHRvbjpub3QoW2Rpc2FibGVkXSknLFxuICAgICdpZnJhbWUnLFxuICAgICdvYmplY3QnLFxuICAgICdlbWJlZCcsXG4gICAgJypbdGFiaW5kZXhdJyxcbiAgICAnKltjb250ZW50ZWRpdGFibGVdJ1xuXS5qb2luKCcsJyk7XG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY29uc3QgcHJldmVudERlZmF1bHQgPSAoeyBvcmlnaW5hbEV2ZW50OiBldmVudCB9KSA9PiB7XG4gICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbn07XG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY29uc3QgUkVTSVpFX0RJUkVDVElPTlMgPSBbJ24nLCAnZScsICdzJywgJ3cnLCAnc2UnLCAnc3cnLCAnbmUnLCAnbncnXTtcbi8qKlxuICogQGhpZGRlblxuICovXG5jb25zdCBPRkZTRVRfU1RZTEVTID0gWyd0b3AnLCAnbGVmdCcsICd3aWR0aCcsICdoZWlnaHQnXTtcbi8qKlxuICogQGhpZGRlblxuICovXG5jb25zdCBpc1N0cmluZyA9ICh2YWx1ZSkgPT4gdmFsdWUgaW5zdGFuY2VvZiBTdHJpbmcgfHwgdHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJztcbi8qKlxuICogQGhpZGRlblxuICovXG5jb25zdCBpc051bWJlciA9ICh2YWx1ZSkgPT4gdHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJyAmJiBpc0Zpbml0ZSh2YWx1ZSk7XG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY29uc3QgY3JlYXRlVmFsdWVXaXRoVW5pdCA9ICh2YWx1ZSkgPT4gdmFsdWUgKyAoaXNOdW1iZXIodmFsdWUpID8gJ3B4JyA6ICcnKTtcblxuLyoqXG4gKiBUaGUgc2V0dGluZ3MgZm9yIHRoZSBEaWFsb2cgYWN0aW9ucyB3aGVuIHRoZSBEaWFsb2cgaXMgb3BlbmVkIHRocm91Z2ggYERpYWxvZ1NlcnZpY2VgXG4gKiAoW3NlZSBleGFtcGxlXSh7JSBzbHVnIGFwaV9kaWFsb2dfZGlhbG9nc2VydmljZSAlfSN0b2Mtb3BlbikpLlxuICovXG5jbGFzcyBEaWFsb2dBY3Rpb24ge1xufVxuLyoqXG4gKiBJbmRpY2F0ZXMgdGhhdCB0aGUgKipDbG9zZSoqIGJ1dHRvbiBpcyBjbGlja2VkLiBVc2VkIHdoZW4gdGhlIHJlc3VsdHMgZnJvbVxuICogdGhlIERpYWxvZ3MgdGhhdCBhcmUgb3BlbmVkIHRocm91Z2ggYERpYWxvZ1NlcnZpY2VgIGFyZSBmaWx0ZXJlZFxuICogKFtzZWUgZXhhbXBsZV0oeyUgc2x1ZyBhcGlfZGlhbG9nX2RpYWxvZ3NlcnZpY2UgJX0jdG9jLW9wZW4pKS5cbiAqL1xuY2xhc3MgRGlhbG9nQ2xvc2VSZXN1bHQge1xufVxuLyoqXG4gKiBUaGUgc2V0dGluZ3MgdGhhdCBjYW4gYmUgdXNlZCB3aGVuIHRoZSBEaWFsb2cgaXMgb3BlbmVkIHRocm91Z2ggYERpYWxvZ1NlcnZpY2VgLlxuICogKFtzZWUgZXhhbXBsZV0oeyUgc2x1ZyBhcGlfZGlhbG9nX2RpYWxvZ3NlcnZpY2UgJX0jdG9jLW9wZW4pKS5cbiAqL1xuY2xhc3MgRGlhbG9nU2V0dGluZ3Mge1xufVxuLyoqXG4gKiBIb2xkcyByZWZlcmVuY2VzIHRvIHRoZSBvYmplY3QgaW5zdGFuY2UgYW5kIHB1Ymxpc2hlZCBldmVudHMgb2YgdGhlIERpYWxvZy5cbiAqIENvbnRyb2xzIHRoZSBEaWFsb2dzIHRoYXQgd2VyZSBvcGVuZWQgdGhyb3VnaCB0aGUgYERpYWxvZ1NlcnZpY2VgXG4gKiAoW3NlZSBleGFtcGxlXSh7JSBzbHVnIGFwaV9kaWFsb2dfZGlhbG9nc2VydmljZSAlfSN0b2Mtb3BlbikpLlxuICovXG5jbGFzcyBEaWFsb2dSZWYge1xufVxuXG4vKipcbiAqIFJlcHJlc2VudHMgdGhlIFtLZW5kbyBVSSBEaWFsb2cgY29tcG9uZW50IGZvciBBbmd1bGFyXSh7JSBzbHVnIG92ZXJ2aWV3X2RpYWxvZ19kaWFsb2dzICV9KS5cbiAqL1xubGV0IERpYWxvZ0NvbXBvbmVudCA9IGNsYXNzIERpYWxvZ0NvbXBvbmVudCB7XG4gICAgY29uc3RydWN0b3IoX2VsUmVmLCBfcmVuZGVyZXIsIGxvY2FsaXphdGlvbiwgY2RyLCB6b25lKSB7XG4gICAgICAgIHRoaXMuX2VsUmVmID0gX2VsUmVmO1xuICAgICAgICB0aGlzLl9yZW5kZXJlciA9IF9yZW5kZXJlcjtcbiAgICAgICAgdGhpcy5jZHIgPSBjZHI7XG4gICAgICAgIHRoaXMuem9uZSA9IHpvbmU7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTcGVjaWZpZXMgdGhlIGxheW91dCBvZiB0aGUgYWN0aW9uIGJ1dHRvbnMgaW4gdGhlIERpYWxvZy5cbiAgICAgICAgICogVGhpcyBvcHRpb24gaXMgb25seSBhcHBsaWNhYmxlIGlmIHRoZSBhY3Rpb24gYnV0dG9ucyBhcmUgc3BlY2lmaWVkIHRocm91Z2ggdGhlIGBhY3Rpb25zYCBvcHRpb25zLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAZGVmYXVsdCAnc3RyZXRjaGVkJ1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5hY3Rpb25zTGF5b3V0ID0gJ3N0cmV0Y2hlZCc7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAaGlkZGVuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnRpdGxlSWQgPSBudWxsO1xuICAgICAgICAvKipcbiAgICAgICAgICogRmlyZXMgd2hlbiB0aGUgdXNlciBjbGlja3MgYW4gYWN0aW9uIGJ1dHRvbiBvZiB0aGUgRGlhbG9nLlxuICAgICAgICAgKiBUaGUgZXZlbnQgaXMgZmlyZWQgb25seSB3aGVuIHRoZSBhY3Rpb24gYnV0dG9ucyBhcmUgc3BlY2lmaWVkIHRocm91Z2ggdGhlIGBhY3Rpb25zYCBvcHRpb25zLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5hY3Rpb24gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBGaXJlcyB3aGVuIHRoZSB1c2VyIGNsaWNrcyB0aGUgKipDbG9zZSoqIGJ1dHRvbiBvZiB0aGUgRGlhbG9nLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5jbG9zZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgdGhpcy50YWJJbmRleCA9IDA7XG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucyA9IFtdO1xuICAgICAgICB2YWxpZGF0ZVBhY2thZ2UocGFja2FnZU1ldGFkYXRhKTtcbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSBsb2NhbGl6YXRpb24ucnRsID8gJ3J0bCcgOiAnbHRyJztcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zLnB1c2gobG9jYWxpemF0aW9uLmNoYW5nZXMuc3Vic2NyaWJlKCh7IHJ0bCB9KSA9PiAodGhpcy5kaXJlY3Rpb24gPSBydGwgPyAncnRsJyA6ICdsdHInKSkpO1xuICAgICAgICB0aGlzLnRpdGxlSWQgPSB0aGlzLmdlbmVyYXRlVGl0bGVJZCgpO1xuICAgIH1cbiAgICBnZXQgZGlyKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kaXJlY3Rpb247XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBvbkNvbXBvbmVudEtleWRvd24oZXZlbnQpIHtcbiAgICAgICAgY29uc3QgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICBjb25zdCBwYXJlbnQgPSB0YXJnZXQucGFyZW50RWxlbWVudDtcbiAgICAgICAgaWYgKGhhc0NsYXNzZXModGFyZ2V0LCBESUFMT0dfRUxFTUVOVFNfSEFORExJTkdfRVNDX0tFWSkgfHwgaGFzQ2xhc3NlcyhwYXJlbnQsIERJQUxPR19FTEVNRU5UU19IQU5ETElOR19FU0NfS0VZKSkge1xuICAgICAgICAgICAgaWYgKGV2ZW50LmtleUNvZGUgPT09IEtleXMuZXNjKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZS5lbWl0KG5ldyBEaWFsb2dDbG9zZVJlc3VsdCgpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoaGFzQ2xhc3Nlcyh0YXJnZXQsICdrLWJ1dHRvbicpICYmXG4gICAgICAgICAgICBoYXNDbGFzc2VzKHBhcmVudCwgRElBTE9HX0VMRU1FTlRTX0hBTkRMSU5HX0FSUk9XUykgJiZcbiAgICAgICAgICAgIChldmVudC5rZXlDb2RlID09PSBLZXlzLmxlZnQgfHwgZXZlbnQua2V5Q29kZSA9PT0gS2V5cy5yaWdodCkpIHtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlQWN0aW9uQnV0dG9uRm9jdXMocGFyZW50LCBldmVudC5rZXlDb2RlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gS2V5cy50YWIpIHtcbiAgICAgICAgICAgIHRoaXMua2VlcEZvY3VzV2l0aGluQ29tcG9uZW50KHRhcmdldCwgZXZlbnQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIG5nQWZ0ZXJDb250ZW50SW5pdCgpIHtcbiAgICAgICAgdGhpcy5idWJibGUoJ2Nsb3NlJywgdGhpcy50aXRsZWJhckNvbnRlbnQuZmlyc3QpO1xuICAgICAgICBpZiAodGhpcy50aXRsZWJhckNvbnRlbnQuZmlyc3QpIHtcbiAgICAgICAgICAgIHRoaXMudGl0bGViYXJDb250ZW50LmZpcnN0LmlkID0gdGhpcy50aXRsZUlkO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zLnB1c2godGhpcy50aXRsZWJhckNvbnRlbnQuY2hhbmdlcy5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChpc1ByZXNlbnQodGhpcy50aXRsZWJhckNvbnRlbnQuZmlyc3QpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudGl0bGViYXJDb250ZW50LmZpcnN0LmlkID0gdGhpcy50aXRsZUlkO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnpvbmUub25TdGFibGUucGlwZSh0YWtlKDEpKS5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5idWJibGUoJ2Nsb3NlJywgdGhpcy50aXRsZWJhckNvbnRlbnQuZmlyc3QpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVuZGVyZXIuc2V0QXR0cmlidXRlKHRoaXMuX2VsUmVmLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignLmstZGlhbG9nJyksICdhcmlhLWxhYmVsbGVkYnknLCB0aGlzLnRpdGxlSWQpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlcykge1xuICAgICAgICBpZiAoY2hhbmdlcy50aXRsZSAmJiBjaGFuZ2VzLnRpdGxlLmN1cnJlbnRWYWx1ZSAmJiAhY2hhbmdlcy50aXRsZS5wcmV2aW91c1ZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLnpvbmUub25TdGFibGUucGlwZSh0YWtlKDEpKS5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYnViYmxlKCdjbG9zZScsIHRoaXMudGl0bGViYXJWaWV3KTtcbiAgICAgICAgICAgICAgICB0aGlzLl9yZW5kZXJlci5zZXRBdHRyaWJ1dGUodGhpcy5fZWxSZWYubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuay1kaWFsb2cnKSwgJ2FyaWEtbGFiZWxsZWRieScsIHRoaXMudGl0bGVJZCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgICAgIHRoaXMuaGFuZGxlSW5pdGlhbEZvY3VzKCk7XG4gICAgICAgIHRoaXMuYnViYmxlKCdjbG9zZScsIHRoaXMudGl0bGViYXJWaWV3KTtcbiAgICAgICAgdGhpcy5idWJibGUoJ2FjdGlvbicsIHRoaXMuYWN0aW9uc1ZpZXcpO1xuICAgICAgICBpZiAodGhpcy50aXRsZWJhclZpZXcgfHwgdGhpcy50aXRsZWJhckNvbnRlbnQuZmlyc3QpIHtcbiAgICAgICAgICAgIC8vTmVlZGVkIGZvciBEaWFsb2dzIGNyZWF0ZWQgdmlhIHNlcnZpY2VcbiAgICAgICAgICAgIHRoaXMuX3JlbmRlcmVyLnNldEF0dHJpYnV0ZSh0aGlzLl9lbFJlZi5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5rLWRpYWxvZycpLCAnYXJpYS1sYWJlbGxlZGJ5JywgdGhpcy50aXRsZUlkKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgdGhpcy5fcmVuZGVyZXIucmVtb3ZlQXR0cmlidXRlKHRoaXMuX2VsUmVmLm5hdGl2ZUVsZW1lbnQsICd0aXRsZScpO1xuICAgICAgICB0aGlzLmNkci5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgfVxuICAgIG5nT25EZXN0cm95KCkge1xuICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnMuZm9yRWFjaChzID0+IHMudW5zdWJzY3JpYmUoKSk7XG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucyA9IFtdO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBGb2N1c2VzIHRoZSB3cmFwcGVyIG9mIHRoZSBEaWFsb2cgY29tcG9uZW50LlxuICAgICAqL1xuICAgIGZvY3VzKCkge1xuICAgICAgICBjb25zdCB3cmFwcGVyID0gdGhpcy5fZWxSZWYubmF0aXZlRWxlbWVudDtcbiAgICAgICAgaWYgKGlzUHJlc2VudCh3cmFwcGVyKSkge1xuICAgICAgICAgICAgd3JhcHBlci5mb2N1cygpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBoYW5kbGVJbml0aWFsRm9jdXMoKSB7XG4gICAgICAgIGNvbnN0IHdyYXBwZXIgPSB0aGlzLl9lbFJlZi5uYXRpdmVFbGVtZW50O1xuICAgICAgICBjb25zdCBwcmltYXJ5QnV0dG9uID0gd3JhcHBlci5xdWVyeVNlbGVjdG9yKCcuay1wcmltYXJ5Jyk7XG4gICAgICAgIGlmICh0aGlzLmF1dG9Gb2N1c2VkRWxlbWVudCkge1xuICAgICAgICAgICAgY29uc3QgaW5pdGlhbGx5Rm9jdXNlZEVsZW1lbnQgPSB3cmFwcGVyLnF1ZXJ5U2VsZWN0b3IodGhpcy5hdXRvRm9jdXNlZEVsZW1lbnQpO1xuICAgICAgICAgICAgaWYgKGluaXRpYWxseUZvY3VzZWRFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgaW5pdGlhbGx5Rm9jdXNlZEVsZW1lbnQuZm9jdXMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0aGlzLnNob3VsZEZvY3VzUHJpbWFyeShwcmltYXJ5QnV0dG9uKSkge1xuICAgICAgICAgICAgcHJpbWFyeUJ1dHRvbi5mb2N1cygpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgd3JhcHBlci5mb2N1cygpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBoYW5kbGVBY3Rpb25CdXR0b25Gb2N1cyhwYXJlbnQsIGtleSkge1xuICAgICAgICBjb25zdCBmb2N1c2FibGVBY3Rpb25CdXR0b25zID0gdGhpcy5nZXRBbGxGb2N1c2FibGVDaGlsZHJlbihwYXJlbnQpO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZvY3VzYWJsZUFjdGlvbkJ1dHRvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnQgPSBmb2N1c2FibGVBY3Rpb25CdXR0b25zW2ldO1xuICAgICAgICAgICAgaWYgKGN1cnJlbnQgPT09IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBpZiAoa2V5ID09PSBLZXlzLmxlZnQgJiYgaSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgZm9jdXNhYmxlQWN0aW9uQnV0dG9uc1tpIC0gMV0uZm9jdXMoKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChrZXkgPT09IEtleXMucmlnaHQgJiYgaSA8IGZvY3VzYWJsZUFjdGlvbkJ1dHRvbnMubGVuZ3RoIC0gMSkge1xuICAgICAgICAgICAgICAgICAgICBmb2N1c2FibGVBY3Rpb25CdXR0b25zW2kgKyAxXS5mb2N1cygpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIGtlZXBGb2N1c1dpdGhpbkNvbXBvbmVudCh0YXJnZXQsIGV2ZW50KSB7XG4gICAgICAgIGNvbnN0IGZpcnN0Rm9jdXNhYmxlID0gdGhpcy5fZWxSZWYubmF0aXZlRWxlbWVudDtcbiAgICAgICAgY29uc3QgbGFzdEZvY3VzYWJsZSA9IHRoaXMuZ2V0TGFzdEZvY3VzYWJsZUVsZW1lbnQoZmlyc3RGb2N1c2FibGUpO1xuICAgICAgICBjb25zdCB0YWJCZWZvcmVGaXJzdEZvY3VzYWJsZSA9IHRhcmdldCA9PT0gZmlyc3RGb2N1c2FibGUgJiYgZXZlbnQuc2hpZnRLZXk7XG4gICAgICAgIGNvbnN0IHRhYkFmdGVyTGFzdEZvY3VzYWJsZSA9ICFldmVudC5zaGlmdEtleSAmJiBpc1ByZXNlbnQobGFzdEZvY3VzYWJsZSkgJiYgdGFyZ2V0ID09PSBsYXN0Rm9jdXNhYmxlO1xuICAgICAgICBjb25zdCB0YWJXaXRoTm9Gb2N1c2FibGUgPSAhaXNQcmVzZW50KGxhc3RGb2N1c2FibGUpICYmICFldmVudC5zaGlmdEtleTtcbiAgICAgICAgaWYgKHRhYkJlZm9yZUZpcnN0Rm9jdXNhYmxlIHx8IHRhYldpdGhOb0ZvY3VzYWJsZSkge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGZpcnN0Rm9jdXNhYmxlLmZvY3VzKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRhYkFmdGVyTGFzdEZvY3VzYWJsZSkge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGxhc3RGb2N1c2FibGUuZm9jdXMoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgc2hvdWxkRm9jdXNQcmltYXJ5KGVsKSB7XG4gICAgICAgIHJldHVybiBpc1ByZXNlbnQoZWwpICYmIGlzRm9jdXNhYmxlKGVsKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIGdldEFsbEZvY3VzYWJsZUNoaWxkcmVuKHBhcmVudCkge1xuICAgICAgICByZXR1cm4gcGFyZW50LnF1ZXJ5U2VsZWN0b3JBbGwoZm9jdXNhYmxlU2VsZWN0b3IpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgZ2V0TGFzdEZvY3VzYWJsZUVsZW1lbnQocGFyZW50KSB7XG4gICAgICAgIGNvbnN0IGFsbCA9IHRoaXMuZ2V0QWxsRm9jdXNhYmxlQ2hpbGRyZW4ocGFyZW50KTtcbiAgICAgICAgcmV0dXJuIGFsbC5sZW5ndGggPiAwID8gYWxsW2FsbC5sZW5ndGggLSAxXSA6IG51bGw7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBnZW5lcmF0ZVRpdGxlSWQoKSB7XG4gICAgICAgIHJldHVybiAna2VuZG8tZGlhbG9nLXRpdGxlLScgKyBNYXRoLmNlaWwoTWF0aC5yYW5kb20oKSAqIDEwMDAwMDApLnRvU3RyaW5nKCk7XG4gICAgfVxuICAgIGdldCB3cmFwcGVyQ2xhc3MoKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBnZXQgc3R5bGVzKCkge1xuICAgICAgICBjb25zdCBzdHlsZXMgPSB7fTtcbiAgICAgICAgaWYgKHRoaXMud2lkdGgpIHtcbiAgICAgICAgICAgIHN0eWxlcy53aWR0aCA9IGNyZWF0ZVZhbHVlV2l0aFVuaXQodGhpcy53aWR0aCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuaGVpZ2h0KSB7XG4gICAgICAgICAgICBzdHlsZXMuaGVpZ2h0ID0gY3JlYXRlVmFsdWVXaXRoVW5pdCh0aGlzLmhlaWdodCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMubWluV2lkdGgpIHtcbiAgICAgICAgICAgIHN0eWxlcy5taW5XaWR0aCA9IGNyZWF0ZVZhbHVlV2l0aFVuaXQodGhpcy5taW5XaWR0aCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMubWF4V2lkdGgpIHtcbiAgICAgICAgICAgIHN0eWxlcy5tYXhXaWR0aCA9IGNyZWF0ZVZhbHVlV2l0aFVuaXQodGhpcy5tYXhXaWR0aCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMubWluSGVpZ2h0KSB7XG4gICAgICAgICAgICBzdHlsZXMubWluSGVpZ2h0ID0gY3JlYXRlVmFsdWVXaXRoVW5pdCh0aGlzLm1pbkhlaWdodCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMubWF4SGVpZ2h0KSB7XG4gICAgICAgICAgICBzdHlsZXMubWF4SGVpZ2h0ID0gY3JlYXRlVmFsdWVXaXRoVW5pdCh0aGlzLm1heEhlaWdodCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHN0eWxlcztcbiAgICB9XG4gICAgYnViYmxlKGV2ZW50TmFtZSwgY29tcG9uZW50KSB7XG4gICAgICAgIGlmIChjb21wb25lbnQpIHtcbiAgICAgICAgICAgIGNvbnN0IGVtaXQgPSBlID0+IHRoaXNbZXZlbnROYW1lXS5lbWl0KGUpO1xuICAgICAgICAgICAgY29uc3QgcyA9IGNvbXBvbmVudFtldmVudE5hbWVdLnN1YnNjcmliZShlbWl0KTtcbiAgICAgICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5wdXNoKHMpO1xuICAgICAgICB9XG4gICAgfVxufTtcbl9fZGVjb3JhdGUoW1xuICAgIElucHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIEFycmF5KVxuXSwgRGlhbG9nQ29tcG9uZW50LnByb3RvdHlwZSwgXCJhY3Rpb25zXCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBTdHJpbmcpXG5dLCBEaWFsb2dDb21wb25lbnQucHJvdG90eXBlLCBcImFjdGlvbnNMYXlvdXRcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIElucHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIFN0cmluZylcbl0sIERpYWxvZ0NvbXBvbmVudC5wcm90b3R5cGUsIFwiYXV0b0ZvY3VzZWRFbGVtZW50XCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBTdHJpbmcpXG5dLCBEaWFsb2dDb21wb25lbnQucHJvdG90eXBlLCBcInRpdGxlXCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBPYmplY3QpXG5dLCBEaWFsb2dDb21wb25lbnQucHJvdG90eXBlLCBcIndpZHRoXCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBPYmplY3QpXG5dLCBEaWFsb2dDb21wb25lbnQucHJvdG90eXBlLCBcIm1pbldpZHRoXCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBPYmplY3QpXG5dLCBEaWFsb2dDb21wb25lbnQucHJvdG90eXBlLCBcIm1heFdpZHRoXCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBPYmplY3QpXG5dLCBEaWFsb2dDb21wb25lbnQucHJvdG90eXBlLCBcImhlaWdodFwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgSW5wdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgT2JqZWN0KVxuXSwgRGlhbG9nQ29tcG9uZW50LnByb3RvdHlwZSwgXCJtaW5IZWlnaHRcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIElucHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIE9iamVjdClcbl0sIERpYWxvZ0NvbXBvbmVudC5wcm90b3R5cGUsIFwibWF4SGVpZ2h0XCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBPdXRwdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgRXZlbnRFbWl0dGVyKVxuXSwgRGlhbG9nQ29tcG9uZW50LnByb3RvdHlwZSwgXCJhY3Rpb25cIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIE91dHB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBFdmVudEVtaXR0ZXIpXG5dLCBEaWFsb2dDb21wb25lbnQucHJvdG90eXBlLCBcImNsb3NlXCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBIb3N0QmluZGluZygnYXR0ci5kaXInKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgU3RyaW5nKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW10pXG5dLCBEaWFsb2dDb21wb25lbnQucHJvdG90eXBlLCBcImRpclwiLCBudWxsKTtcbl9fZGVjb3JhdGUoW1xuICAgIEhvc3RCaW5kaW5nKCdhdHRyLnRhYkluZGV4JyksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIE51bWJlcilcbl0sIERpYWxvZ0NvbXBvbmVudC5wcm90b3R5cGUsIFwidGFiSW5kZXhcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIENvbnRlbnRDaGlsZHJlbihEaWFsb2dUaXRsZUJhckNvbXBvbmVudCwgeyBkZXNjZW5kYW50czogZmFsc2UgfSksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIFF1ZXJ5TGlzdClcbl0sIERpYWxvZ0NvbXBvbmVudC5wcm90b3R5cGUsIFwidGl0bGViYXJDb250ZW50XCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBWaWV3Q2hpbGQoRGlhbG9nVGl0bGVCYXJDb21wb25lbnQsIHsgc3RhdGljOiBmYWxzZSB9KSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgRGlhbG9nVGl0bGVCYXJDb21wb25lbnQpXG5dLCBEaWFsb2dDb21wb25lbnQucHJvdG90eXBlLCBcInRpdGxlYmFyVmlld1wiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgVmlld0NoaWxkKERpYWxvZ0FjdGlvbnNDb21wb25lbnQsIHsgc3RhdGljOiBmYWxzZSB9KSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgRGlhbG9nQWN0aW9uc0NvbXBvbmVudClcbl0sIERpYWxvZ0NvbXBvbmVudC5wcm90b3R5cGUsIFwiYWN0aW9uc1ZpZXdcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIEhvc3RMaXN0ZW5lcigna2V5ZG93bicsIFsnJGV2ZW50J10pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBGdW5jdGlvbiksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtPYmplY3RdKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnJldHVybnR5cGVcIiwgdm9pZCAwKVxuXSwgRGlhbG9nQ29tcG9uZW50LnByb3RvdHlwZSwgXCJvbkNvbXBvbmVudEtleWRvd25cIiwgbnVsbCk7XG5fX2RlY29yYXRlKFtcbiAgICBIb3N0QmluZGluZygnY2xhc3Muay1kaWFsb2ctd3JhcHBlcicpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBCb29sZWFuKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW10pXG5dLCBEaWFsb2dDb21wb25lbnQucHJvdG90eXBlLCBcIndyYXBwZXJDbGFzc1wiLCBudWxsKTtcbkRpYWxvZ0NvbXBvbmVudCA9IF9fZGVjb3JhdGUoW1xuICAgIENvbXBvbmVudCh7XG4gICAgICAgIGFuaW1hdGlvbnM6IFtcbiAgICAgICAgICAgIHRyaWdnZXIoJ292ZXJsYXlBcHBlYXInLCBbXG4gICAgICAgICAgICAgICAgc3RhdGUoJ2luJywgc3R5bGUoeyBvcGFjaXR5OiAxIH0pKSxcbiAgICAgICAgICAgICAgICB0cmFuc2l0aW9uKCd2b2lkID0+IConLCBbc3R5bGUoeyBvcGFjaXR5OiAwLjEgfSksIGFuaW1hdGUoJy4zcyBjdWJpYy1iZXppZXIoLjIsIC42LCAuNCwgMSknKV0pXG4gICAgICAgICAgICBdKSxcbiAgICAgICAgICAgIHRyaWdnZXIoJ2RpYWxvZ1NsaWRlSW5BcHBlYXInLCBbXG4gICAgICAgICAgICAgICAgc3RhdGUoJ2luJywgc3R5bGUoeyB0cmFuc2Zvcm06ICd0cmFuc2xhdGUoMCwgMCknIH0pKSxcbiAgICAgICAgICAgICAgICB0cmFuc2l0aW9uKCd2b2lkID0+IConLCBbc3R5bGUoeyB0cmFuc2Zvcm06ICd0cmFuc2xhdGUoMCwgLTEwJSknIH0pLCBhbmltYXRlKCcuM3MgY3ViaWMtYmV6aWVyKC4yLCAxLCAuMiwgMSknKV0pXG4gICAgICAgICAgICBdKVxuICAgICAgICBdLFxuICAgICAgICBleHBvcnRBczogJ2tlbmRvRGlhbG9nJyxcbiAgICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgICAgICBMb2NhbGl6YXRpb25TZXJ2aWNlLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHByb3ZpZGU6IERJQUxPR19MT0NBTElaQVRJT05fU0VSVklDRSxcbiAgICAgICAgICAgICAgICB1c2VFeGlzdGluZzogTG9jYWxpemF0aW9uU2VydmljZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBwcm92aWRlOiBMMTBOX1BSRUZJWCxcbiAgICAgICAgICAgICAgICB1c2VWYWx1ZTogJ2tlbmRvLmRpYWxvZydcbiAgICAgICAgICAgIH1cbiAgICAgICAgXSxcbiAgICAgICAgc2VsZWN0b3I6ICdrZW5kby1kaWFsb2cnLFxuICAgICAgICB0ZW1wbGF0ZTogYFxuICAgICAgICA8bmctY29udGFpbmVyXG4gICAgICAgICAgICBrZW5kb0RpYWxvZ0xvY2FsaXplZE1lc3NhZ2VzXG4gICAgICAgICAgICBpMThuLWNsb3NlVGl0bGU9XCJrZW5kby5kaWFsb2cuY2xvc2VUaXRsZXxUaGUgdGl0bGUgb2YgdGhlIGNsb3NlIGJ1dHRvblwiXG4gICAgICAgICAgICBjbG9zZVRpdGxlPVwiQ2xvc2VcIlxuICAgICAgICA+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJrLW92ZXJsYXlcIiBAb3ZlcmxheUFwcGVhcj48L2Rpdj5cblxuICAgICAgICA8ZGl2IGNsYXNzPVwiay13aWRnZXQgay13aW5kb3cgay1kaWFsb2dcIiByb2xlPVwiZGlhbG9nXCIgW25nU3R5bGVdPVwic3R5bGVzXCIgQGRpYWxvZ1NsaWRlSW5BcHBlYXI+XG4gICAgICAgICAgICA8a2VuZG8tZGlhbG9nLXRpdGxlYmFyICpuZ0lmPVwidGl0bGVcIiBbY2xvc2VUaXRsZV09XCJjbG9zZVRpdGxlXCIgW2lkXT1cInRpdGxlSWRcIj57eyB0aXRsZSB9fTwva2VuZG8tZGlhbG9nLXRpdGxlYmFyPlxuICAgICAgICAgICAgPG5nLWNvbnRlbnQgc2VsZWN0PVwia2VuZG8tZGlhbG9nLXRpdGxlYmFyXCIgKm5nSWY9XCIhdGl0bGVcIj48L25nLWNvbnRlbnQ+XG5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJrLWNvbnRlbnQgay13aW5kb3ctY29udGVudCBrLWRpYWxvZy1jb250ZW50XCI+XG4gICAgICAgICAgICAgICAgPG5nLWNvbnRlbnQgKm5nSWY9XCIhY29udGVudFRlbXBsYXRlXCI+PC9uZy1jb250ZW50PlxuICAgICAgICAgICAgICAgIDxuZy10ZW1wbGF0ZSBbbmdUZW1wbGF0ZU91dGxldF09XCJjb250ZW50VGVtcGxhdGVcIiAqbmdJZj1cImNvbnRlbnRUZW1wbGF0ZVwiPjwvbmctdGVtcGxhdGU+XG4gICAgICAgICAgICA8L2Rpdj5cblxuICAgICAgICAgICAgPG5nLWNvbnRlbnQgc2VsZWN0PVwia2VuZG8tZGlhbG9nLWFjdGlvbnNcIiAqbmdJZj1cIiFhY3Rpb25zXCI+PC9uZy1jb250ZW50PlxuICAgICAgICAgICAgPGtlbmRvLWRpYWxvZy1hY3Rpb25zICpuZ0lmPVwiYWN0aW9uc1wiIFthY3Rpb25zXT1cImFjdGlvbnNcIiBbbGF5b3V0XT1cImFjdGlvbnNMYXlvdXRcIj4gPC9rZW5kby1kaWFsb2ctYWN0aW9ucz5cbiAgICAgICAgPC9kaXY+XG4gICAgPC9uZy1jb250YWluZXI+XG4gICAgYFxuICAgIH0pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbRWxlbWVudFJlZixcbiAgICAgICAgUmVuZGVyZXIyLFxuICAgICAgICBMb2NhbGl6YXRpb25TZXJ2aWNlLFxuICAgICAgICBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICAgICAgTmdab25lXSlcbl0sIERpYWxvZ0NvbXBvbmVudCk7XG5cbi8qKlxuICogVGhlIGJhc2UgY2xhc3MgIHdoaWNoIHdpbGwgYmUgZXh0ZW5kZWQgYnkgYSBjb21wb25lbnQgdGhhdCBpcyBwcm92aWRlZCBhcyBjb250ZW50IHRocm91Z2ggYGNvbnRlbnRgXG4gKiAoW3NlZSBleGFtcGxlXSh7JSBzbHVnIHNlcnZpY2VfZGlhbG9nICV9I3RvYy1wYXNzaW5nLXRpdGxlLWNvbnRlbnQtYW5kLWFjdGlvbnMtYXMtYS1zaW5nbGUtY29tcG9uZW50KSkuXG4gKi9cbmNsYXNzIERpYWxvZ0NvbnRlbnRCYXNlIHtcbiAgICBjb25zdHJ1Y3RvcihkaWFsb2cpIHtcbiAgICAgICAgdGhpcy5kaWFsb2cgPSBkaWFsb2c7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgICAgIGlmICh0aGlzLmRpYWxvZ1RpdGxlQmFyKSB7XG4gICAgICAgICAgICAvLyB3aGVuIG9wZW5pbmcgY29tcG9uZW50IGluc2lkZSBkaWFsb2cgd2l0aCBzZXJ2aWNlIEFORCB0aGUgY29tcG9uZW50IGhhcyBkZWZpbmVkIGl0cyBvd24gdGl0bGViYXJcbiAgICAgICAgICAgIHRoaXMuZGlhbG9nVGl0bGVCYXIuY2xvc2UucGlwZShmaWx0ZXIoKGUpID0+ICFlLmlzRGVmYXVsdFByZXZlbnRlZCgpKSkuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpYWxvZy5jbG9zZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuZGlhbG9nQWN0aW9ucykge1xuICAgICAgICAgICAgaWYgKHRoaXMuZGlhbG9nQWN0aW9ucy5hY3Rpb25zKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kaWFsb2dBY3Rpb25zLmFjdGlvbi5zdWJzY3JpYmUoYWN0aW9uID0+IHRoaXMuZGlhbG9nLmRpYWxvZy5pbnN0YW5jZS5hY3Rpb24uZW1pdChhY3Rpb24pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cbl9fZGVjb3JhdGUoW1xuICAgIFZpZXdDaGlsZChEaWFsb2dUaXRsZUJhckNvbXBvbmVudCwgeyBzdGF0aWM6IGZhbHNlIH0pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBEaWFsb2dUaXRsZUJhckNvbXBvbmVudClcbl0sIERpYWxvZ0NvbnRlbnRCYXNlLnByb3RvdHlwZSwgXCJkaWFsb2dUaXRsZUJhclwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgVmlld0NoaWxkKERpYWxvZ0FjdGlvbnNDb21wb25lbnQsIHsgc3RhdGljOiBmYWxzZSB9KSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgRGlhbG9nQWN0aW9uc0NvbXBvbmVudClcbl0sIERpYWxvZ0NvbnRlbnRCYXNlLnByb3RvdHlwZSwgXCJkaWFsb2dBY3Rpb25zXCIsIHZvaWQgMCk7XG5cbnZhciBEaWFsb2dDb250YWluZXJTZXJ2aWNlXzE7XG4vKipcbiAqIEBoaWRkZW5cbiAqL1xubGV0IERpYWxvZ0NvbnRhaW5lclNlcnZpY2UgPSBEaWFsb2dDb250YWluZXJTZXJ2aWNlXzEgPSBjbGFzcyBEaWFsb2dDb250YWluZXJTZXJ2aWNlIHtcbiAgICBzZXQgY29udGFpbmVyKGNvbnRhaW5lcikge1xuICAgICAgICBEaWFsb2dDb250YWluZXJTZXJ2aWNlXzEuY29udGFpbmVyID0gY29udGFpbmVyO1xuICAgIH1cbiAgICBnZXQgY29udGFpbmVyKCkge1xuICAgICAgICByZXR1cm4gRGlhbG9nQ29udGFpbmVyU2VydmljZV8xLmNvbnRhaW5lcjtcbiAgICB9XG59O1xuRGlhbG9nQ29udGFpbmVyU2VydmljZS5jb250YWluZXIgPSBudWxsO1xuRGlhbG9nQ29udGFpbmVyU2VydmljZSA9IERpYWxvZ0NvbnRhaW5lclNlcnZpY2VfMSA9IF9fZGVjb3JhdGUoW1xuICAgIEluamVjdGFibGUoKVxuXSwgRGlhbG9nQ29udGFpbmVyU2VydmljZSk7XG5cbmNvbnN0IGlzTm90Q29tcG9uZW50ID0gKGNvbXBvbmVudCkgPT4gaXNTdHJpbmcoY29tcG9uZW50KSB8fCBjb21wb25lbnQgaW5zdGFuY2VvZiBUZW1wbGF0ZVJlZjtcbmNsYXNzIERpYWxvZ0luamVjdG9yIHtcbiAgICBjb25zdHJ1Y3RvcihnZXREaWFsb2dSZWYsIHBhcmVudEluamVjdG9yKSB7XG4gICAgICAgIHRoaXMuZ2V0RGlhbG9nUmVmID0gZ2V0RGlhbG9nUmVmO1xuICAgICAgICB0aGlzLnBhcmVudEluamVjdG9yID0gcGFyZW50SW5qZWN0b3I7XG4gICAgfVxuICAgIGdldCh0b2tlbiwgbm90Rm91bmRWYWx1ZSkge1xuICAgICAgICBpZiAodG9rZW4gPT09IERpYWxvZ1JlZikge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RGlhbG9nUmVmKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMucGFyZW50SW5qZWN0b3IuZ2V0KHRva2VuLCBub3RGb3VuZFZhbHVlKTtcbiAgICB9XG59XG4vKipcbiAqIEEgc2VydmljZSBmb3Igb3BlbmluZyBEaWFsb2cgd2luZG93cyBkeW5hbWljYWxseVxuICogKFtzZWUgZXhhbXBsZV0oeyUgc2x1ZyBzZXJ2aWNlX2RpYWxvZyAlfSkpLlxuICovXG5sZXQgRGlhbG9nU2VydmljZSA9IGNsYXNzIERpYWxvZ1NlcnZpY2Uge1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICByZXNvbHZlciwgY29udGFpbmVyU2VydmljZSkge1xuICAgICAgICB0aGlzLnJlc29sdmVyID0gcmVzb2x2ZXI7XG4gICAgICAgIHRoaXMuY29udGFpbmVyU2VydmljZSA9IGNvbnRhaW5lclNlcnZpY2U7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIE9wZW5zIGEgRGlhbG9nIHdpbmRvdy4gUmVxdWlyZXMgYW4gZWxlbWVudCBpbiB0aGUgYXBwbGljYXRpb24gdGhhdCB1c2VzIHRoZVxuICAgICAqIFtga2VuZG9EaWFsb2dDb250YWluZXJgXSh7JSBzbHVnIGFwaV9kaWFsb2dfZGlhbG9nY29udGFpbmVyZGlyZWN0aXZlICV9KSBkaXJlY3RpdmUuXG4gICAgICogQ3JlYXRlZCBEaWFsb2dzIHdpbGwgYmUgbW91bnRlZCBpbiB0aGUgRE9NIGRpcmVjdGx5IGFmdGVyIHRoYXQgZWxlbWVudC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7RGlhbG9nQWN0aW9ufSBvcHRpb25zIC0gVGhlIG9wdGlvbnMgdGhhdCBkZWZpbmUgdGhlIERpYWxvZy5cbiAgICAgKiBAcmV0dXJucyB7RGlhbG9nUmVmfSAtIEEgcmVmZXJlbmNlIHRvIHRoZSBEaWFsb2cgb2JqZWN0IGFuZCB0aGUgY29udmVuaWVuY2UgcHJvcGVydGllcy5cbiAgICAgKlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBgYGB0cy1uby1ydW5cbiAgICAgKiBfQENvbXBvbmVudCh7XG4gICAgICogICBzZWxlY3RvcjogJ215LWFwcCcsXG4gICAgICogICB0ZW1wbGF0ZTogYFxuICAgICAqICAgICA8YnV0dG9uIGtlbmRvQnV0dG9uIChjbGljayk9XCJvcGVuKClcIj5IYXJtbGVzcyBidXR0b248L2J1dHRvbj5cbiAgICAgKiAgICAgPGRpdiBrZW5kb0RpYWxvZ0NvbnRhaW5lcj48L2Rpdj5cbiAgICAgKiAgIGBcbiAgICAgKiB9KVxuICAgICAqIGV4cG9ydCBjbGFzcyBBcHBDb21wb25lbnQge1xuICAgICAqICAgICBjb25zdHJ1Y3RvciggcHJpdmF0ZSBkaWFsb2dTZXJ2aWNlOiBEaWFsb2dTZXJ2aWNlICkge31cbiAgICAgKlxuICAgICAqICAgICBwdWJsaWMgb3BlbigpIHtcbiAgICAgKiAgICAgICAgIHZhciBkaWFsb2cgPSB0aGlzLmRpYWxvZ1NlcnZpY2Uub3Blbih7XG4gICAgICogICAgICAgICAgIHRpdGxlOiBcIlBsZWFzZSBjb25maXJtXCIsXG4gICAgICogICAgICAgICAgIGNvbnRlbnQ6IFwiQXJlIHlvdSBzdXJlP1wiLFxuICAgICAqICAgICAgICAgICBhY3Rpb25zOiBbXG4gICAgICogICAgICAgICAgICAgeyB0ZXh0OiBcIk5vXCIgfSxcbiAgICAgKiAgICAgICAgICAgICB7IHRleHQ6IFwiWWVzXCIsIHByaW1hcnk6IHRydWUgfVxuICAgICAqICAgICAgICAgICBdXG4gICAgICogICAgICAgICB9KTtcbiAgICAgKlxuICAgICAqICAgICAgICAgZGlhbG9nLnJlc3VsdC5zdWJzY3JpYmUoKHJlc3VsdCkgPT4ge1xuICAgICAqICAgICAgICAgICBpZiAocmVzdWx0IGluc3RhbmNlb2YgRGlhbG9nQ2xvc2VSZXN1bHQpIHtcbiAgICAgKiAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImNsb3NlXCIpO1xuICAgICAqICAgICAgICAgICB9IGVsc2Uge1xuICAgICAqICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiYWN0aW9uXCIsIHJlc3VsdCk7XG4gICAgICogICAgICAgICAgIH1cbiAgICAgKiAgICAgICAgIH0pO1xuICAgICAqICAgICB9XG4gICAgICogfVxuICAgICAqIGBgYFxuICAgICAqXG4gICAgICovXG4gICAgb3BlbihvcHRpb25zKSB7XG4gICAgICAgIGNvbnN0IGZhY3RvcnkgPSB0aGlzLnJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KERpYWxvZ0NvbXBvbmVudCk7XG4gICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IG9wdGlvbnMuYXBwZW5kVG8gfHwgdGhpcy5jb250YWluZXJTZXJ2aWNlLmNvbnRhaW5lcjtcbiAgICAgICAgaWYgKCFjb250YWluZXIpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgXG5DYW5ub3QgYXR0YWNoIGRpYWxvZyB0byB0aGUgcGFnZS5cbkFkZCBhbiBlbGVtZW50IHRoYXQgdXNlcyB0aGUga2VuZG9EaWFsb2dDb250YWluZXIgZGlyZWN0aXZlLCBvciBzZXQgdGhlICdhcHBlbmRUbycgcHJvcGVydHkuXG5TZWUgaHR0cHM6Ly93d3cudGVsZXJpay5jb20va2VuZG8tYW5ndWxhci11aS9jb21wb25lbnRzL2RpYWxvZ3MvZGlhbG9nL3NlcnZpY2UvLlxuICAgICAgICAgIGApO1xuICAgICAgICB9XG4gICAgICAgIC8vIGNyZWF0ZSBEaWFsb2dSZWYgdG8gKDEpIHBhc3MgYXMgcmVzdWx0LCAoMikgcHJvdmlkZSB0aHJvdWdoIGluamVjdG9yXG4gICAgICAgIGNvbnN0IGRpYWxvZ1JlZiA9IHtcbiAgICAgICAgICAgIGNsb3NlOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgLyogbm9vcCAqL1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbnRlbnQ6IG51bGwsXG4gICAgICAgICAgICBkaWFsb2c6IG51bGwsXG4gICAgICAgICAgICByZXN1bHQ6IG51bGxcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5pdGlhbGl6ZURpYWxvZyhvcHRpb25zLmNvbnRlbnQsIGZhY3RvcnksIGNvbnRhaW5lciwgZGlhbG9nUmVmLCBvcHRpb25zKTtcbiAgICB9XG4gICAgaW5pdGlhbGl6ZURpYWxvZyhjb21wb25lbnQsIGZhY3RvcnksIGNvbnRhaW5lciwgZGlhbG9nUmVmLCBvcHRpb25zKSB7XG4gICAgICAgIGNvbnN0IGNvbnRlbnQgPSB0aGlzLmNvbnRlbnRGcm9tKGNvbXBvbmVudCwgY29udGFpbmVyLCBkaWFsb2dSZWYpO1xuICAgICAgICBjb25zdCBkaWFsb2cgPSBjb250YWluZXIuY3JlYXRlQ29tcG9uZW50KGZhY3RvcnksIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBjb250ZW50Lm5vZGVzKTtcbiAgICAgICAgZGlhbG9nUmVmLmRpYWxvZyA9IGRpYWxvZztcbiAgICAgICAgZGlhbG9nLmNoYW5nZURldGVjdG9yUmVmLm1hcmtGb3JDaGVjaygpO1xuICAgICAgICAvLyBjb3B5IEBJbnB1dCBvcHRpb25zIHRvIGRpYWxvZyBpbnN0YW5jZVxuICAgICAgICB0aGlzLmFwcGx5T3B0aW9ucyhkaWFsb2cuaW5zdGFuY2UsIG9wdGlvbnMpO1xuICAgICAgICAvLyBjcmVhdGUgY2xvc2UgaGFuZGxlciBhbmQgcmVzdWx0IHN0cmVhbVxuICAgICAgICBjb25zdCBhcGlDbG9zZSA9IG5ldyBTdWJqZWN0KCk7XG4gICAgICAgIGNvbnN0IGNsb3NlID0gKGUpID0+IHtcbiAgICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgUHJldmVudGFibGVFdmVudCkge1xuICAgICAgICAgICAgICAgIGUgPSBuZXcgRGlhbG9nQ2xvc2VSZXN1bHQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGFwaUNsb3NlLm5leHQoZSB8fCBuZXcgRGlhbG9nQ2xvc2VSZXN1bHQoKSk7XG4gICAgICAgICAgICBpZiAoY29udGVudC5jb21wb25lbnRSZWYpIHtcbiAgICAgICAgICAgICAgICBjb250ZW50LmNvbXBvbmVudFJlZi5kZXN0cm95KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkaWFsb2cuZGVzdHJveSgpO1xuICAgICAgICB9O1xuICAgICAgICBjb25zdCByZXN1bHQgPSBtZXJnZShhcGlDbG9zZSwgXG4gICAgICAgIC8vIHRyaWdnZXJlZCB3aGVuIHRoZSB0aXRsZWJhciBvciBhY3Rpb25zIGFyZSBkZWZpbmVkIGluIERpYWxvZ1NldHRpbmdzXG4gICAgICAgIG1lcmdlKGRpYWxvZy5pbnN0YW5jZS5jbG9zZSwgZGlhbG9nLmluc3RhbmNlLmFjdGlvbikucGlwZShtYXAoZSA9PiAoZSBpbnN0YW5jZW9mIFByZXZlbnRhYmxlRXZlbnQgPyBuZXcgRGlhbG9nQ2xvc2VSZXN1bHQoKSA6IGUpKSwgZmlsdGVyKGUgPT4ge1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMucHJldmVudEFjdGlvbikge1xuICAgICAgICAgICAgICAgIC8vIGFkZCBkaWFsb2dSZWYgb25seSB3aGVuIHVzaW5nIGNvbXBvbmVudFxuICAgICAgICAgICAgICAgIGNvbnN0IGRpYWxvZ1JlZlBhcmFtZXRlciA9IGlzTm90Q29tcG9uZW50KGNvbXBvbmVudCkgPyB1bmRlZmluZWQgOiBkaWFsb2dSZWY7XG4gICAgICAgICAgICAgICAgcmV0dXJuICFvcHRpb25zLnByZXZlbnRBY3Rpb24oZSwgZGlhbG9nUmVmUGFyYW1ldGVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9KSkpLnBpcGUodGFrZSgxKSwgXG4gICAgICAgIC8vIFRha2VzIGNhcmUgZm9yIG11bHRpcGxlIHN1YnNjcmlwdGlvbnM6XG4gICAgICAgIC8vIFdlIHN1YnNjcmliZSBpbnRlcm5hbHkgYW5kIHRoZSB1c2VyIG1heSBzdWJzY3JpYmUgdG8gZ2V0IGEgY2xvc2UgcmVzdWx0IC0gZGlhbG9nLnJlc3VsdC5zdWJzY3JpYmUoKS5cbiAgICAgICAgLy8gVGhpcyBjYXVzZXMgbXVsdGlwbGUgc3Vic2NyaXB0aW9ucyB0byB0aGUgc2FtZSBzb3VyY2UgYW5kIHRodXMgbXVsdGlwbGUgZW1pc3Npb25zLiBzaGFyZSgpIHNvbHZlcyB0aGF0LlxuICAgICAgICBzaGFyZSgpKTtcbiAgICAgICAgcmVzdWx0LnN1YnNjcmliZShjbG9zZSk7XG4gICAgICAgIGRpYWxvZ1JlZi5jbG9zZSA9IGNsb3NlO1xuICAgICAgICBkaWFsb2dSZWYucmVzdWx0ID0gcmVzdWx0O1xuICAgICAgICBpZiAoY29tcG9uZW50ICYmIGlzRGV2TW9kZSgpKSB7XG4gICAgICAgICAgICBjb25zdCBoYXNDb250ZW50VGl0bGUgPSBjb250ZW50Lm5vZGVzWzBdICYmIGNvbnRlbnQubm9kZXNbMF0ubGVuZ3RoID4gMDtcbiAgICAgICAgICAgIGNvbnN0IGhhc0NvbnRlbnRBY3Rpb25zID0gY29udGVudC5ub2Rlc1syXSAmJiBjb250ZW50Lm5vZGVzWzJdLmxlbmd0aCA+IDA7XG4gICAgICAgICAgICBjb25zdCBtdWx0aXBsZVRpdGxlcyA9IG9wdGlvbnMudGl0bGUgJiYgaGFzQ29udGVudFRpdGxlO1xuICAgICAgICAgICAgY29uc3QgbXVsdGlwbGVBY3Rpb25zID0gb3B0aW9ucy5hY3Rpb25zICYmIGhhc0NvbnRlbnRBY3Rpb25zO1xuICAgICAgICAgICAgaWYgKGNvbXBvbmVudC5wcm90b3R5cGUgaW5zdGFuY2VvZiBEaWFsb2dDb250ZW50QmFzZSkge1xuICAgICAgICAgICAgICAgIC8vIGNvbnRlbnQgY29tcG9uZW50IGV4dGVuZHMgRGlhbG9nQ29udGVudEJhc2VcbiAgICAgICAgICAgICAgICBpZiAobXVsdGlwbGVUaXRsZXMgfHwgbXVsdGlwbGVBY3Rpb25zKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihgXG4gICAgICAgICAgICAgICAgICAgIE11bHRpcGxlIFRpdGxlIGFuZC9vciBBY3Rpb25zIGNvbmZpZ3VyYXRpb25zIGRldGVjdGVkLlxuICAgICAgICAgICAgICAgICAgICBXaGVuIHVzaW5nIGEgY29tcG9uZW50IGFzIGNvbnRlbnQsIHByb3ZpZGUgdGhlIHRpdGxlIGFuZCBhY3Rpb25zIGVpdGhlciBpbiB0aGUgY29tcG9uZW50J3MgbWFya3VwXG4gICAgICAgICAgICAgICAgICAgIG9yIHZpYSB0aGUgdGl0bGUgYW5kIGFjdGlvbnMgcHJvcGVydGllcyBvZiB0aGUgRGlhbG9nU2V0dGluZ3Mgb2JqZWN0LCBidXQgbm90IGJvdGguXG4gICAgICAgICAgICAgICAgICAgIFNlZSBodHRwczovL3d3dy50ZWxlcmlrLmNvbS9rZW5kby1hbmd1bGFyLXVpL2NvbXBvbmVudHMvZGlhbG9ncy9kaWFsb2cvc2VydmljZS8jdG9jLXBhc3NpbmctdGl0bGUtY29udGVudC1hbmQtYWN0aW9ucy1hcy1hLXNpbmdsZS1jb21wb25lbnQnYCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKGhhc0NvbnRlbnRUaXRsZSB8fCBoYXNDb250ZW50QWN0aW9ucykge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYFxuICAgICAgICAgICAgICAgICAgICBXaGVuIFRpdGxlIGFuZC9vciBBY3Rpb25zIG1hcmt1cCBpcyBwcm92aWRlZCBpbiBjb250ZW50IGNvbXBvbmVudCdzIHRlbXBsYXRlLFxuICAgICAgICAgICAgICAgICAgICB0aGUgY29tcG9uZW50IG5lZWRzIHRvIGluaGVyaXQgdGhlIERpYWxvZ0NvbnRlbnRCYXNlIGNsYXNzIHRvIGVuc3VyZSB0aGF0IGNsb3NlIGFuZCByZXN1bHQgZXZlbnRzIGFyZSBwcm9wZXJseSBob29rZWQuXG4gICAgICAgICAgICAgICAgICAgIFNlZSBodHRwczovL3d3dy50ZWxlcmlrLmNvbS9rZW5kby1hbmd1bGFyLXVpL2NvbXBvbmVudHMvZGlhbG9ncy9kaWFsb2cvc2VydmljZS8jdG9jLXBhc3NpbmctdGl0bGUtY29udGVudC1hbmQtYWN0aW9ucy1hcy1hLXNpbmdsZS1jb21wb25lbnQnYCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBkaWFsb2dSZWY7XG4gICAgfVxuICAgIGFwcGx5T3B0aW9ucyhpbnN0YW5jZSwgb3B0aW9ucykge1xuICAgICAgICBpbnN0YW5jZS50aXRsZSA9IG9wdGlvbnMudGl0bGU7XG4gICAgICAgIGluc3RhbmNlLmFjdGlvbnMgPSBvcHRpb25zLmFjdGlvbnM7XG4gICAgICAgIGluc3RhbmNlLmFjdGlvbnNMYXlvdXQgPSBvcHRpb25zLmFjdGlvbnNMYXlvdXQgfHwgJ3N0cmV0Y2hlZCc7XG4gICAgICAgIGluc3RhbmNlLndpZHRoID0gb3B0aW9ucy53aWR0aDtcbiAgICAgICAgaW5zdGFuY2UubWluV2lkdGggPSBvcHRpb25zLm1pbldpZHRoO1xuICAgICAgICBpbnN0YW5jZS5tYXhXaWR0aCA9IG9wdGlvbnMubWF4V2lkdGg7XG4gICAgICAgIGluc3RhbmNlLmhlaWdodCA9IG9wdGlvbnMuaGVpZ2h0O1xuICAgICAgICBpbnN0YW5jZS5taW5IZWlnaHQgPSBvcHRpb25zLm1pbkhlaWdodDtcbiAgICAgICAgaW5zdGFuY2UubWF4SGVpZ2h0ID0gb3B0aW9ucy5tYXhIZWlnaHQ7XG4gICAgICAgIGluc3RhbmNlLmF1dG9Gb2N1c2VkRWxlbWVudCA9IG9wdGlvbnMuYXV0b0ZvY3VzZWRFbGVtZW50O1xuICAgICAgICBpbnN0YW5jZS5jbG9zZVRpdGxlID0gb3B0aW9ucy5jbG9zZVRpdGxlO1xuICAgICAgICBpZiAob3B0aW9ucy5jb250ZW50IGluc3RhbmNlb2YgVGVtcGxhdGVSZWYpIHtcbiAgICAgICAgICAgIGluc3RhbmNlLmNvbnRlbnRUZW1wbGF0ZSA9IG9wdGlvbnMuY29udGVudDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb250ZW50RnJvbShjb250ZW50LCBjb250YWluZXIsIGRpYWxvZ1JlZikge1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGNvbnRhaW5lci5pbmplY3Rvci5nZXQoUmVuZGVyZXIyKTtcbiAgICAgICAgbGV0IG5vZGVzID0gW107XG4gICAgICAgIGxldCB0aXRsZU5vZGVzID0gW107XG4gICAgICAgIGxldCBhY3Rpb25Ob2RlcyA9IFtdO1xuICAgICAgICBsZXQgY29tcG9uZW50UmVmID0gbnVsbDtcbiAgICAgICAgaWYgKHR5cGVvZiBjb250ZW50ID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgbm9kZXMgPSBbcmVuZGVyZXIuY3JlYXRlVGV4dChjb250ZW50KV07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY29udGVudCAmJiAhKGNvbnRlbnQgaW5zdGFuY2VvZiBUZW1wbGF0ZVJlZikpIHtcbiAgICAgICAgICAgIC8vIENvbXBvbmVudFxuICAgICAgICAgICAgY29uc3QgaW5qZWN0b3IgPSBuZXcgRGlhbG9nSW5qZWN0b3IoKCkgPT4gZGlhbG9nUmVmLCBjb250YWluZXIuaW5qZWN0b3IpO1xuICAgICAgICAgICAgY29uc3QgZmFjdG9yeSA9IHRoaXMucmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoY29udGVudCk7XG4gICAgICAgICAgICBjb21wb25lbnRSZWYgPSBjb250YWluZXIuY3JlYXRlQ29tcG9uZW50KGZhY3RvcnksIHVuZGVmaW5lZCwgaW5qZWN0b3IpO1xuICAgICAgICAgICAgdGl0bGVOb2RlcyA9IEFycmF5LmZyb20oY29tcG9uZW50UmVmLmxvY2F0aW9uLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCgna2VuZG8tZGlhbG9nLXRpdGxlYmFyJykpO1xuICAgICAgICAgICAgbm9kZXMgPSBbY29tcG9uZW50UmVmLmxvY2F0aW9uLm5hdGl2ZUVsZW1lbnRdO1xuICAgICAgICAgICAgYWN0aW9uTm9kZXMgPSBBcnJheS5mcm9tKGNvbXBvbmVudFJlZi5sb2NhdGlvbi5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2tlbmRvLWRpYWxvZy1hY3Rpb25zJykpO1xuICAgICAgICAgICAgZGlhbG9nUmVmLmNvbnRlbnQgPSBjb21wb25lbnRSZWY7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGNvbXBvbmVudFJlZixcbiAgICAgICAgICAgIG5vZGVzOiBbXG4gICAgICAgICAgICAgICAgdGl0bGVOb2RlcyxcbiAgICAgICAgICAgICAgICBub2RlcyxcbiAgICAgICAgICAgICAgICBhY3Rpb25Ob2RlcyAvLyA8bmctY29udGVudCBzZWxlY3Q9XCJrZW5kby1kaWFsb2ctYWN0aW9uc1wiPlxuICAgICAgICAgICAgXVxuICAgICAgICB9O1xuICAgIH1cbn07XG5EaWFsb2dTZXJ2aWNlID0gX19kZWNvcmF0ZShbXG4gICAgSW5qZWN0YWJsZSgpLFxuICAgIF9fcGFyYW0oMSwgSW5qZWN0KERpYWxvZ0NvbnRhaW5lclNlcnZpY2UpKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW0NvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcbiAgICAgICAgRGlhbG9nQ29udGFpbmVyU2VydmljZV0pXG5dLCBEaWFsb2dTZXJ2aWNlKTtcblxuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmxldCBuZXdaSW5kZXggPSAxMDAwMjtcbi8qKlxuICogQGhpZGRlblxuICovXG5jb25zdCBERUZBVUxUX09QVElPTlMgPSB7XG4gICAgZHJhZ2dhYmxlOiB0cnVlLFxuICAgIGhlaWdodDogbnVsbCxcbiAgICBsZWZ0OiBudWxsLFxuICAgIG1pbkhlaWdodDogMTAwLFxuICAgIG1pbldpZHRoOiAxMjAsXG4gICAgcG9zaXRpb246ICdhYnNvbHV0ZScsXG4gICAgcmVzaXphYmxlOiB0cnVlLFxuICAgIHN0YXRlOiAnZGVmYXVsdCcsXG4gICAgdG9wOiBudWxsLFxuICAgIHdpZHRoOiBudWxsXG59O1xuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmNvbnN0IGNyZWF0ZU1vdmVTdHJlYW0gPSAoZWwsIGV2KSA9PiBtb3VzZURvd24gPT4ge1xuICAgIHJldHVybiBlbC5rZW5kb0RyYWdcbiAgICAgICAgLnBpcGUodGFrZVVudGlsKGVsLmtlbmRvUmVsZWFzZS5waXBlKHRhcCgoKSA9PiB7IGV2LmVtaXQoKTsgfSkpKSwgbWFwKCh7IHBhZ2VYLCBwYWdlWSB9KSA9PiAoe1xuICAgICAgICBvcmlnaW5hbFg6IG1vdXNlRG93bi5wYWdlWCxcbiAgICAgICAgb3JpZ2luYWxZOiBtb3VzZURvd24ucGFnZVksXG4gICAgICAgIHBhZ2VYLFxuICAgICAgICBwYWdlWVxuICAgIH0pKSk7XG59O1xuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmxldCBEcmFnUmVzaXplU2VydmljZSA9IGNsYXNzIERyYWdSZXNpemVTZXJ2aWNlIHtcbiAgICBjb25zdHJ1Y3RvcihuZ1pvbmUpIHtcbiAgICAgICAgdGhpcy5uZ1pvbmUgPSBuZ1pvbmU7XG4gICAgICAgIHRoaXMuY2xvc2UgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIHRoaXMuZm9jdXMgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIHRoaXMuY2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICB0aGlzLnN0YXRlQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICB0aGlzLmRyYWdTdGFydCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgdGhpcy5kcmFnRW5kID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICB0aGlzLnJlc2l6ZVN0YXJ0ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICB0aGlzLnJlc2l6ZUVuZCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gT2JqZWN0LmFzc2lnbih7fSwgREVGQVVMVF9PUFRJT05TKTtcbiAgICAgICAgdGhpcy5sYXN0QWN0aW9uID0gbnVsbDtcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zID0gbmV3IFN1YnNjcmlwdGlvbigpO1xuICAgICAgICB0aGlzLmRyYWdTdWJzY3JpcHRpb24gPSBuZXcgU3Vic2NyaXB0aW9uKCk7XG4gICAgfVxuICAgIG5nT25EZXN0cm95KCkge1xuICAgICAgICBpZiAodGhpcy5zdWJzY3JpcHRpb25zKSB7XG4gICAgICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnMudW5zdWJzY3JpYmUoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5kcmFnU3Vic2NyaXB0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLmRyYWdTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpbml0KGVsKSB7XG4gICAgICAgIGNvbnN0IHN0YXRlJCQxID0gdGhpcy5vcHRpb25zLnN0YXRlO1xuICAgICAgICBsZXQgb3B0aW9ucyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgdGhpcy53aW5kb3cgPSBlbDtcbiAgICAgICAgaWYgKHN0YXRlJCQxICE9PSAnZGVmYXVsdCcpIHtcbiAgICAgICAgICAgIHRoaXMucmVzdG9yZU9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHt9LCBvcHRpb25zKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc3RhdGUkJDEgPT09ICdtaW5pbWl6ZWQnKSB7XG4gICAgICAgICAgICBvcHRpb25zLmhlaWdodCA9IDA7XG4gICAgICAgICAgICBvcHRpb25zLm1pbkhlaWdodCA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHN0YXRlJCQxID09PSAnbWF4aW1pemVkJykge1xuICAgICAgICAgICAgb3B0aW9ucy5wb3NpdGlvbiA9ICdmaXhlZCc7XG4gICAgICAgIH1cbiAgICB9XG4gICAgb25EcmFnKGVsKSB7XG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5hZGQodGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgICAgICAgbGV0IHN0YXJ0UG9zaXRpb247XG4gICAgICAgICAgICBsZXQgZHJhZ1N0YXJ0ZWQ7XG4gICAgICAgICAgICB0aGlzLmRyYWdTdWJzY3JpcHRpb24gPSBlbC5rZW5kb1ByZXNzXG4gICAgICAgICAgICAgICAgLnBpcGUodGFwKChldikgPT4ge1xuICAgICAgICAgICAgICAgIGlmICghZXYuaXNUb3VjaCkge1xuICAgICAgICAgICAgICAgICAgICBwcmV2ZW50RGVmYXVsdChldik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuZm9jdXMuZW1pdCgpO1xuICAgICAgICAgICAgICAgIHN0YXJ0UG9zaXRpb24gPSB0aGlzLmN1cnJlbnRQb3NpdGlvbigpO1xuICAgICAgICAgICAgICAgIGRyYWdTdGFydGVkID0gZmFsc2U7XG4gICAgICAgICAgICB9KSwgc3dpdGNoTWFwKGNyZWF0ZU1vdmVTdHJlYW0oZWwsIHRoaXMuZHJhZ0VuZCkpKVxuICAgICAgICAgICAgICAgIC5zdWJzY3JpYmUoKHsgcGFnZVgsIHBhZ2VZLCBvcmlnaW5hbFgsIG9yaWdpbmFsWSB9KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCFkcmFnU3RhcnRlZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmVuc3VyZVdpZHRoKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZHJhZ1N0YXJ0LmVtaXQoKTtcbiAgICAgICAgICAgICAgICAgICAgZHJhZ1N0YXJ0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZURyYWcoe1xuICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbFgsIG9yaWdpbmFsWSxcbiAgICAgICAgICAgICAgICAgICAgcGFnZVgsIHBhZ2VZLCBzdGFydFBvc2l0aW9uXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBoYW5kbGVEcmFnKHsgb3JpZ2luYWxYLCBvcmlnaW5hbFksIHBhZ2VYLCBwYWdlWSwgc3RhcnRQb3NpdGlvbiB9KSB7XG4gICAgICAgIHRoaXMub3B0aW9ucy5sZWZ0ID0gc3RhcnRQb3NpdGlvbi54ICsgcGFnZVggLSBvcmlnaW5hbFg7XG4gICAgICAgIHRoaXMub3B0aW9ucy50b3AgPSBzdGFydFBvc2l0aW9uLnkgKyBwYWdlWSAtIG9yaWdpbmFsWTtcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5zdGF0ZSA9PT0gJ21pbmltaXplZCcgJiYgaXNQcmVzZW50KHRoaXMucmVzdG9yZU9wdGlvbnMpKSB7XG4gICAgICAgICAgICB0aGlzLnJlc3RvcmVPcHRpb25zLmxlZnQgPSB0aGlzLm9wdGlvbnMubGVmdDtcbiAgICAgICAgICAgIHRoaXMucmVzdG9yZU9wdGlvbnMudG9wID0gdGhpcy5vcHRpb25zLnRvcDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNoYW5nZS5lbWl0KHtcbiAgICAgICAgICAgIGxlZnQ6IHN0YXJ0UG9zaXRpb24ueCArIHBhZ2VYIC0gb3JpZ2luYWxYLFxuICAgICAgICAgICAgdG9wOiBzdGFydFBvc2l0aW9uLnkgKyBwYWdlWSAtIG9yaWdpbmFsWVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgb25SZXNpemUoaGFuZGxlLCBkaXJlY3Rpb24pIHtcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zLmFkZCh0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICAgICAgICBsZXQgc3RhcnRPZmZzZXRBbmRQb3NpdGlvbjtcbiAgICAgICAgICAgIGxldCByZXNpemVTdGFydGVkID0gZmFsc2U7XG4gICAgICAgICAgICBoYW5kbGUua2VuZG9QcmVzcy5waXBlKHRhcCgoZXYpID0+IHtcbiAgICAgICAgICAgICAgICBwcmV2ZW50RGVmYXVsdChldik7XG4gICAgICAgICAgICAgICAgdGhpcy5mb2N1cy5lbWl0KCk7XG4gICAgICAgICAgICAgICAgc3RhcnRPZmZzZXRBbmRQb3NpdGlvbiA9IHRoaXMuY3VycmVudE9mZnNldEFuZFBvc2l0aW9uKCk7XG4gICAgICAgICAgICAgICAgcmVzaXplU3RhcnRlZCA9IGZhbHNlO1xuICAgICAgICAgICAgfSksIHN3aXRjaE1hcChjcmVhdGVNb3ZlU3RyZWFtKGhhbmRsZSwgdGhpcy5yZXNpemVFbmQpKSlcbiAgICAgICAgICAgICAgICAuc3Vic2NyaWJlKCh7IHBhZ2VYLCBwYWdlWSwgb3JpZ2luYWxYLCBvcmlnaW5hbFkgfSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICghcmVzaXplU3RhcnRlZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlc2l6ZVN0YXJ0LmVtaXQoZGlyZWN0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgcmVzaXplU3RhcnRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGxldCBkZWx0YVggPSBwYWdlWCAtIG9yaWdpbmFsWDtcbiAgICAgICAgICAgICAgICBsZXQgZGVsdGFZID0gcGFnZVkgLSBvcmlnaW5hbFk7XG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVSZXNpemUoc3RhcnRPZmZzZXRBbmRQb3NpdGlvbiwgZGlyZWN0aW9uLCBkZWx0YVgsIGRlbHRhWSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBoYW5kbGVSZXNpemUoaW5pdGlhbCwgZGlyLCBkZWx0YVgsIGRlbHRhWSkge1xuICAgICAgICBjb25zdCBvbGQgPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgIGxldCBldiA9IHt9O1xuICAgICAgICBpZiAoZGlyLmluZGV4T2YoJ2UnKSA+PSAwKSB7XG4gICAgICAgICAgICBjb25zdCBuZXdXaWR0aCA9IGluaXRpYWwud2lkdGggKyBkZWx0YVg7XG4gICAgICAgICAgICBpZiAobmV3V2lkdGggIT09IG9sZC53aWR0aCAmJiBuZXdXaWR0aCA+PSBvbGQubWluV2lkdGgpIHtcbiAgICAgICAgICAgICAgICBldi53aWR0aCA9IG5ld1dpZHRoO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChkaXIuaW5kZXhPZignbicpID49IDApIHtcbiAgICAgICAgICAgIGNvbnN0IG5ld0hlaWdodCA9IGluaXRpYWwuaGVpZ2h0IC0gZGVsdGFZO1xuICAgICAgICAgICAgY29uc3QgbmV3VG9wID0gaW5pdGlhbC55ICsgZGVsdGFZO1xuICAgICAgICAgICAgaWYgKG5ld0hlaWdodCAhPT0gb2xkLmhlaWdodCAmJiBuZXdIZWlnaHQgPj0gb2xkLm1pbkhlaWdodCAmJiBuZXdUb3AgIT09IG9sZC50b3ApIHtcbiAgICAgICAgICAgICAgICBldi5oZWlnaHQgPSBuZXdIZWlnaHQ7XG4gICAgICAgICAgICAgICAgZXYudG9wID0gbmV3VG9wO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChkaXIuaW5kZXhPZigncycpID49IDApIHtcbiAgICAgICAgICAgIGNvbnN0IG5ld0hlaWdodCA9IGluaXRpYWwuaGVpZ2h0ICsgZGVsdGFZO1xuICAgICAgICAgICAgaWYgKG5ld0hlaWdodCAhPT0gb2xkLmhlaWdodCAmJiBuZXdIZWlnaHQgPj0gb2xkLm1pbkhlaWdodCkge1xuICAgICAgICAgICAgICAgIGV2LmhlaWdodCA9IG5ld0hlaWdodDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoZGlyLmluZGV4T2YoJ3cnKSA+PSAwKSB7XG4gICAgICAgICAgICBjb25zdCBuZXdMZWZ0ID0gaW5pdGlhbC54ICsgZGVsdGFYO1xuICAgICAgICAgICAgY29uc3QgbmV3V2lkdGggPSBpbml0aWFsLndpZHRoIC0gZGVsdGFYO1xuICAgICAgICAgICAgaWYgKG5ld1dpZHRoICE9PSBvbGQud2lkdGggJiYgbmV3V2lkdGggPj0gb2xkLm1pbldpZHRoICYmIG5ld0xlZnQgIT09IG9sZC5sZWZ0KSB7XG4gICAgICAgICAgICAgICAgZXYud2lkdGggPSBuZXdXaWR0aDtcbiAgICAgICAgICAgICAgICBldi5sZWZ0ID0gbmV3TGVmdDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNQcmVzZW50KGV2LndpZHRoKSB8fCBpc1ByZXNlbnQoZXYuaGVpZ2h0KSkge1xuICAgICAgICAgICAgT0ZGU0VUX1NUWUxFUy5mb3JFYWNoKChzdHlsZSQkMSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChpc1ByZXNlbnQoZXZbc3R5bGUkJDFdKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnNbc3R5bGUkJDFdID0gZXZbc3R5bGUkJDFdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5jaGFuZ2UuZW1pdChldik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmVzdG9yZUFjdGlvbigpIHtcbiAgICAgICAgdGhpcy5sYXN0QWN0aW9uID0gJ3Jlc3RvcmUnO1xuICAgICAgICB0aGlzLmRlZmF1bHRTdGF0ZSgpO1xuICAgIH1cbiAgICBkZWZhdWx0U3RhdGUoKSB7XG4gICAgICAgIGlmIChpc1ByZXNlbnQodGhpcy5yZXN0b3JlT3B0aW9ucykpIHtcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMucmVzdG9yZU9wdGlvbnMpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMub3B0aW9ucy5zdGF0ZSA9ICdkZWZhdWx0JztcbiAgICAgICAgdGhpcy5zdGF0ZUNoYW5nZS5lbWl0KCdkZWZhdWx0Jyk7XG4gICAgfVxuICAgIHN0b3JlT3B0aW9ucygpIHtcbiAgICAgICAgdGhpcy5yZXN0b3JlT3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMub3B0aW9ucyk7XG4gICAgfVxuICAgIG1heGltaXplQWN0aW9uKCkge1xuICAgICAgICB0aGlzLmxhc3RBY3Rpb24gPSAnbWF4aW1pemUnO1xuICAgICAgICB0aGlzLm1heGltaXplU3RhdGUoKTtcbiAgICB9XG4gICAgbWF4aW1pemVTdGF0ZSgpIHtcbiAgICAgICAgdGhpcy5zdG9yZU9wdGlvbnMoKTtcbiAgICAgICAgY29uc3Qgd25kID0gdGhpcy53aW5kb3dWaWV3UG9ydDtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5vcHRpb25zLCB7XG4gICAgICAgICAgICBoZWlnaHQ6IHduZC5oZWlnaHQsXG4gICAgICAgICAgICBsZWZ0OiAwLFxuICAgICAgICAgICAgcG9zaXRpb246ICdmaXhlZCcsXG4gICAgICAgICAgICBzdGF0ZTogJ21heGltaXplZCcsXG4gICAgICAgICAgICB0b3A6IDAsXG4gICAgICAgICAgICB3aWR0aDogd25kLndpZHRoXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnN0YXRlQ2hhbmdlLmVtaXQoJ21heGltaXplZCcpO1xuICAgIH1cbiAgICBtaW5pbWl6ZUFjdGlvbigpIHtcbiAgICAgICAgdGhpcy5sYXN0QWN0aW9uID0gJ21pbmltaXplJztcbiAgICAgICAgdGhpcy5taW5pbWl6ZVN0YXRlKCk7XG4gICAgfVxuICAgIG1pbmltaXplU3RhdGUoKSB7XG4gICAgICAgIHRoaXMuc3RvcmVPcHRpb25zKCk7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMub3B0aW9ucywge1xuICAgICAgICAgICAgaGVpZ2h0OiBudWxsLFxuICAgICAgICAgICAgbWluSGVpZ2h0OiAwLFxuICAgICAgICAgICAgc3RhdGU6ICdtaW5pbWl6ZWQnXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnN0YXRlQ2hhbmdlLmVtaXQoJ21pbmltaXplZCcpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBIYW5kbGVzIG1hbnVhbCBjaGFuZ2VzIG9mIHRoZSAnc3RhdGUnIHByb3BlcnR5LlxuICAgICAqIFJlcXVpcmVkIHRvIGRpc3Rpbmd1aXNoIHRoZW0gZnJvbSBhY3Rpb24gY2xpY2tzLlxuICAgICAqL1xuICAgIGFwcGx5TWFudWFsU3RhdGUoKSB7XG4gICAgICAgIGNvbnN0IHN0YXRlJCQxID0gdGhpcy5vcHRpb25zLnN0YXRlO1xuICAgICAgICBzd2l0Y2ggKHN0YXRlJCQxKSB7XG4gICAgICAgICAgICBjYXNlICdkZWZhdWx0JzpcbiAgICAgICAgICAgICAgICB0aGlzLmNsZWFySGVpZ2h0KCk7XG4gICAgICAgICAgICAgICAgdGhpcy5kZWZhdWx0U3RhdGUoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ21heGltaXplZCc6XG4gICAgICAgICAgICAgICAgdGhpcy5jbGVhckhlaWdodCgpO1xuICAgICAgICAgICAgICAgIHRoaXMubWF4aW1pemVTdGF0ZSgpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnbWluaW1pemVkJzpcbiAgICAgICAgICAgICAgICB0aGlzLm1pbmltaXplU3RhdGUoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY2xvc2VBY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuY2xvc2UuZW1pdCgpO1xuICAgIH1cbiAgICBlbnN1cmVXaWR0aCgpIHtcbiAgICAgICAgY29uc3Qgd2luZG93T2Zmc2V0ID0gb2Zmc2V0KHRoaXMud2luZG93Lm5hdGl2ZUVsZW1lbnQpO1xuICAgICAgICBpZiAoIWlzUHJlc2VudCh0aGlzLm9wdGlvbnMud2lkdGgpKSB7XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMud2lkdGggPSB3aW5kb3dPZmZzZXQud2lkdGg7XG4gICAgICAgICAgICB0aGlzLmNoYW5nZS5lbWl0KHsgd2lkdGg6IHdpbmRvd09mZnNldC53aWR0aCB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjbGVhckhlaWdodCgpIHtcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5oZWlnaHQgPT09IDApIHtcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLm9wdGlvbnMuaGVpZ2h0O1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMubWluSGVpZ2h0ID09PSAwKSB7XG4gICAgICAgICAgICBkZWxldGUgdGhpcy5vcHRpb25zLm1pbkhlaWdodDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjZW50ZXIoKSB7XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuc3RhdGUgPT09ICdtYXhpbWl6ZWQnKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHNjcm9sbCA9IHNjcm9sbFBvc2l0aW9uKHRoaXMud2luZG93Lm5hdGl2ZUVsZW1lbnQpO1xuICAgICAgICBsZXQgd25kID0gdGhpcy53aW5kb3dWaWV3UG9ydDtcbiAgICAgICAgbGV0IHdyYXBwZXIgPSBvZmZzZXQodGhpcy53aW5kb3cubmF0aXZlRWxlbWVudCk7XG4gICAgICAgIGxldCBldiA9IHt9O1xuICAgICAgICBpZiAoIWlzUHJlc2VudCh0aGlzLm9wdGlvbnMubGVmdCkpIHtcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5sZWZ0ID0gc2Nyb2xsLnggKyBNYXRoLm1heCgwLCAod25kLndpZHRoIC0gd3JhcHBlci53aWR0aCkgLyAyKTtcbiAgICAgICAgICAgIGV2LmxlZnQgPSB0aGlzLm9wdGlvbnMubGVmdDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWlzUHJlc2VudCh0aGlzLm9wdGlvbnMudG9wKSkge1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zLnRvcCA9IHNjcm9sbC55ICsgTWF0aC5tYXgoMCwgKHduZC5oZWlnaHQgLSB3cmFwcGVyLmhlaWdodCkgLyAyKTtcbiAgICAgICAgICAgIGV2LnRvcCA9IHRoaXMub3B0aW9ucy50b3A7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jaGFuZ2UuZW1pdChldik7XG4gICAgfVxuICAgIGN1cnJlbnRPZmZzZXRBbmRQb3NpdGlvbigpIHtcbiAgICAgICAgY29uc3QgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgY29uc3Qgb2ZmID0gb2Zmc2V0KHRoaXMud2luZG93Lm5hdGl2ZUVsZW1lbnQpO1xuICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5jdXJyZW50UG9zaXRpb24oKSwge1xuICAgICAgICAgICAgaGVpZ2h0OiBvLmhlaWdodCA/IG8uaGVpZ2h0IDogb2ZmLmhlaWdodCxcbiAgICAgICAgICAgIHdpZHRoOiBvLndpZHRoID8gby53aWR0aCA6IG9mZi53aWR0aFxuICAgICAgICB9KTtcbiAgICB9XG4gICAgY3VycmVudFBvc2l0aW9uKCkge1xuICAgICAgICBjb25zdCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICBpZiAoIW8udG9wIHx8ICFvLmxlZnQpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0UG9zaXRpb24oKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgeDogdGhpcy5vcHRpb25zLmxlZnQsXG4gICAgICAgICAgICB5OiB0aGlzLm9wdGlvbnMudG9wXG4gICAgICAgIH07XG4gICAgfVxuICAgIHNldFBvc2l0aW9uKCkge1xuICAgICAgICBjb25zdCB3cmFwcGVyID0gcG9zaXRpb25XaXRoU2Nyb2xsKHRoaXMud2luZG93Lm5hdGl2ZUVsZW1lbnQsIGdldERvY3VtZW50RWxlbWVudCh0aGlzLndpbmRvdy5uYXRpdmVFbGVtZW50KSk7XG4gICAgICAgIHRoaXMub3B0aW9ucy5sZWZ0ID0gd3JhcHBlci5sZWZ0O1xuICAgICAgICB0aGlzLm9wdGlvbnMudG9wID0gd3JhcHBlci50b3A7XG4gICAgfVxuICAgIHNldFJlc3RvcmVPcHRpb24oc3R5bGUkJDEsIHZhbHVlKSB7XG4gICAgICAgIGlmIChpc1ByZXNlbnQodGhpcy5yZXN0b3JlT3B0aW9ucykpIHtcbiAgICAgICAgICAgIHRoaXMucmVzdG9yZU9wdGlvbnNbc3R5bGUkJDFdID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IG5leHRQb3NzaWJsZVpJbmRleCgpIHtcbiAgICAgICAgcmV0dXJuIG5ld1pJbmRleDtcbiAgICB9XG4gICAgZ2V0IG5leHRaSW5kZXgoKSB7XG4gICAgICAgIHJldHVybiBuZXdaSW5kZXgrKztcbiAgICB9XG4gICAgZ2V0IHdpbmRvd1ZpZXdQb3J0KCkge1xuICAgICAgICByZXR1cm4gZ2V0V2luZG93Vmlld1BvcnQodGhpcy53aW5kb3cubmF0aXZlRWxlbWVudCk7XG4gICAgfVxufTtcbkRyYWdSZXNpemVTZXJ2aWNlID0gX19kZWNvcmF0ZShbXG4gICAgSW5qZWN0YWJsZSgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbTmdab25lXSlcbl0sIERyYWdSZXNpemVTZXJ2aWNlKTtcblxuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmxldCBSZXNpemVIYW5kbGVEaXJlY3RpdmUgPSBjbGFzcyBSZXNpemVIYW5kbGVEaXJlY3RpdmUge1xuICAgIGNvbnN0cnVjdG9yKGRyYWdnYWJsZSwgZWwsIHJlbmRlcmVyLCBzZXJ2aWNlKSB7XG4gICAgICAgIHRoaXMuZHJhZ2dhYmxlID0gZHJhZ2dhYmxlO1xuICAgICAgICB0aGlzLmVsID0gZWw7XG4gICAgICAgIHRoaXMucmVuZGVyZXIgPSByZW5kZXJlcjtcbiAgICAgICAgdGhpcy5zZXJ2aWNlID0gc2VydmljZTtcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zID0gbmV3IFN1YnNjcmlwdGlvbigpO1xuICAgIH1cbiAgICBnZXQgaG9zdENsYXNzKCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIHRoaXMuc2V0RGlzcGxheSgpO1xuICAgICAgICB0aGlzLnJlbmRlcmVyLmFkZENsYXNzKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgJ2stcmVzaXplLScgKyB0aGlzLmRpcmVjdGlvbik7XG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5hZGQob2YodGhpcy5kcmFnZ2FibGUpLnN1YnNjcmliZShoYW5kbGUgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZXJ2aWNlLm9uUmVzaXplKGhhbmRsZSwgdGhpcy5kaXJlY3Rpb24pO1xuICAgICAgICB9KSk7XG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5hZGQodGhpcy5zZXJ2aWNlLnJlc2l6ZVN0YXJ0LnN1YnNjcmliZSgoZGlyKSA9PiB7XG4gICAgICAgICAgICBpZiAoZGlyICE9PSB0aGlzLmRpcmVjdGlvbikge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0RGlzcGxheSgnbm9uZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KSk7XG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5hZGQodGhpcy5zZXJ2aWNlLmRyYWdTdGFydC5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZXREaXNwbGF5KCdub25lJyk7XG4gICAgICAgIH0pKTtcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zLmFkZChtZXJnZSh0aGlzLnNlcnZpY2UucmVzaXplRW5kLCB0aGlzLnNlcnZpY2UuZHJhZ0VuZCkuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2V0RGlzcGxheSgnYmxvY2snKTtcbiAgICAgICAgfSkpO1xuICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnMuYWRkKHRoaXMuc2VydmljZS5zdGF0ZUNoYW5nZS5zdWJzY3JpYmUoKHN0YXRlJCQxKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnNldERpc3BsYXkoc3RhdGUkJDEgPT09ICdkZWZhdWx0JyA/ICdibG9jaycgOiAnbm9uZScpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIG5nT25EZXN0cm95KCkge1xuICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnMudW5zdWJzY3JpYmUoKTtcbiAgICB9XG4gICAgc2V0RGlzcGxheSh2YWx1ZSA9ICdibG9jaycpIHtcbiAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsICdkaXNwbGF5JywgdGhpcy5zZXJ2aWNlLm9wdGlvbnMuc3RhdGUgPT09ICdkZWZhdWx0JyA/IHZhbHVlIDogJ25vbmUnKTtcbiAgICB9XG59O1xuX19kZWNvcmF0ZShbXG4gICAgSW5wdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgU3RyaW5nKVxuXSwgUmVzaXplSGFuZGxlRGlyZWN0aXZlLnByb3RvdHlwZSwgXCJkaXJlY3Rpb25cIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIEhvc3RCaW5kaW5nKCdjbGFzcy5rLXJlc2l6ZS1oYW5kbGUnKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgQm9vbGVhbiksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtdKVxuXSwgUmVzaXplSGFuZGxlRGlyZWN0aXZlLnByb3RvdHlwZSwgXCJob3N0Q2xhc3NcIiwgbnVsbCk7XG5SZXNpemVIYW5kbGVEaXJlY3RpdmUgPSBfX2RlY29yYXRlKFtcbiAgICBEaXJlY3RpdmUoe1xuICAgICAgICBzZWxlY3RvcjogJ1trZW5kb1dpbmRvd1Jlc2l6ZUhhbmRsZV0nXG4gICAgfSksXG4gICAgX19wYXJhbSgwLCBIb3N0KCkpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbRHJhZ2dhYmxlRGlyZWN0aXZlLFxuICAgICAgICBFbGVtZW50UmVmLFxuICAgICAgICBSZW5kZXJlcjIsXG4gICAgICAgIERyYWdSZXNpemVTZXJ2aWNlXSlcbl0sIFJlc2l6ZUhhbmRsZURpcmVjdGl2ZSk7XG5cbmxldCBXaW5kb3dUaXRsZUJhckNvbXBvbmVudCA9IGNsYXNzIFdpbmRvd1RpdGxlQmFyQ29tcG9uZW50IHtcbiAgICBjb25zdHJ1Y3RvcihlbCwgc2VydmljZSwgbmdab25lKSB7XG4gICAgICAgIHRoaXMuZWwgPSBlbDtcbiAgICAgICAgdGhpcy5uZ1pvbmUgPSBuZ1pvbmU7XG4gICAgICAgIHRoaXMuc2VydmljZSA9IHNlcnZpY2U7XG4gICAgfVxuICAgIG5nT25Jbml0KCkge1xuICAgICAgICB0aGlzLmRyYWdEaXJlY3RpdmUgPSBuZXcgRHJhZ2dhYmxlRGlyZWN0aXZlKHRoaXMuZWwsIHRoaXMubmdab25lKTtcbiAgICAgICAgdGhpcy5kcmFnRGlyZWN0aXZlLm5nT25Jbml0KCk7XG4gICAgICAgIGlmICh0aGlzLmlzRHJhZ2dhYmxlKSB7XG4gICAgICAgICAgICB0aGlzLnN1YnNjcmliZURyYWcoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnN1YnNjcmliZVN0YXRlQ2hhbmdlKCk7XG4gICAgfVxuICAgIG5nT25EZXN0cm95KCkge1xuICAgICAgICB0aGlzLmRyYWdEaXJlY3RpdmUubmdPbkRlc3Ryb3koKTtcbiAgICAgICAgdGhpcy51bnN1YnNjcmliZURyYWcoKTtcbiAgICAgICAgdGhpcy51bnN1YnNjcmliZVN0YXRlKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBzdWJzY3JpYmVEcmFnKCkge1xuICAgICAgICB0aGlzLnVuc3Vic2NyaWJlRHJhZygpO1xuICAgICAgICB0aGlzLmRyYWdTdWJzY3JpcHRpb24gPSBvZih0aGlzLmRyYWdEaXJlY3RpdmUpLnN1YnNjcmliZSh0aXRsZUJhciA9PiB7XG4gICAgICAgICAgICB0aGlzLnNlcnZpY2Uub25EcmFnKHRpdGxlQmFyKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBzdWJzY3JpYmVTdGF0ZUNoYW5nZSgpIHtcbiAgICAgICAgdGhpcy5zdGF0ZVN1YnNjcmlwdGlvbiA9IHRoaXMuc2VydmljZS5zdGF0ZUNoYW5nZS5zdWJzY3JpYmUoKHN0YXRlJCQxKSA9PiB7XG4gICAgICAgICAgICBpZiAodGhpcy5zZXJ2aWNlLm9wdGlvbnMuZHJhZ2dhYmxlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHN0YXRlJCQxID09PSAnbWF4aW1pemVkJykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVuc3Vic2NyaWJlRHJhZygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdWJzY3JpYmVEcmFnKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIHVuc3Vic2NyaWJlRHJhZygpIHtcbiAgICAgICAgaWYgKHRoaXMuZHJhZ1N1YnNjcmlwdGlvbikge1xuICAgICAgICAgICAgdGhpcy5zZXJ2aWNlLmRyYWdTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgICAgICAgIHRoaXMuZHJhZ1N1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgICAgICAgdGhpcy5kcmFnU3Vic2NyaXB0aW9uID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgdW5zdWJzY3JpYmVTdGF0ZSgpIHtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGVTdWJzY3JpcHRpb24pIHtcbiAgICAgICAgICAgIHRoaXMuc3RhdGVTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgICAgICAgIHRoaXMuc3RhdGVTdWJzY3JpcHRpb24gPSBudWxsO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCBjbGFzc05hbWUoKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBnZXQgdG91Y2hBY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLmlzRHJhZ2dhYmxlKSB7XG4gICAgICAgICAgICByZXR1cm4gJ25vbmUnO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBoYW5kbGUoZXYpIHtcbiAgICAgICAgY29uc3QgdGFyZ2V0ID0gZXYudGFyZ2V0O1xuICAgICAgICBjb25zdCBzdGF0ZSQkMSA9IHRoaXMuc2VydmljZS5vcHRpb25zLnN0YXRlO1xuICAgICAgICBpZiAoIWhhc0NsYXNzZXModGFyZ2V0LCAnay1pY29uJykgJiYgIWlzRm9jdXNhYmxlKHRhcmdldCwgZmFsc2UpICYmIHRoaXMuc2VydmljZS5vcHRpb25zLnJlc2l6YWJsZSkge1xuICAgICAgICAgICAgaWYgKHN0YXRlJCQxID09PSAnZGVmYXVsdCcpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNlcnZpY2UubWF4aW1pemVBY3Rpb24oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHN0YXRlJCQxID09PSAnbWF4aW1pemVkJykge1xuICAgICAgICAgICAgICAgIHRoaXMuc2VydmljZS5yZXN0b3JlQWN0aW9uKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IGlzRHJhZ2dhYmxlKCkge1xuICAgICAgICBjb25zdCBvcHRpb25zID0gdGhpcy5zZXJ2aWNlLm9wdGlvbnM7XG4gICAgICAgIHJldHVybiBvcHRpb25zLmRyYWdnYWJsZSAmJiBvcHRpb25zLnN0YXRlICE9PSAnbWF4aW1pemVkJztcbiAgICB9XG59O1xuX19kZWNvcmF0ZShbXG4gICAgSW5wdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgVGVtcGxhdGVSZWYpXG5dLCBXaW5kb3dUaXRsZUJhckNvbXBvbmVudC5wcm90b3R5cGUsIFwidGVtcGxhdGVcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIEhvc3RCaW5kaW5nKCdjbGFzcy5rLXdpbmRvdy10aXRsZWJhcicpLFxuICAgIEhvc3RCaW5kaW5nKCdjbGFzcy5rLWRpYWxvZy10aXRsZWJhcicpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBCb29sZWFuKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW10pXG5dLCBXaW5kb3dUaXRsZUJhckNvbXBvbmVudC5wcm90b3R5cGUsIFwiY2xhc3NOYW1lXCIsIG51bGwpO1xuX19kZWNvcmF0ZShbXG4gICAgSG9zdEJpbmRpbmcoJ3N0eWxlLnRvdWNoLWFjdGlvbicpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBTdHJpbmcpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbXSlcbl0sIFdpbmRvd1RpdGxlQmFyQ29tcG9uZW50LnByb3RvdHlwZSwgXCJ0b3VjaEFjdGlvblwiLCBudWxsKTtcbl9fZGVjb3JhdGUoW1xuICAgIEhvc3RMaXN0ZW5lcignZGJsY2xpY2snLCBbJyRldmVudCddKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgRnVuY3Rpb24pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbT2JqZWN0XSksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpyZXR1cm50eXBlXCIsIHZvaWQgMClcbl0sIFdpbmRvd1RpdGxlQmFyQ29tcG9uZW50LnByb3RvdHlwZSwgXCJoYW5kbGVcIiwgbnVsbCk7XG5XaW5kb3dUaXRsZUJhckNvbXBvbmVudCA9IF9fZGVjb3JhdGUoW1xuICAgIENvbXBvbmVudCh7XG4gICAgICAgIHNlbGVjdG9yOiAna2VuZG8td2luZG93LXRpdGxlYmFyJyxcbiAgICAgICAgdGVtcGxhdGU6IGBcbiAgICA8bmctY29udGVudCAqbmdJZj1cIiF0ZW1wbGF0ZVwiPjwvbmctY29udGVudD5cbiAgICA8bmctdGVtcGxhdGVcbiAgICAgIFtuZ1RlbXBsYXRlT3V0bGV0XT1cInRlbXBsYXRlXCJcbiAgICAgIFtuZ1RlbXBsYXRlT3V0bGV0Q29udGV4dF09XCJ7JyRpbXBsaWNpdCc6IHNlcnZpY2V9XCIgKm5nSWY9XCJ0ZW1wbGF0ZVwiPlxuICAgIDwvbmctdGVtcGxhdGU+XG4gIGBcbiAgICB9KSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW0VsZW1lbnRSZWYsIERyYWdSZXNpemVTZXJ2aWNlLCBOZ1pvbmVdKVxuXSwgV2luZG93VGl0bGVCYXJDb21wb25lbnQpO1xuXG4vKipcbiAqIEBoaWRkZW5cbiAqL1xubGV0IE5hdmlnYXRpb25TZXJ2aWNlID0gY2xhc3MgTmF2aWdhdGlvblNlcnZpY2Uge1xuICAgIGNvbnN0cnVjdG9yKHdpbmRvdykge1xuICAgICAgICB0aGlzLndpbmRvdyA9IHdpbmRvdztcbiAgICB9XG4gICAgcHJvY2Vzcyhldikge1xuICAgICAgICBjb25zdCBrZXkgPSBldi5rZXlDb2RlO1xuICAgICAgICBzd2l0Y2ggKGtleSkge1xuICAgICAgICAgICAgY2FzZSBLZXlzLnVwOlxuICAgICAgICAgICAgY2FzZSBLZXlzLmRvd246XG4gICAgICAgICAgICBjYXNlIEtleXMubGVmdDpcbiAgICAgICAgICAgIGNhc2UgS2V5cy5yaWdodDoge1xuICAgICAgICAgICAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVBcnJvdyhrZXksIGV2KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgS2V5cy5lc2M6XG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVFc2NhcGUoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaGFuZGxlQXJyb3coa2V5LCBldikge1xuICAgICAgICBjb25zdCBvcHRpb25zID0gdGhpcy53aW5kb3cub3B0aW9ucztcbiAgICAgICAgaWYgKGV2LmFsdEtleSkge1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVTdGF0ZUNoYW5nZShrZXksIG9wdGlvbnMuc3RhdGUpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICgoZXYuY3RybEtleSB8fCBldi5tZXRhS2V5KSAmJiBvcHRpb25zLnN0YXRlID09PSAnZGVmYXVsdCcpIHtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlUmVzaXplKGtleSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZURyYWcoa2V5KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBoYW5kbGVFc2NhcGUoKSB7XG4gICAgICAgIHRoaXMud2luZG93LmNsb3NlQWN0aW9uKCk7XG4gICAgfVxuICAgIGhhbmRsZURyYWcoa2V5KSB7XG4gICAgICAgIGxldCBvcHRpb25zID0gdGhpcy53aW5kb3cub3B0aW9ucztcbiAgICAgICAgaWYgKCFvcHRpb25zLmRyYWdnYWJsZSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG9mZnNldCQkMSA9IHRoaXMud2luZG93LmN1cnJlbnRPZmZzZXRBbmRQb3NpdGlvbigpO1xuICAgICAgICBsZXQgcmVzdG9yZU9wdGlvbnMgPSB0aGlzLndpbmRvdy5yZXN0b3JlT3B0aW9ucztcbiAgICAgICAgbGV0IGV2ID0ge307XG4gICAgICAgIGxldCBkZWx0YSA9IDEwO1xuICAgICAgICBpZiAoa2V5ID09PSBLZXlzLmxlZnQgfHwga2V5ID09PSBLZXlzLnVwKSB7XG4gICAgICAgICAgICBkZWx0YSAqPSAtMTtcbiAgICAgICAgfVxuICAgICAgICBzd2l0Y2ggKGtleSkge1xuICAgICAgICAgICAgY2FzZSBLZXlzLmxlZnQ6XG4gICAgICAgICAgICBjYXNlIEtleXMucmlnaHQ6IHtcbiAgICAgICAgICAgICAgICBldi5sZWZ0ID0gb2Zmc2V0JCQxLnggKyBkZWx0YTtcbiAgICAgICAgICAgICAgICBvcHRpb25zLmxlZnQgPSBldi5sZWZ0O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FzZSBLZXlzLnVwOlxuICAgICAgICAgICAgY2FzZSBLZXlzLmRvd246IHtcbiAgICAgICAgICAgICAgICBldi50b3AgPSBvZmZzZXQkJDEueSArIGRlbHRhO1xuICAgICAgICAgICAgICAgIG9wdGlvbnMudG9wID0gZXYudG9wO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBpZiAob3B0aW9ucy5zdGF0ZSA9PT0gJ21pbmltaXplZCcgJiYgaXNQcmVzZW50KHJlc3RvcmVPcHRpb25zKSkge1xuICAgICAgICAgICAgcmVzdG9yZU9wdGlvbnMubGVmdCA9IG9wdGlvbnMubGVmdDtcbiAgICAgICAgICAgIHJlc3RvcmVPcHRpb25zLnRvcCA9IG9wdGlvbnMudG9wO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMud2luZG93LmNoYW5nZS5lbWl0KGV2KTtcbiAgICB9XG4gICAgaGFuZGxlUmVzaXplKGtleSkge1xuICAgICAgICBjb25zdCBvcHRpb25zID0gdGhpcy53aW5kb3cub3B0aW9ucztcbiAgICAgICAgaWYgKCFvcHRpb25zLnJlc2l6YWJsZSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG9mZnNldCQkMSA9IHRoaXMud2luZG93LmN1cnJlbnRPZmZzZXRBbmRQb3NpdGlvbigpO1xuICAgICAgICBsZXQgbmV3V2lkdGg7XG4gICAgICAgIGxldCBuZXdIZWlnaHQ7XG4gICAgICAgIGxldCBldiA9IHt9O1xuICAgICAgICBsZXQgZGVsdGEgPSAxMDtcbiAgICAgICAgaWYgKGtleSA9PT0gS2V5cy5sZWZ0IHx8IGtleSA9PT0gS2V5cy51cCkge1xuICAgICAgICAgICAgZGVsdGEgKj0gLTE7XG4gICAgICAgIH1cbiAgICAgICAgc3dpdGNoIChrZXkpIHtcbiAgICAgICAgICAgIGNhc2UgS2V5cy5sZWZ0OlxuICAgICAgICAgICAgY2FzZSBLZXlzLnJpZ2h0OiB7XG4gICAgICAgICAgICAgICAgbmV3V2lkdGggPSBvZmZzZXQkJDEud2lkdGggKyBkZWx0YTtcbiAgICAgICAgICAgICAgICBpZiAobmV3V2lkdGggIT09IG9wdGlvbnMud2lkdGggJiYgbmV3V2lkdGggPj0gb3B0aW9ucy5taW5XaWR0aCkge1xuICAgICAgICAgICAgICAgICAgICBldi53aWR0aCA9IG5ld1dpZHRoO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgS2V5cy51cDpcbiAgICAgICAgICAgIGNhc2UgS2V5cy5kb3duOiB7XG4gICAgICAgICAgICAgICAgbmV3SGVpZ2h0ID0gb2Zmc2V0JCQxLmhlaWdodCArIGRlbHRhO1xuICAgICAgICAgICAgICAgIGlmIChuZXdIZWlnaHQgIT09IG9wdGlvbnMuaGVpZ2h0ICYmIG5ld0hlaWdodCA+PSBvcHRpb25zLm1pbkhlaWdodCkge1xuICAgICAgICAgICAgICAgICAgICBldi5oZWlnaHQgPSBuZXdIZWlnaHQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNQcmVzZW50KGV2LndpZHRoKSB8fCBpc1ByZXNlbnQoZXYuaGVpZ2h0KSkge1xuICAgICAgICAgICAgT0ZGU0VUX1NUWUxFUy5mb3JFYWNoKChzdHlsZSQkMSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChpc1ByZXNlbnQoZXZbc3R5bGUkJDFdKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLndpbmRvdy5vcHRpb25zW3N0eWxlJCQxXSA9IGV2W3N0eWxlJCQxXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMud2luZG93LmNoYW5nZS5lbWl0KGV2KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBoYW5kbGVTdGF0ZUNoYW5nZShrZXksIHN0YXRlJCQxKSB7XG4gICAgICAgIGlmICgoc3RhdGUkJDEgPT09ICdtaW5pbWl6ZWQnICYmIGtleSA9PT0gS2V5cy51cCkgfHxcbiAgICAgICAgICAgIChzdGF0ZSQkMSA9PT0gJ21heGltaXplZCcgJiYga2V5ID09PSBLZXlzLmRvd24pKSB7XG4gICAgICAgICAgICB0aGlzLndpbmRvdy5yZXN0b3JlQWN0aW9uKCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHN0YXRlJCQxID09PSAnZGVmYXVsdCcpIHtcbiAgICAgICAgICAgIGlmIChrZXkgPT09IEtleXMudXApIHtcbiAgICAgICAgICAgICAgICB0aGlzLndpbmRvdy5tYXhpbWl6ZUFjdGlvbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoa2V5ID09PSBLZXlzLmRvd24pIHtcbiAgICAgICAgICAgICAgICB0aGlzLndpbmRvdy5taW5pbWl6ZUFjdGlvbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufTtcbk5hdmlnYXRpb25TZXJ2aWNlID0gX19kZWNvcmF0ZShbXG4gICAgSW5qZWN0YWJsZSgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbRHJhZ1Jlc2l6ZVNlcnZpY2VdKVxuXSwgTmF2aWdhdGlvblNlcnZpY2UpO1xuXG4vKipcbiAqIFJlcHJlc2VudHMgdGhlIFtLZW5kbyBVSSBXaW5kb3cgY29tcG9uZW50IGZvciBBbmd1bGFyXSh7JSBzbHVnIG92ZXJ2aWV3X3dpbmRvd19kaWFsb2dzICV9KS5cbiAqL1xubGV0IFdpbmRvd0NvbXBvbmVudCA9IGNsYXNzIFdpbmRvd0NvbXBvbmVudCB7XG4gICAgY29uc3RydWN0b3IoZWwsIHJlbmRlcmVyLCBzZXJ2aWNlLCBuYXZpZ2F0aW9uLCBuZ1pvbmUsIGxvY2FsaXphdGlvbikge1xuICAgICAgICB0aGlzLmVsID0gZWw7XG4gICAgICAgIHRoaXMucmVuZGVyZXIgPSByZW5kZXJlcjtcbiAgICAgICAgdGhpcy5zZXJ2aWNlID0gc2VydmljZTtcbiAgICAgICAgdGhpcy5uYXZpZ2F0aW9uID0gbmF2aWdhdGlvbjtcbiAgICAgICAgdGhpcy5uZ1pvbmUgPSBuZ1pvbmU7XG4gICAgICAgIHRoaXMubG9jYWxpemF0aW9uID0gbG9jYWxpemF0aW9uO1xuICAgICAgICAvKipcbiAgICAgICAgICogU3BlY2lmaWVzIGlmIHRoZSBjb250ZW50IG9mIHRoZSBjb21wb25lbnQgaXMgcGVyc2lzdGVkIGluIHRoZSBET00gd2hlbiBtaW5pbWl6ZWQuXG4gICAgICAgICAqIEBkZWZhdWx0IGZhbHNlXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmtlZXBDb250ZW50ID0gZmFsc2U7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBGaXJlcyB3aGVuIHRoZSB1c2VyIHN0YXJ0cyB0byBtb3ZlIHRoZSBXaW5kb3cuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmRyYWdTdGFydCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEZpcmVzIHdoZW4gdGhlIFdpbmRvdyB3YXMgbW92ZWQgYnkgdGhlIHVzZXIuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmRyYWdFbmQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBGaXJlcyB3aGVuIHRoZSB1c2VyIHN0YXJ0cyB0byByZXNpemUgdGhlIFdpbmRvdy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucmVzaXplU3RhcnQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBGaXJlcyB3aGVuIHRoZSBXaW5kb3cgd2FzIHJlc2l6ZWQgYnkgdGhlIHVzZXIuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnJlc2l6ZUVuZCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEZpcmVzIHdoZW4gdGhlIHVzZXIgY2xvc2VzIHRoZSBXaW5kb3cuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmNsb3NlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICAvKipcbiAgICAgICAgICogRmlyZXMgd2hlbiB0aGUgYHdpZHRoYCBwcm9wZXJ0eSBvZiB0aGUgY29tcG9uZW50IHdhcyB1cGRhdGVkLiBUaGUgZXZlbnQgaXMgdHJpZ2dlcmVkIG9ubHkgYWZ0ZXIgdGhlIHJlc2l6aW5nXG4gICAgICAgICAqIGhhcyBlbmRlZC4gVGhlIGV2ZW50IGRhdGEgY29udGFpbnMgdGhlIG5ldyB3aWR0aC4gQWxsb3dzIGEgdHdvLXdheSBiaW5kaW5nIG9mIHRoZSBgd2lkdGhgIHByb3BlcnR5LlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy53aWR0aENoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEZpcmVzIHdoZW4gdGhlIGBoZWlnaHRgIHByb3BlcnR5IG9mIHRoZSBjb21wb25lbnQgd2FzIHVwZGF0ZWQuIFRoZSBldmVudCBpcyB0cmlnZ2VyZWQgb25seSBhZnRlciB0aGUgcmVzaXppbmdcbiAgICAgICAgICogaGFzIGVuZGVkLiBUaGUgZXZlbnQgZGF0YSBjb250YWlucyB0aGUgbmV3IGhlaWdodC4gQWxsb3dzIGEgdHdvLXdheSBiaW5kaW5nIG9mIHRoZSBgaGVpZ2h0YCBwcm9wZXJ0eS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaGVpZ2h0Q2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICAvKipcbiAgICAgICAgICogRmlyZXMgd2hlbiB0aGUgYHRvcGAgcHJvcGVydHkgb2YgdGhlIGNvbXBvbmVudCB3YXMgdXBkYXRlZC4gVGhlIGV2ZW50IGlzIHRyaWdnZXJlZCBvbmx5IGFmdGVyIHRoZSBkcmFnZ2luZ1xuICAgICAgICAgKiBhbmQgcmVzaXppbmcgaGF2ZSBlbmRlZC4gVGhlIGV2ZW50IGRhdGEgY29udGFpbnMgdGhlIG5ldyB0b3Agb2Zmc2V0LiBBbGxvd3MgYSB0d28td2F5IGJpbmRpbmcgb2YgdGhlIGB0b3BgIHByb3BlcnR5LlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy50b3BDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBGaXJlcyB3aGVuIHRoZSBgbGVmdGAgcHJvcGVydHkgb2YgdGhlIGNvbXBvbmVudCB3YXMgdXBkYXRlZC4gVGhlIGV2ZW50IGlzIHRyaWdnZXJlZCBvbmx5IGFmdGVyIHRoZSBkcmFnZ2luZ1xuICAgICAgICAgKiBhbmQgcmVzaXppbmcgaGF2ZSBlbmRlZC4gVGhlIGV2ZW50IGRhdGEgY29udGFpbnMgdGhlIG5ldyBsZWZ0IG9mZnNldC4gQWxsb3dzIGEgdHdvLXdheSBiaW5kaW5nIG9mIHRoZSBgbGVmdGAgcHJvcGVydHkuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmxlZnRDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBGaXJlcyB3aGVuIHRoZSBgc3RhdGVgIHByb3BlcnR5IG9mIHRoZSBjb21wb25lbnQgd2FzIHVwZGF0ZWQuIFRoZSBldmVudCBkYXRhIGNvbnRhaW5zIHRoZSBuZXcgc3RhdGUuIEFsbG93cyBhXG4gICAgICAgICAqIHR3by13YXkgYmluZGluZyBvZiB0aGUgYHN0YXRlYCBwcm9wZXJ0eS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc3RhdGVDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIHRoaXMudGFiSW5kZXggPSAwO1xuICAgICAgICB0aGlzLmRyYWdlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLnJlc2l6ZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy53aW5kb3dTdWJzY3JpcHRpb24gPSBuZXcgU3Vic2NyaXB0aW9uKCk7XG4gICAgICAgIHZhbGlkYXRlUGFja2FnZShwYWNrYWdlTWV0YWRhdGEpO1xuICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IHRoaXMubG9jYWxpemF0aW9uLnJ0bCA/ICdydGwnIDogJ2x0cic7XG4gICAgICAgIHRoaXMubG9jYWxpemF0aW9uQ2hhbmdlU3Vic2NyaXB0aW9uID0gdGhpcy5sb2NhbGl6YXRpb24uY2hhbmdlc1xuICAgICAgICAgICAgLnN1YnNjcmliZSgoeyBydGwgfSkgPT4gdGhpcy5kaXJlY3Rpb24gPSBydGwgPyAncnRsJyA6ICdsdHInKTtcbiAgICAgICAgdGhpcy5yZXNpemVEaXJlY3Rpb25zID0gUkVTSVpFX0RJUkVDVElPTlM7XG4gICAgICAgIHRoaXMuc3Vic2NyaWJlRXZlbnRzKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNwZWNpZmllcyB3aGV0aGVyIHRoZSB1c2VyIHdpbGwgYmUgYWJsZSB0byBkcmFnIHRoZSBjb21wb25lbnQuXG4gICAgICogQGRlZmF1bHQgdHJ1ZVxuICAgICAqL1xuICAgIHNldCBkcmFnZ2FibGUodmFsdWUpIHtcbiAgICAgICAgdGhpcy5vcHRpb25zLmRyYWdnYWJsZSA9IHZhbHVlO1xuICAgIH1cbiAgICBnZXQgZHJhZ2dhYmxlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLmRyYWdnYWJsZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU3BlY2lmaWVzIHdoZXRoZXIgdGhlIHVzZXIgd2lsbCBiZSBhYmxlIHRvIHJlc2l6ZSB0aGUgY29tcG9uZW50LlxuICAgICAqIEBkZWZhdWx0IHRydWVcbiAgICAgKi9cbiAgICBzZXQgcmVzaXphYmxlKHZhbHVlKSB7XG4gICAgICAgIHRoaXMub3B0aW9ucy5yZXNpemFibGUgPSB2YWx1ZTtcbiAgICB9XG4gICAgZ2V0IHJlc2l6YWJsZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5yZXNpemFibGU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNwZWNpZmllcyB0aGUgaW5pdGlhbCBzdGF0ZSBvZiB0aGUgY29tcG9uZW50LlxuICAgICAqIElmIG5vdCBzcGVjaWZpZWQsIHRoZSB2YWx1ZSBpcyBzZXQgdG8gYGRlZmF1bHRgLlxuICAgICAqXG4gICAgICogVGhlIHBvc3NpYmxlIHZhbHVlcyBhcmU6XG4gICAgICogKiBgbWluaW1pemVkYFxuICAgICAqICogYG1heGltaXplZGBcbiAgICAgKiAqIGBkZWZhdWx0YFxuICAgICAqL1xuICAgIHNldCBzdGF0ZSh2YWx1ZSkge1xuICAgICAgICB0aGlzLm9wdGlvbnMuc3RhdGUgPSB2YWx1ZTtcbiAgICB9XG4gICAgZ2V0IHN0YXRlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLnN0YXRlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTcGVjaWZpZXMgdGhlIG1pbmltdW0gd2lkdGggb2YgdGhlIGNvbXBvbmVudC5cbiAgICAgKiBUaGUgYG1pbldpZHRoYCBwcm9wZXJ0eSBoYXMgdG8gYmUgc2V0IGluIHBpeGVscy5cbiAgICAgKiBAZGVmYXVsdCAxMjBcbiAgICAgKi9cbiAgICBzZXQgbWluV2lkdGgodmFsdWUpIHtcbiAgICAgICAgdGhpcy5zZXRPcHRpb24oJ21pbldpZHRoJywgdmFsdWUpO1xuICAgIH1cbiAgICBnZXQgbWluV2lkdGgoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnMubWluV2lkdGg7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNwZWNpZmllcyB0aGUgbWluaW11bSBoZWlnaHQgb2YgdGhlIFdpbmRvdy5cbiAgICAgKiBUaGUgYG1pbkhlaWdodGAgcHJvcGVydHkgaGFzIHRvIGJlIHNldCBpbiBwaXhlbHMuXG4gICAgICogQGRlZmF1bHQgMTAwXG4gICAgICovXG4gICAgc2V0IG1pbkhlaWdodCh2YWx1ZSkge1xuICAgICAgICB0aGlzLnNldE9wdGlvbignbWluSGVpZ2h0JywgdmFsdWUpO1xuICAgIH1cbiAgICBnZXQgbWluSGVpZ2h0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLm1pbkhlaWdodDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU3BlY2lmaWVzIHRoZSB3aWR0aCBvZiB0aGUgV2luZG93LlxuICAgICAqIFRoZSBgd2lkdGhgIHByb3BlcnR5IGhhcyB0byBiZSBzZXQgaW4gcGl4ZWxzLlxuICAgICAqL1xuICAgIHNldCB3aWR0aCh2YWx1ZSkge1xuICAgICAgICB0aGlzLnNldE9wdGlvbignd2lkdGgnLCB2YWx1ZSk7XG4gICAgfVxuICAgIGdldCB3aWR0aCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy53aWR0aDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU3BlY2lmaWVzIHRoZSBoZWlnaHQgb2YgdGhlIFdpbmRvdy5cbiAgICAgKiBUaGUgYGhlaWdodGAgcHJvcGVydHkgaGFzIHRvIGJlIHNldCBpbiBwaXhlbHMuXG4gICAgICovXG4gICAgc2V0IGhlaWdodCh2YWx1ZSkge1xuICAgICAgICB0aGlzLnNldE9wdGlvbignaGVpZ2h0JywgdmFsdWUpO1xuICAgIH1cbiAgICBnZXQgaGVpZ2h0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLmhlaWdodDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU3BlY2lmaWVzIHRoZSBpbml0aWFsIHRvcCBvZmZzZXQgb2YgdGhlIFdpbmRvdy5cbiAgICAgKiBUaGUgYHRvcGAgcHJvcGVydHkgaGFzIHRvIGJlIHNldCBpbiBwaXhlbHMuXG4gICAgICovXG4gICAgc2V0IHRvcCh2YWx1ZSkge1xuICAgICAgICB0aGlzLnNldE9wdGlvbigndG9wJywgdmFsdWUpO1xuICAgIH1cbiAgICBnZXQgdG9wKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLnRvcDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU3BlY2lmaWVzIHRoZSBpbml0aWFsIGxlZnQgb2Zmc2V0IG9mIHRoZSBXaW5kb3cuXG4gICAgICogTnVtZXJpYyB2YWx1ZXMgYXJlIHRyZWF0ZWQgYXMgcGl4ZWxzLlxuICAgICAqL1xuICAgIHNldCBsZWZ0KHZhbHVlKSB7XG4gICAgICAgIHRoaXMuc2V0T3B0aW9uKCdsZWZ0JywgdmFsdWUpO1xuICAgIH1cbiAgICBnZXQgbGVmdCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5sZWZ0O1xuICAgIH1cbiAgICBnZXQgY2xvc2VCdXR0b25UaXRsZSgpIHtcbiAgICAgICAgaWYgKHRoaXMubWVzc2FnZXMgJiYgdGhpcy5tZXNzYWdlcy5jbG9zZVRpdGxlKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5tZXNzYWdlcy5jbG9zZVRpdGxlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLmxvY2FsaXphdGlvbi5nZXQoJ2Nsb3NlVGl0bGUnKTtcbiAgICB9XG4gICAgZ2V0IHJlc3RvcmVCdXR0b25UaXRsZSgpIHtcbiAgICAgICAgaWYgKHRoaXMubWVzc2FnZXMgJiYgdGhpcy5tZXNzYWdlcy5yZXN0b3JlVGl0bGUpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLm1lc3NhZ2VzLnJlc3RvcmVUaXRsZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5sb2NhbGl6YXRpb24uZ2V0KCdyZXN0b3JlVGl0bGUnKTtcbiAgICB9XG4gICAgZ2V0IG1heGltaXplQnV0dG9uVGl0bGUoKSB7XG4gICAgICAgIGlmICh0aGlzLm1lc3NhZ2VzICYmIHRoaXMubWVzc2FnZXMubWF4aW1pemVUaXRsZSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMubWVzc2FnZXMubWF4aW1pemVUaXRsZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5sb2NhbGl6YXRpb24uZ2V0KCdtYXhpbWl6ZVRpdGxlJyk7XG4gICAgfVxuICAgIGdldCBtaW5pbWl6ZUJ1dHRvblRpdGxlKCkge1xuICAgICAgICBpZiAodGhpcy5tZXNzYWdlcyAmJiB0aGlzLm1lc3NhZ2VzLm1pbmltaXplVGl0bGUpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLm1lc3NhZ2VzLm1pbmltaXplVGl0bGU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMubG9jYWxpemF0aW9uLmdldCgnbWluaW1pemVUaXRsZScpO1xuICAgIH1cbiAgICBnZXQgaG9zdENsYXNzZXMoKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBnZXQgZGlyKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kaXJlY3Rpb247XG4gICAgfVxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICAgICAgdGhpcy5zZXROZXh0WkluZGV4KCk7XG4gICAgICAgIHRoaXMuaGFuZGxlSW5pdGlhbEZvY3VzKCk7XG4gICAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IFByb21pc2UucmVzb2x2ZShudWxsKS50aGVuKCgpID0+IHRoaXMuc2V0SW5pdGlhbE9mZnNldCgpKSk7XG4gICAgfVxuICAgIG5nT25Jbml0KCkge1xuICAgICAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZUF0dHJpYnV0ZSh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsICd0aXRsZScpO1xuICAgICAgICB0aGlzLnNlcnZpY2UuaW5pdCh0aGlzLmVsKTtcbiAgICB9XG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlcykge1xuICAgICAgICBPRkZTRVRfU1RZTEVTLmZvckVhY2goKHN0eWxlJCQxKSA9PiB7XG4gICAgICAgICAgICBpZiAoaXNDaGFuZ2VkKHN0eWxlJCQxLCBjaGFuZ2VzKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0U3R5bGUoc3R5bGUkJDEsIHRoaXMub3B0aW9uc1tzdHlsZSQkMV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKGlzQ2hhbmdlZCgnZHJhZ2dhYmxlJywgY2hhbmdlcykpIHtcbiAgICAgICAgICAgIGNvbnN0IHRpdGxlQmFyID0gaXNQcmVzZW50KHRoaXMudGl0bGVCYXJDb250ZW50KSA/IHRoaXMudGl0bGVCYXJDb250ZW50IDogdGhpcy50aXRsZUJhclZpZXc7XG4gICAgICAgICAgICBpZiAoaXNUcnV0aHkoY2hhbmdlcy5kcmFnZ2FibGUuY3VycmVudFZhbHVlKSkge1xuICAgICAgICAgICAgICAgIHRpdGxlQmFyLnN1YnNjcmliZURyYWcoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRpdGxlQmFyLnVuc3Vic2NyaWJlRHJhZygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChpc0NoYW5nZWQoJ3N0YXRlJywgY2hhbmdlcykpIHtcbiAgICAgICAgICAgIGlmIChpc1ByZXNlbnQodGhpcy5zZXJ2aWNlLmxhc3RBY3Rpb24pKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXJ2aWNlLmxhc3RBY3Rpb24gPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXJ2aWNlLmFwcGx5TWFudWFsU3RhdGUoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUFsbE9mZnNldCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIG5nT25EZXN0cm95KCkge1xuICAgICAgICBpZiAodGhpcy53aW5kb3dTdWJzY3JpcHRpb24pIHtcbiAgICAgICAgICAgIHRoaXMud2luZG93U3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5sb2NhbGl6YXRpb25DaGFuZ2VTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRm9jdXNlcyB0aGUgd3JhcHBlciBvZiB0aGUgV2luZG93IGNvbXBvbmVudC5cbiAgICAgKi9cbiAgICBmb2N1cygpIHtcbiAgICAgICAgY29uc3Qgd3JhcHBlciA9IHRoaXMuZWwubmF0aXZlRWxlbWVudDtcbiAgICAgICAgaWYgKGlzUHJlc2VudCh3cmFwcGVyKSkge1xuICAgICAgICAgICAgd3JhcHBlci5mb2N1cygpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEJyaW5ncyB0aGUgY3VycmVudCBXaW5kb3cgY29tcG9uZW50IG9uIHRvcCBvZiBvdGhlciBXaW5kb3cgY29tcG9uZW50cyBvbiB0aGUgcGFnZS5cbiAgICAgKi9cbiAgICBicmluZ1RvRnJvbnQoKSB7XG4gICAgICAgIHRoaXMuc2V0TmV4dFpJbmRleCgpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBNYW51YWxseSB1cGRhdGVzIHRoZSBgd2lkdGhgIG9yIGBoZWlnaHRgIG9wdGlvbiBvZiB0aGUgV2luZG93LlxuICAgICAqIFRoZSByZXF1aXJlZCBzdHlsZSB3aWxsIGJlIGFwcGxpZWQgdG8gdGhlIFdpbmRvdyB3cmFwcGVyIGVsZW1lbnQgYW5kIHRoZVxuICAgICAqIGNvcnJlc3BvbmRpbmcgcHJvcGVydHkgb2YgdGhlIGNvbXBvbmVudCBpbnN0YW5jZSB3aWxsIGJlIHVwZGF0ZWQuXG4gICAgICogVGhpcyBtZXRob2QgaXMgaW50ZW5kZWQgdG8gYmUgdXNlZCBmb3Igc2l6aW5nIGR5bmFtaWNhbGx5IGNyZWF0ZWQgY29tcG9uZW50cyB1c2luZyB0aGVcbiAgICAgKiBbYFdpbmRvd1NlcnZpY2VgXSh7JSBzbHVnIGFwaV9kaWFsb2dfd2luZG93c2VydmljZSAlfSlcbiAgICAgKiBAcGFyYW0ge1dpbmRvd0RpbWVuc2lvblNldHRpbmd9IGRpbWVuc2lvbiAtIFRoZSBvcHRpb24gdGhhdCB3aWxsIGJlIHVwZGF0ZWRcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gdmFsdWUgLSBUaGUgdmFsdWUgc2V0IGluIHBpeGVsc1xuICAgICAqL1xuICAgIHNldERpbWVuc2lvbihkaW1lbnNpb24sIHZhbHVlKSB7XG4gICAgICAgIHRoaXMuc2V0T3B0aW9uKGRpbWVuc2lvbiwgdmFsdWUpO1xuICAgICAgICB0aGlzLnNldFN0eWxlKGRpbWVuc2lvbiwgdmFsdWUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBNYW51YWxseSB1cGRhdGVzIHRoZSBgdG9wYCBvciBgbGVmdGAgb2Zmc2V0IG9mIHRoZSBXaW5kb3cuXG4gICAgICogVGhlIHJlcXVpcmVkIHN0eWxlIHdpbGwgYmUgYXBwbGllZCB0byB0aGUgV2luZG93IHdyYXBwZXIgZWxlbWVudCBhbmQgdGhlXG4gICAgICogY29ycmVzcG9uZGluZyBwcm9wZXJ0eSBvZiB0aGUgY29tcG9uZW50IGluc3RhbmNlIHdpbGwgYmUgdXBkYXRlZC5cbiAgICAgKiBUaGlzIG1ldGhvZCBpcyBpbnRlbmRlZCB0byBiZSB1c2VkIGZvciBwb3NpdGlvbmluZyBkeW5hbWljYWxseSBjcmVhdGVkIGNvbXBvbmVudHMgdXNpbmcgdGhlXG4gICAgICogW2BXaW5kb3dTZXJ2aWNlYF0oeyUgc2x1ZyBhcGlfZGlhbG9nX3dpbmRvd3NlcnZpY2UgJX0pXG4gICAgICogQHBhcmFtIHtXaW5kb3dPZmZzZXRTZXR0aW5nfSBvZmZzZXQgLSBUaGUgb3B0aW9uIHRoYXQgd2lsbCBiZSB1cGRhdGVkXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlIC0gVGhlIHZhbHVlIHNldCBpbiBwaXhlbHNcbiAgICAgKi9cbiAgICBzZXRPZmZzZXQob2Zmc2V0JCQxLCB2YWx1ZSkge1xuICAgICAgICB0aGlzLnNldE9wdGlvbihvZmZzZXQkJDEsIHZhbHVlKTtcbiAgICAgICAgdGhpcy5zZXRTdHlsZShvZmZzZXQkJDEsIHZhbHVlKTtcbiAgICB9XG4gICAgZ2V0IHNob3dEZWZhdWx0VGl0bGVCYXIoKSB7XG4gICAgICAgIHJldHVybiAhaXNQcmVzZW50KHRoaXMudGl0bGVCYXJDb250ZW50KTtcbiAgICB9XG4gICAgZ2V0IHN0eWxlTWluV2lkdGgoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm1pbldpZHRoICsgJ3B4JztcbiAgICB9XG4gICAgZ2V0IHN0eWxlTWluSGVpZ2h0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5taW5IZWlnaHQgKyAncHgnO1xuICAgIH1cbiAgICBnZXQgc3R5bGVQb3NpdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5wb3NpdGlvbjtcbiAgICB9XG4gICAgZ2V0IHdyYXBwZXJNYXhpbWl6ZWRDbGFzcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGUgPT09ICdtYXhpbWl6ZWQnO1xuICAgIH1cbiAgICBnZXQgd3JhcHBlck1pbmltaXplZENsYXNzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZSA9PT0gJ21pbmltaXplZCc7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBvbkNvbXBvbmVudEtleWRvd24oZXZlbnQpIHtcbiAgICAgICAgaWYgKGhhc0NsYXNzZXMoZXZlbnQudGFyZ2V0LCBXSU5ET1dfQ0xBU1NFUykpIHtcbiAgICAgICAgICAgIHRoaXMubmF2aWdhdGlvbi5wcm9jZXNzKGV2ZW50KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgb25Db21wb25lbnRGb2N1cygpIHtcbiAgICAgICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsICdrLXN0YXRlLWZvY3VzZWQnKTtcbiAgICAgICAgdGhpcy5zZXROZXh0WkluZGV4KCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBvbkNvbXBvbmVudEJsdXIoKSB7XG4gICAgICAgIHRoaXMucmVuZGVyZXIucmVtb3ZlQ2xhc3ModGhpcy5lbC5uYXRpdmVFbGVtZW50LCAnay1zdGF0ZS1mb2N1c2VkJyk7XG4gICAgfVxuICAgIHN1YnNjcmliZUV2ZW50cygpIHtcbiAgICAgICAgaWYgKCFpc0RvY3VtZW50QXZhaWxhYmxlKCkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLndpbmRvd1N1YnNjcmlwdGlvbi5hZGQodGhpcy5zZXJ2aWNlLmZvY3VzLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcbiAgICAgICAgfSkpO1xuICAgICAgICB0aGlzLndpbmRvd1N1YnNjcmlwdGlvbi5hZGQodGhpcy5zZXJ2aWNlLmRyYWdTdGFydC5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5kcmFnZWQgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5uZ1pvbmUucnVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmRyYWdTdGFydC5lbWl0KCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSkpO1xuICAgICAgICB0aGlzLndpbmRvd1N1YnNjcmlwdGlvbi5hZGQodGhpcy5zZXJ2aWNlLmRyYWdFbmQuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgICAgIGlmICh0aGlzLmRyYWdlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZHJhZ2VkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5uZ1pvbmUucnVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kcmFnRW5kLmVtaXQoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkpO1xuICAgICAgICB0aGlzLndpbmRvd1N1YnNjcmlwdGlvbi5hZGQodGhpcy5zZXJ2aWNlLmNsb3NlLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmNsb3NlLmVtaXQoKTtcbiAgICAgICAgfSkpO1xuICAgICAgICB0aGlzLndpbmRvd1N1YnNjcmlwdGlvbi5hZGQodGhpcy5zZXJ2aWNlLnJlc2l6ZVN0YXJ0LnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnJlc2l6ZWQgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5uZ1pvbmUucnVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlc2l6ZVN0YXJ0LmVtaXQoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KSk7XG4gICAgICAgIHRoaXMud2luZG93U3Vic2NyaXB0aW9uLmFkZCh0aGlzLnNlcnZpY2UucmVzaXplRW5kLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgICAgICBpZiAodGhpcy5yZXNpemVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZXNpemVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5uZ1pvbmUucnVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXNpemVFbmQuZW1pdCgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KSk7XG4gICAgICAgIHRoaXMud2luZG93U3Vic2NyaXB0aW9uLmFkZCh0aGlzLnNlcnZpY2UuY2hhbmdlLnN1YnNjcmliZSgoZXYpID0+IHtcbiAgICAgICAgICAgIE9GRlNFVF9TVFlMRVMuZm9yRWFjaCgoc3R5bGUkJDEpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoaXNQcmVzZW50KGV2W3N0eWxlJCQxXSkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdHlsZShzdHlsZSQkMSwgZXZbc3R5bGUkJDFdKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGUgIT09ICdtYXhpbWl6ZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBlbWl0dGVyID0gdGhpc1tzdHlsZSQkMSArICdDaGFuZ2UnXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlbWl0dGVyLm9ic2VydmVycy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm5nWm9uZS5ydW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWl0dGVyLmVtaXQoZXZbc3R5bGUkJDFdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KSk7XG4gICAgICAgIHRoaXMud2luZG93U3Vic2NyaXB0aW9uLmFkZCh0aGlzLnNlcnZpY2Uuc3RhdGVDaGFuZ2Uuc3Vic2NyaWJlKChzdGF0ZSQkMSkgPT4ge1xuICAgICAgICAgICAgaWYgKGlzUHJlc2VudCh0aGlzLnNlcnZpY2UubGFzdEFjdGlvbikpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUFsbE9mZnNldCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuc3RhdGVDaGFuZ2UuZW1pdChzdGF0ZSQkMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgc2V0TmV4dFpJbmRleCgpIHtcbiAgICAgICAgY29uc3QgY3VycmVudFpJbmRleCA9IHRoaXMuZWwubmF0aXZlRWxlbWVudC5zdHlsZVsnei1pbmRleCddO1xuICAgICAgICBjb25zdCBuZXh0UG9zc2libGVaSW5kZXggPSB0aGlzLnNlcnZpY2UubmV4dFBvc3NpYmxlWkluZGV4O1xuICAgICAgICBpZiAoIWN1cnJlbnRaSW5kZXggfHwgKG5leHRQb3NzaWJsZVpJbmRleCAtIGN1cnJlbnRaSW5kZXggPiAxKSkge1xuICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsIFwiei1pbmRleFwiLCB0aGlzLnNlcnZpY2UubmV4dFpJbmRleCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgc2V0SW5pdGlhbE9mZnNldCgpIHtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUgIT09ICdtYXhpbWl6ZWQnKSB7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUFsbE9mZnNldCgpO1xuICAgICAgICAgICAgaWYgKCFpc1ByZXNlbnQodGhpcy5sZWZ0KSB8fCAhaXNQcmVzZW50KHRoaXMudG9wKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2VydmljZS5jZW50ZXIoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IHZpZXdQb3J0ID0gdGhpcy5zZXJ2aWNlLndpbmRvd1ZpZXdQb3J0O1xuICAgICAgICAgICAgdGhpcy5zZXRTdHlsZSgnd2lkdGgnLCB2aWV3UG9ydC53aWR0aCk7XG4gICAgICAgICAgICB0aGlzLnNldFN0eWxlKCdoZWlnaHQnLCB2aWV3UG9ydC5oZWlnaHQpO1xuICAgICAgICAgICAgdGhpcy5zZXRTdHlsZSgndG9wJywgMCk7XG4gICAgICAgICAgICB0aGlzLnNldFN0eWxlKCdsZWZ0JywgMCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgdXBkYXRlQWxsT2Zmc2V0KCkge1xuICAgICAgICBPRkZTRVRfU1RZTEVTLmZvckVhY2goKHN0eWxlJCQxKSA9PiB7XG4gICAgICAgICAgICBpZiAoaXNQcmVzZW50KHRoaXNbc3R5bGUkJDFdKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0U3R5bGUoc3R5bGUkJDEsIHRoaXNbc3R5bGUkJDFdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlU3R5bGUoc3R5bGUkJDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgc2V0U3R5bGUoc3R5bGUkJDEsIHZhbHVlKSB7XG4gICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5lbC5uYXRpdmVFbGVtZW50LCBzdHlsZSQkMSwgdmFsdWUgKyAncHgnKTtcbiAgICB9XG4gICAgcmVtb3ZlU3R5bGUoc3R5bGUkJDEpIHtcbiAgICAgICAgdGhpcy5yZW5kZXJlci5yZW1vdmVTdHlsZSh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsIHN0eWxlJCQxKTtcbiAgICB9XG4gICAgZ2V0IG9wdGlvbnMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNlcnZpY2Uub3B0aW9ucztcbiAgICB9XG4gICAgc2V0T3B0aW9uKHN0eWxlJCQxLCB2YWx1ZSkge1xuICAgICAgICBpZiAodHlwZW9mIHZhbHVlICE9PSAnbnVtYmVyJyAmJiB0eXBlb2YgdmFsdWUgIT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcGFyc2VkVmFsdWUgPSAodHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJykgPyB2YWx1ZSA6IHBhcnNlSW50KHZhbHVlLCAxMCk7XG4gICAgICAgIHRoaXMub3B0aW9uc1tzdHlsZSQkMV0gPSBwYXJzZWRWYWx1ZTtcbiAgICAgICAgdGhpcy5zZXJ2aWNlLnNldFJlc3RvcmVPcHRpb24oc3R5bGUkJDEsIHBhcnNlZFZhbHVlKTtcbiAgICB9XG4gICAgaGFuZGxlSW5pdGlhbEZvY3VzKCkge1xuICAgICAgICBjb25zdCB3cmFwcGVyID0gdGhpcy5lbC5uYXRpdmVFbGVtZW50O1xuICAgICAgICBpZiAodGhpcy5hdXRvRm9jdXNlZEVsZW1lbnQpIHtcbiAgICAgICAgICAgIGNvbnN0IGluaXRpYWxseUZvY3VzZWRFbGVtZW50ID0gd3JhcHBlci5xdWVyeVNlbGVjdG9yKHRoaXMuYXV0b0ZvY3VzZWRFbGVtZW50KTtcbiAgICAgICAgICAgIGlmIChpbml0aWFsbHlGb2N1c2VkRWxlbWVudCkge1xuICAgICAgICAgICAgICAgIGluaXRpYWxseUZvY3VzZWRFbGVtZW50LmZvY3VzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmZvY3VzKCk7XG4gICAgICAgIH1cbiAgICB9XG59O1xuX19kZWNvcmF0ZShbXG4gICAgSW5wdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgU3RyaW5nKVxuXSwgV2luZG93Q29tcG9uZW50LnByb3RvdHlwZSwgXCJhdXRvRm9jdXNlZEVsZW1lbnRcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIElucHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIFN0cmluZylcbl0sIFdpbmRvd0NvbXBvbmVudC5wcm90b3R5cGUsIFwidGl0bGVcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIElucHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIEJvb2xlYW4pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbQm9vbGVhbl0pXG5dLCBXaW5kb3dDb21wb25lbnQucHJvdG90eXBlLCBcImRyYWdnYWJsZVwiLCBudWxsKTtcbl9fZGVjb3JhdGUoW1xuICAgIElucHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIEJvb2xlYW4pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbQm9vbGVhbl0pXG5dLCBXaW5kb3dDb21wb25lbnQucHJvdG90eXBlLCBcInJlc2l6YWJsZVwiLCBudWxsKTtcbl9fZGVjb3JhdGUoW1xuICAgIElucHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIEJvb2xlYW4pXG5dLCBXaW5kb3dDb21wb25lbnQucHJvdG90eXBlLCBcImtlZXBDb250ZW50XCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBTdHJpbmcpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbU3RyaW5nXSlcbl0sIFdpbmRvd0NvbXBvbmVudC5wcm90b3R5cGUsIFwic3RhdGVcIiwgbnVsbCk7XG5fX2RlY29yYXRlKFtcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBOdW1iZXIpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbTnVtYmVyXSlcbl0sIFdpbmRvd0NvbXBvbmVudC5wcm90b3R5cGUsIFwibWluV2lkdGhcIiwgbnVsbCk7XG5fX2RlY29yYXRlKFtcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBOdW1iZXIpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbTnVtYmVyXSlcbl0sIFdpbmRvd0NvbXBvbmVudC5wcm90b3R5cGUsIFwibWluSGVpZ2h0XCIsIG51bGwpO1xuX19kZWNvcmF0ZShbXG4gICAgSW5wdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgTnVtYmVyKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW051bWJlcl0pXG5dLCBXaW5kb3dDb21wb25lbnQucHJvdG90eXBlLCBcIndpZHRoXCIsIG51bGwpO1xuX19kZWNvcmF0ZShbXG4gICAgSW5wdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgTnVtYmVyKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW051bWJlcl0pXG5dLCBXaW5kb3dDb21wb25lbnQucHJvdG90eXBlLCBcImhlaWdodFwiLCBudWxsKTtcbl9fZGVjb3JhdGUoW1xuICAgIElucHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIE51bWJlciksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtOdW1iZXJdKVxuXSwgV2luZG93Q29tcG9uZW50LnByb3RvdHlwZSwgXCJ0b3BcIiwgbnVsbCk7XG5fX2RlY29yYXRlKFtcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBOdW1iZXIpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbTnVtYmVyXSlcbl0sIFdpbmRvd0NvbXBvbmVudC5wcm90b3R5cGUsIFwibGVmdFwiLCBudWxsKTtcbl9fZGVjb3JhdGUoW1xuICAgIE91dHB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBFdmVudEVtaXR0ZXIpXG5dLCBXaW5kb3dDb21wb25lbnQucHJvdG90eXBlLCBcImRyYWdTdGFydFwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgT3V0cHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIEV2ZW50RW1pdHRlcilcbl0sIFdpbmRvd0NvbXBvbmVudC5wcm90b3R5cGUsIFwiZHJhZ0VuZFwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgT3V0cHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIEV2ZW50RW1pdHRlcilcbl0sIFdpbmRvd0NvbXBvbmVudC5wcm90b3R5cGUsIFwicmVzaXplU3RhcnRcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIE91dHB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBFdmVudEVtaXR0ZXIpXG5dLCBXaW5kb3dDb21wb25lbnQucHJvdG90eXBlLCBcInJlc2l6ZUVuZFwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgT3V0cHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIEV2ZW50RW1pdHRlcilcbl0sIFdpbmRvd0NvbXBvbmVudC5wcm90b3R5cGUsIFwiY2xvc2VcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIE91dHB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBFdmVudEVtaXR0ZXIpXG5dLCBXaW5kb3dDb21wb25lbnQucHJvdG90eXBlLCBcIndpZHRoQ2hhbmdlXCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBPdXRwdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgRXZlbnRFbWl0dGVyKVxuXSwgV2luZG93Q29tcG9uZW50LnByb3RvdHlwZSwgXCJoZWlnaHRDaGFuZ2VcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIE91dHB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBFdmVudEVtaXR0ZXIpXG5dLCBXaW5kb3dDb21wb25lbnQucHJvdG90eXBlLCBcInRvcENoYW5nZVwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgT3V0cHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIEV2ZW50RW1pdHRlcilcbl0sIFdpbmRvd0NvbXBvbmVudC5wcm90b3R5cGUsIFwibGVmdENoYW5nZVwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgT3V0cHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIEV2ZW50RW1pdHRlcilcbl0sIFdpbmRvd0NvbXBvbmVudC5wcm90b3R5cGUsIFwic3RhdGVDaGFuZ2VcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIEhvc3RCaW5kaW5nKCdhdHRyLnRhYkluZGV4JyksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIE51bWJlcilcbl0sIFdpbmRvd0NvbXBvbmVudC5wcm90b3R5cGUsIFwidGFiSW5kZXhcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIEhvc3RCaW5kaW5nKCdjbGFzcy5rLXdpZGdldCcpLFxuICAgIEhvc3RCaW5kaW5nKCdjbGFzcy5rLXdpbmRvdycpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBCb29sZWFuKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW10pXG5dLCBXaW5kb3dDb21wb25lbnQucHJvdG90eXBlLCBcImhvc3RDbGFzc2VzXCIsIG51bGwpO1xuX19kZWNvcmF0ZShbXG4gICAgSG9zdEJpbmRpbmcoJ2F0dHIuZGlyJyksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIFN0cmluZyksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtdKVxuXSwgV2luZG93Q29tcG9uZW50LnByb3RvdHlwZSwgXCJkaXJcIiwgbnVsbCk7XG5fX2RlY29yYXRlKFtcbiAgICBWaWV3Q2hpbGQoV2luZG93VGl0bGVCYXJDb21wb25lbnQsIHsgc3RhdGljOiBmYWxzZSB9KSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgV2luZG93VGl0bGVCYXJDb21wb25lbnQpXG5dLCBXaW5kb3dDb21wb25lbnQucHJvdG90eXBlLCBcInRpdGxlQmFyVmlld1wiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgQ29udGVudENoaWxkKFdpbmRvd1RpdGxlQmFyQ29tcG9uZW50LCB7IHN0YXRpYzogZmFsc2UgfSksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIFdpbmRvd1RpdGxlQmFyQ29tcG9uZW50KVxuXSwgV2luZG93Q29tcG9uZW50LnByb3RvdHlwZSwgXCJ0aXRsZUJhckNvbnRlbnRcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIFZpZXdDaGlsZHJlbihSZXNpemVIYW5kbGVEaXJlY3RpdmUpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBRdWVyeUxpc3QpXG5dLCBXaW5kb3dDb21wb25lbnQucHJvdG90eXBlLCBcInJlc2l6ZUhhbmRsZXNcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIEhvc3RCaW5kaW5nKCdzdHlsZS5taW5XaWR0aCcpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBTdHJpbmcpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbXSlcbl0sIFdpbmRvd0NvbXBvbmVudC5wcm90b3R5cGUsIFwic3R5bGVNaW5XaWR0aFwiLCBudWxsKTtcbl9fZGVjb3JhdGUoW1xuICAgIEhvc3RCaW5kaW5nKCdzdHlsZS5taW5IZWlnaHQnKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgU3RyaW5nKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW10pXG5dLCBXaW5kb3dDb21wb25lbnQucHJvdG90eXBlLCBcInN0eWxlTWluSGVpZ2h0XCIsIG51bGwpO1xuX19kZWNvcmF0ZShbXG4gICAgSG9zdEJpbmRpbmcoJ3N0eWxlLnBvc2l0aW9uJyksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIFN0cmluZyksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtdKVxuXSwgV2luZG93Q29tcG9uZW50LnByb3RvdHlwZSwgXCJzdHlsZVBvc2l0aW9uXCIsIG51bGwpO1xuX19kZWNvcmF0ZShbXG4gICAgSG9zdEJpbmRpbmcoJ2NsYXNzLmstd2luZG93LW1heGltaXplZCcpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBCb29sZWFuKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW10pXG5dLCBXaW5kb3dDb21wb25lbnQucHJvdG90eXBlLCBcIndyYXBwZXJNYXhpbWl6ZWRDbGFzc1wiLCBudWxsKTtcbl9fZGVjb3JhdGUoW1xuICAgIEhvc3RCaW5kaW5nKCdjbGFzcy5rLXdpbmRvdy1taW5pbWl6ZWQnKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgQm9vbGVhbiksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtdKVxuXSwgV2luZG93Q29tcG9uZW50LnByb3RvdHlwZSwgXCJ3cmFwcGVyTWluaW1pemVkQ2xhc3NcIiwgbnVsbCk7XG5fX2RlY29yYXRlKFtcbiAgICBIb3N0TGlzdGVuZXIoJ2tleWRvd24nLCBbJyRldmVudCddKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgRnVuY3Rpb24pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbT2JqZWN0XSksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpyZXR1cm50eXBlXCIsIHZvaWQgMClcbl0sIFdpbmRvd0NvbXBvbmVudC5wcm90b3R5cGUsIFwib25Db21wb25lbnRLZXlkb3duXCIsIG51bGwpO1xuX19kZWNvcmF0ZShbXG4gICAgSG9zdExpc3RlbmVyKCdmb2N1cycpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBGdW5jdGlvbiksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtdKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnJldHVybnR5cGVcIiwgdm9pZCAwKVxuXSwgV2luZG93Q29tcG9uZW50LnByb3RvdHlwZSwgXCJvbkNvbXBvbmVudEZvY3VzXCIsIG51bGwpO1xuX19kZWNvcmF0ZShbXG4gICAgSG9zdExpc3RlbmVyKCdibHVyJyksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIEZ1bmN0aW9uKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW10pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cmV0dXJudHlwZVwiLCB2b2lkIDApXG5dLCBXaW5kb3dDb21wb25lbnQucHJvdG90eXBlLCBcIm9uQ29tcG9uZW50Qmx1clwiLCBudWxsKTtcbldpbmRvd0NvbXBvbmVudCA9IF9fZGVjb3JhdGUoW1xuICAgIENvbXBvbmVudCh7XG4gICAgICAgIGV4cG9ydEFzOiAna2VuZG9XaW5kb3cnLFxuICAgICAgICBwcm92aWRlcnM6IFtcbiAgICAgICAgICAgIERyYWdSZXNpemVTZXJ2aWNlLFxuICAgICAgICAgICAgTmF2aWdhdGlvblNlcnZpY2UsXG4gICAgICAgICAgICBMb2NhbGl6YXRpb25TZXJ2aWNlLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHByb3ZpZGU6IEwxME5fUFJFRklYLFxuICAgICAgICAgICAgICAgIHVzZVZhbHVlOiAna2VuZG8ud2luZG93J1xuICAgICAgICAgICAgfVxuICAgICAgICBdLFxuICAgICAgICBzZWxlY3RvcjogJ2tlbmRvLXdpbmRvdycsXG4gICAgICAgIHRlbXBsYXRlOiBgXG4gICAgICAgIDxuZy1jb250YWluZXIga2VuZG9XaW5kb3dMb2NhbGl6ZWRNZXNzYWdlc1xuICAgICAgICAgICAgaTE4bi1jbG9zZVRpdGxlPVwia2VuZG8ud2luZG93LmNsb3NlVGl0bGV8VGhlIHRpdGxlIG9mIHRoZSBjbG9zZSBidXR0b25cIlxuICAgICAgICAgICAgY2xvc2VUaXRsZT1cIkNsb3NlXCJcblxuICAgICAgICAgICAgaTE4bi1yZXN0b3JlVGl0bGU9XCJrZW5kby53aW5kb3cucmVzdG9yZVRpdGxlfFRoZSB0aXRsZSBvZiB0aGUgcmVzdG9yZSBidXR0b25cIlxuICAgICAgICAgICAgcmVzdG9yZVRpdGxlPVwiUmVzdG9yZVwiXG5cbiAgICAgICAgICAgIGkxOG4tbWF4aW1pemVUaXRsZT1cImtlbmRvLndpbmRvdy5tYXhpbWl6ZVRpdGxlfFRoZSB0aXRsZSBvZiB0aGUgbWF4aW1pemUgYnV0dG9uXCJcbiAgICAgICAgICAgIG1heGltaXplVGl0bGU9XCJNYXhpbWl6ZVwiXG5cbiAgICAgICAgICAgIGkxOG4tbWluaW1pemVUaXRsZT1cImtlbmRvLndpbmRvdy5taW5pbWl6ZVRpdGxlfFRoZSB0aXRsZSBvZiB0aGUgbWluaW1pemUgYnV0dG9uXCJcbiAgICAgICAgICAgIG1pbmltaXplVGl0bGU9XCJNaW5pbWl6ZVwiXG4gICAgICAgID5cbiAgICAgICAgPG5nLWNvbnRhaW5lcj5cblxuICAgICAgICA8a2VuZG8td2luZG93LXRpdGxlYmFyICpuZ0lmPVwic2hvd0RlZmF1bHRUaXRsZUJhclwiIFt0ZW1wbGF0ZV09XCJ0aXRsZUJhclRlbXBsYXRlXCI+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiay13aW5kb3ctdGl0bGVcIj57eyB0aXRsZSB9fTwvZGl2PlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImstd2luZG93LWFjdGlvbnNcIj5cbiAgICAgICAgICAgICAgICA8YnV0dG9uIGtlbmRvV2luZG93TWluaW1pemVBY3Rpb24gIFthdHRyLnRpdGxlXT1cIm1pbmltaXplQnV0dG9uVGl0bGVcIiBbYXR0ci5hcmlhLWxhYmVsXT1cIm1pbmltaXplQnV0dG9uVGl0bGVcIj48L2J1dHRvbj5cbiAgICAgICAgICAgICAgICA8YnV0dG9uIGtlbmRvV2luZG93TWF4aW1pemVBY3Rpb24gW2F0dHIudGl0bGVdPVwibWF4aW1pemVCdXR0b25UaXRsZVwiIFthdHRyLmFyaWEtbGFiZWxdPVwibWF4aW1pemVCdXR0b25UaXRsZVwiPjwvYnV0dG9uPlxuICAgICAgICAgICAgICAgIDxidXR0b24ga2VuZG9XaW5kb3dSZXN0b3JlQWN0aW9uIFthdHRyLnRpdGxlXT1cInJlc3RvcmVCdXR0b25UaXRsZVwiIFthdHRyLmFyaWEtbGFiZWxdPVwicmVzdG9yZUJ1dHRvblRpdGxlXCI+PC9idXR0b24+XG4gICAgICAgICAgICAgICAgPGJ1dHRvbiBrZW5kb1dpbmRvd0Nsb3NlQWN0aW9uIFthdHRyLnRpdGxlXT1cImNsb3NlQnV0dG9uVGl0bGVcIiBbYXR0ci5hcmlhLWxhYmVsXT1cImNsb3NlQnV0dG9uVGl0bGVcIj48L2J1dHRvbj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2tlbmRvLXdpbmRvdy10aXRsZWJhcj5cbiAgICAgICAgPG5nLWNvbnRlbnQgc2VsZWN0PVwia2VuZG8td2luZG93LXRpdGxlYmFyXCIgKm5nSWY9XCIhc2hvd0RlZmF1bHRUaXRsZUJhclwiPjwvbmctY29udGVudD5cblxuICAgICAgICA8ZGl2ICpuZ0lmPVwic3RhdGUgIT09ICdtaW5pbWl6ZWQnIHx8IGtlZXBDb250ZW50XCJcbiAgICAgICAgICAgIFtoaWRkZW5dPVwic3RhdGUgPT09ICdtaW5pbWl6ZWQnICYmIGtlZXBDb250ZW50XCJcbiAgICAgICAgICAgIGNsYXNzPVwiay1jb250ZW50IGstd2luZG93LWNvbnRlbnRcIlxuICAgICAgICA+XG4gICAgICAgICAgICA8bmctY29udGVudCAqbmdJZj1cIiFjb250ZW50VGVtcGxhdGVcIj48L25nLWNvbnRlbnQ+XG4gICAgICAgICAgICA8bmctdGVtcGxhdGUgW25nVGVtcGxhdGVPdXRsZXRdPVwiY29udGVudFRlbXBsYXRlXCIgKm5nSWY9XCJjb250ZW50VGVtcGxhdGVcIj48L25nLXRlbXBsYXRlPlxuICAgICAgICA8L2Rpdj5cblxuICAgICAgICA8bmctdGVtcGxhdGUgW25nSWZdPSdyZXNpemFibGUnPlxuICAgICAgICAgICAgPGRpdiAqbmdGb3I9J2xldCBkaXIgb2YgcmVzaXplRGlyZWN0aW9ucydcbiAgICAgICAgICAgICAgICBbZGlyZWN0aW9uXT1cImRpclwiXG4gICAgICAgICAgICAgICAga2VuZG9XaW5kb3dSZXNpemVIYW5kbGVcbiAgICAgICAgICAgICAgICBrZW5kb0RyYWdnYWJsZT5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L25nLXRlbXBsYXRlPlxuICAgIGBcbiAgICB9KSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW0VsZW1lbnRSZWYsXG4gICAgICAgIFJlbmRlcmVyMixcbiAgICAgICAgRHJhZ1Jlc2l6ZVNlcnZpY2UsXG4gICAgICAgIE5hdmlnYXRpb25TZXJ2aWNlLFxuICAgICAgICBOZ1pvbmUsXG4gICAgICAgIExvY2FsaXphdGlvblNlcnZpY2VdKVxuXSwgV2luZG93Q29tcG9uZW50KTtcblxubGV0IFdpbmRvd01heGltaXplQWN0aW9uRGlyZWN0aXZlID0gY2xhc3MgV2luZG93TWF4aW1pemVBY3Rpb25EaXJlY3RpdmUgZXh0ZW5kcyBCdXR0b24ge1xuICAgIGNvbnN0cnVjdG9yKGVsLCByZW5kZXJlciwgX3NlcnZpY2UsIGxvY2FsaXphdGlvbiwgbmdab25lKSB7XG4gICAgICAgIHN1cGVyKGVsLCByZW5kZXJlciwgbnVsbCwgbG9jYWxpemF0aW9uLCBuZ1pvbmUpO1xuICAgICAgICB0aGlzLmJ1dHRvblR5cGUgPSAnYnV0dG9uJztcbiAgICAgICAgdGhpcy53aW5kb3cgPSBfc2VydmljZTtcbiAgICAgICAgdGhpcy5sb29rID0gJ2JhcmUnO1xuICAgICAgICB0aGlzLmljb24gPSAnd2luZG93LW1heGltaXplJztcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIG9uQ2xpY2soKSB7XG4gICAgICAgIGlmICghdGhpcy5pc0Rpc2FibGVkKSB7XG4gICAgICAgICAgICB0aGlzLndpbmRvdy5tYXhpbWl6ZUFjdGlvbigpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCB2aXNpYmxlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy53aW5kb3cub3B0aW9ucy5zdGF0ZSA9PT0gJ2RlZmF1bHQnID8gJ2lubGluZS1mbGV4JyA6ICdub25lJztcbiAgICB9XG59O1xuX19kZWNvcmF0ZShbXG4gICAgSW5wdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgT2JqZWN0KVxuXSwgV2luZG93TWF4aW1pemVBY3Rpb25EaXJlY3RpdmUucHJvdG90eXBlLCBcIndpbmRvd1wiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgSG9zdEJpbmRpbmcoJ2F0dHIudHlwZScpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBTdHJpbmcpXG5dLCBXaW5kb3dNYXhpbWl6ZUFjdGlvbkRpcmVjdGl2ZS5wcm90b3R5cGUsIFwiYnV0dG9uVHlwZVwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgSG9zdExpc3RlbmVyKCdjbGljaycpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBGdW5jdGlvbiksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtdKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnJldHVybnR5cGVcIiwgdm9pZCAwKVxuXSwgV2luZG93TWF4aW1pemVBY3Rpb25EaXJlY3RpdmUucHJvdG90eXBlLCBcIm9uQ2xpY2tcIiwgbnVsbCk7XG5fX2RlY29yYXRlKFtcbiAgICBIb3N0QmluZGluZygnc3R5bGUuZGlzcGxheScpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBTdHJpbmcpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbXSlcbl0sIFdpbmRvd01heGltaXplQWN0aW9uRGlyZWN0aXZlLnByb3RvdHlwZSwgXCJ2aXNpYmxlXCIsIG51bGwpO1xuV2luZG93TWF4aW1pemVBY3Rpb25EaXJlY3RpdmUgPSBfX2RlY29yYXRlKFtcbiAgICBEaXJlY3RpdmUoe1xuICAgICAgICBleHBvcnRBczogJ2tlbmRvV2luZG93TWF4aW1pemVBY3Rpb24nLFxuICAgICAgICBwcm92aWRlcnM6IFtcbiAgICAgICAgICAgIExvY2FsaXphdGlvblNlcnZpY2UsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgcHJvdmlkZTogTDEwTl9QUkVGSVgsXG4gICAgICAgICAgICAgICAgdXNlVmFsdWU6ICdrZW5kby5idXR0b24nXG4gICAgICAgICAgICB9XG4gICAgICAgIF0sXG4gICAgICAgIHNlbGVjdG9yOiAnYnV0dG9uW2tlbmRvV2luZG93TWF4aW1pemVBY3Rpb25dJyAvLyB0c2xpbnQ6ZGlzYWJsZS1saW5lXG4gICAgfSksXG4gICAgX19wYXJhbSgyLCBPcHRpb25hbCgpKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW0VsZW1lbnRSZWYsXG4gICAgICAgIFJlbmRlcmVyMixcbiAgICAgICAgRHJhZ1Jlc2l6ZVNlcnZpY2UsXG4gICAgICAgIExvY2FsaXphdGlvblNlcnZpY2UsXG4gICAgICAgIE5nWm9uZV0pXG5dLCBXaW5kb3dNYXhpbWl6ZUFjdGlvbkRpcmVjdGl2ZSk7XG5cbmxldCBXaW5kb3dNaW5pbWl6ZUFjdGlvbkRpcmVjdGl2ZSA9IGNsYXNzIFdpbmRvd01pbmltaXplQWN0aW9uRGlyZWN0aXZlIGV4dGVuZHMgQnV0dG9uIHtcbiAgICBjb25zdHJ1Y3RvcihlbCwgcmVuZGVyZXIsIF9zZXJ2aWNlLCBsb2NhbGl6YXRpb24sIG5nWm9uZSkge1xuICAgICAgICBzdXBlcihlbCwgcmVuZGVyZXIsIG51bGwsIGxvY2FsaXphdGlvbiwgbmdab25lKTtcbiAgICAgICAgdGhpcy5idXR0b25UeXBlID0gJ2J1dHRvbic7XG4gICAgICAgIHRoaXMud2luZG93ID0gX3NlcnZpY2U7XG4gICAgICAgIHRoaXMubG9vayA9ICdiYXJlJztcbiAgICAgICAgdGhpcy5pY29uID0gJ3dpbmRvdy1taW5pbWl6ZSc7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBvbkNsaWNrKCkge1xuICAgICAgICBpZiAoIXRoaXMuaXNEaXNhYmxlZCkge1xuICAgICAgICAgICAgdGhpcy53aW5kb3cubWluaW1pemVBY3Rpb24oKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgdmlzaWJsZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMud2luZG93Lm9wdGlvbnMuc3RhdGUgPT09ICdkZWZhdWx0JyA/ICdpbmxpbmUtZmxleCcgOiAnbm9uZSc7XG4gICAgfVxufTtcbl9fZGVjb3JhdGUoW1xuICAgIElucHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIE9iamVjdClcbl0sIFdpbmRvd01pbmltaXplQWN0aW9uRGlyZWN0aXZlLnByb3RvdHlwZSwgXCJ3aW5kb3dcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIEhvc3RCaW5kaW5nKCdhdHRyLnR5cGUnKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgU3RyaW5nKVxuXSwgV2luZG93TWluaW1pemVBY3Rpb25EaXJlY3RpdmUucHJvdG90eXBlLCBcImJ1dHRvblR5cGVcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIEhvc3RMaXN0ZW5lcignY2xpY2snKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgRnVuY3Rpb24pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbXSksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpyZXR1cm50eXBlXCIsIHZvaWQgMClcbl0sIFdpbmRvd01pbmltaXplQWN0aW9uRGlyZWN0aXZlLnByb3RvdHlwZSwgXCJvbkNsaWNrXCIsIG51bGwpO1xuX19kZWNvcmF0ZShbXG4gICAgSG9zdEJpbmRpbmcoJ3N0eWxlLmRpc3BsYXknKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgU3RyaW5nKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW10pXG5dLCBXaW5kb3dNaW5pbWl6ZUFjdGlvbkRpcmVjdGl2ZS5wcm90b3R5cGUsIFwidmlzaWJsZVwiLCBudWxsKTtcbldpbmRvd01pbmltaXplQWN0aW9uRGlyZWN0aXZlID0gX19kZWNvcmF0ZShbXG4gICAgRGlyZWN0aXZlKHtcbiAgICAgICAgZXhwb3J0QXM6ICdrZW5kb1dpbmRvd01pbmltaXplQWN0aW9uJyxcbiAgICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgICAgICBMb2NhbGl6YXRpb25TZXJ2aWNlLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHByb3ZpZGU6IEwxME5fUFJFRklYLFxuICAgICAgICAgICAgICAgIHVzZVZhbHVlOiAna2VuZG8uYnV0dG9uJ1xuICAgICAgICAgICAgfVxuICAgICAgICBdLFxuICAgICAgICBzZWxlY3RvcjogJ2J1dHRvbltrZW5kb1dpbmRvd01pbmltaXplQWN0aW9uXScgLy8gdHNsaW50OmRpc2FibGUtbGluZVxuICAgIH0pLFxuICAgIF9fcGFyYW0oMiwgT3B0aW9uYWwoKSksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtFbGVtZW50UmVmLFxuICAgICAgICBSZW5kZXJlcjIsXG4gICAgICAgIERyYWdSZXNpemVTZXJ2aWNlLFxuICAgICAgICBMb2NhbGl6YXRpb25TZXJ2aWNlLFxuICAgICAgICBOZ1pvbmVdKVxuXSwgV2luZG93TWluaW1pemVBY3Rpb25EaXJlY3RpdmUpO1xuXG5sZXQgV2luZG93Q2xvc2VBY3Rpb25EaXJlY3RpdmUgPSBjbGFzcyBXaW5kb3dDbG9zZUFjdGlvbkRpcmVjdGl2ZSBleHRlbmRzIEJ1dHRvbiB7XG4gICAgY29uc3RydWN0b3IoZWwsIHJlbmRlcmVyLCBfc2VydmljZSwgbG9jYWxpemF0aW9uLCBuZ1pvbmUpIHtcbiAgICAgICAgc3VwZXIoZWwsIHJlbmRlcmVyLCBudWxsLCBsb2NhbGl6YXRpb24sIG5nWm9uZSk7XG4gICAgICAgIHRoaXMuYnV0dG9uVHlwZSA9ICdidXR0b24nO1xuICAgICAgICB0aGlzLndpbmRvdyA9IF9zZXJ2aWNlO1xuICAgICAgICB0aGlzLmxvb2sgPSAnYmFyZSc7XG4gICAgICAgIHRoaXMuaWNvbiA9ICdjbG9zZSc7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBvbkNsaWNrKCkge1xuICAgICAgICBpZiAoIXRoaXMuaXNEaXNhYmxlZCkge1xuICAgICAgICAgICAgdGhpcy53aW5kb3cuY2xvc2VBY3Rpb24oKTtcbiAgICAgICAgfVxuICAgIH1cbn07XG5fX2RlY29yYXRlKFtcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBPYmplY3QpXG5dLCBXaW5kb3dDbG9zZUFjdGlvbkRpcmVjdGl2ZS5wcm90b3R5cGUsIFwid2luZG93XCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBIb3N0QmluZGluZygnYXR0ci50eXBlJyksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIFN0cmluZylcbl0sIFdpbmRvd0Nsb3NlQWN0aW9uRGlyZWN0aXZlLnByb3RvdHlwZSwgXCJidXR0b25UeXBlXCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBIb3N0TGlzdGVuZXIoJ2NsaWNrJyksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIEZ1bmN0aW9uKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW10pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cmV0dXJudHlwZVwiLCB2b2lkIDApXG5dLCBXaW5kb3dDbG9zZUFjdGlvbkRpcmVjdGl2ZS5wcm90b3R5cGUsIFwib25DbGlja1wiLCBudWxsKTtcbldpbmRvd0Nsb3NlQWN0aW9uRGlyZWN0aXZlID0gX19kZWNvcmF0ZShbXG4gICAgRGlyZWN0aXZlKHtcbiAgICAgICAgZXhwb3J0QXM6ICdrZW5kb1dpbmRvd0Nsb3NlQWN0aW9uJyxcbiAgICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgICAgICBMb2NhbGl6YXRpb25TZXJ2aWNlLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHByb3ZpZGU6IEwxME5fUFJFRklYLFxuICAgICAgICAgICAgICAgIHVzZVZhbHVlOiAna2VuZG8uYnV0dG9uJ1xuICAgICAgICAgICAgfVxuICAgICAgICBdLFxuICAgICAgICBzZWxlY3RvcjogJ2J1dHRvbltrZW5kb1dpbmRvd0Nsb3NlQWN0aW9uXScgLy8gdHNsaW50OmRpc2FibGUtbGluZVxuICAgIH0pLFxuICAgIF9fcGFyYW0oMiwgT3B0aW9uYWwoKSksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtFbGVtZW50UmVmLFxuICAgICAgICBSZW5kZXJlcjIsXG4gICAgICAgIERyYWdSZXNpemVTZXJ2aWNlLFxuICAgICAgICBMb2NhbGl6YXRpb25TZXJ2aWNlLFxuICAgICAgICBOZ1pvbmVdKVxuXSwgV2luZG93Q2xvc2VBY3Rpb25EaXJlY3RpdmUpO1xuXG5sZXQgV2luZG93UmVzdG9yZUFjdGlvbkRpcmVjdGl2ZSA9IGNsYXNzIFdpbmRvd1Jlc3RvcmVBY3Rpb25EaXJlY3RpdmUgZXh0ZW5kcyBCdXR0b24ge1xuICAgIGNvbnN0cnVjdG9yKGVsLCByZW5kZXJlciwgX3NlcnZpY2UsIGxvY2FsaXphdGlvbiwgbmdab25lKSB7XG4gICAgICAgIHN1cGVyKGVsLCByZW5kZXJlciwgbnVsbCwgbG9jYWxpemF0aW9uLCBuZ1pvbmUpO1xuICAgICAgICB0aGlzLmJ1dHRvblR5cGUgPSAnYnV0dG9uJztcbiAgICAgICAgdGhpcy53aW5kb3cgPSBfc2VydmljZTtcbiAgICAgICAgdGhpcy5sb29rID0gJ2JhcmUnO1xuICAgICAgICB0aGlzLmljb24gPSAnd2luZG93LXJlc3RvcmUnO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgb25DbGljaygpIHtcbiAgICAgICAgaWYgKCF0aGlzLmlzRGlzYWJsZWQpIHtcbiAgICAgICAgICAgIHRoaXMud2luZG93LnJlc3RvcmVBY3Rpb24oKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgdmlzaWJsZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMud2luZG93Lm9wdGlvbnMuc3RhdGUgPT09ICdkZWZhdWx0JyA/ICdub25lJyA6ICdpbmxpbmUtZmxleCc7XG4gICAgfVxufTtcbl9fZGVjb3JhdGUoW1xuICAgIElucHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIE9iamVjdClcbl0sIFdpbmRvd1Jlc3RvcmVBY3Rpb25EaXJlY3RpdmUucHJvdG90eXBlLCBcIndpbmRvd1wiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgSG9zdEJpbmRpbmcoJ2F0dHIudHlwZScpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBTdHJpbmcpXG5dLCBXaW5kb3dSZXN0b3JlQWN0aW9uRGlyZWN0aXZlLnByb3RvdHlwZSwgXCJidXR0b25UeXBlXCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBIb3N0TGlzdGVuZXIoJ2NsaWNrJyksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIEZ1bmN0aW9uKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW10pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cmV0dXJudHlwZVwiLCB2b2lkIDApXG5dLCBXaW5kb3dSZXN0b3JlQWN0aW9uRGlyZWN0aXZlLnByb3RvdHlwZSwgXCJvbkNsaWNrXCIsIG51bGwpO1xuX19kZWNvcmF0ZShbXG4gICAgSG9zdEJpbmRpbmcoJ3N0eWxlLmRpc3BsYXknKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgU3RyaW5nKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW10pXG5dLCBXaW5kb3dSZXN0b3JlQWN0aW9uRGlyZWN0aXZlLnByb3RvdHlwZSwgXCJ2aXNpYmxlXCIsIG51bGwpO1xuV2luZG93UmVzdG9yZUFjdGlvbkRpcmVjdGl2ZSA9IF9fZGVjb3JhdGUoW1xuICAgIERpcmVjdGl2ZSh7XG4gICAgICAgIGV4cG9ydEFzOiAna2VuZG9XaW5kb3dSZXN0b3JlQWN0aW9uJyxcbiAgICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgICAgICBMb2NhbGl6YXRpb25TZXJ2aWNlLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHByb3ZpZGU6IEwxME5fUFJFRklYLFxuICAgICAgICAgICAgICAgIHVzZVZhbHVlOiAna2VuZG8uYnV0dG9uJ1xuICAgICAgICAgICAgfVxuICAgICAgICBdLFxuICAgICAgICBzZWxlY3RvcjogJ2J1dHRvbltrZW5kb1dpbmRvd1Jlc3RvcmVBY3Rpb25dJyAvLyB0c2xpbnQ6ZGlzYWJsZS1saW5lXG4gICAgfSksXG4gICAgX19wYXJhbSgyLCBPcHRpb25hbCgpKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW0VsZW1lbnRSZWYsXG4gICAgICAgIFJlbmRlcmVyMixcbiAgICAgICAgRHJhZ1Jlc2l6ZVNlcnZpY2UsXG4gICAgICAgIExvY2FsaXphdGlvblNlcnZpY2UsXG4gICAgICAgIE5nWm9uZV0pXG5dLCBXaW5kb3dSZXN0b3JlQWN0aW9uRGlyZWN0aXZlKTtcblxuLyoqXG4gKiBUaGUgc2V0dGluZ3MgZm9yIHRoZSBXaW5kb3cgYWN0aW9ucyB3aGVuIHRoZSBXaW5kb3cgaXMgb3BlbmVkIHRocm91Z2ggYFdpbmRvd1NlcnZpY2VgXG4gKiAoW3NlZSBleGFtcGxlXSh7JSBzbHVnIGFwaV9kaWFsb2dfd2luZG93c2VydmljZSAlfSN0b2Mtb3BlbikpLlxuICovXG5jbGFzcyBXaW5kb3dTZXR0aW5ncyB7XG59XG4vKipcbiAqIEluZGljYXRlcyB0aGF0IHRoZSAqKkNsb3NlKiogYnV0dG9uIG9mIGEgV2luZG93IHRoYXQgaXMgb3BlbmVkIHRocm91Z2ggYFdpbmRvd1NlcnZpY2VgIGlzIGNsaWNrZWQuXG4gKi9cbmNsYXNzIFdpbmRvd0Nsb3NlUmVzdWx0IHtcbn1cbi8qKlxuICogSG9sZHMgcmVmZXJlbmNlcyB0byB0aGUgb2JqZWN0IGluc3RhbmNlIG9mIHRoZSBXaW5kb3cuXG4gKiBDb250cm9scyB0aGUgV2luZG93cyB0aGF0IHdlcmUgb3BlbmVkIHRocm91Z2ggYFdpbmRvd1NlcnZpY2VgXG4gKiAoW3NlZSBleGFtcGxlXSh7JSBzbHVnIGFwaV9kaWFsb2dfd2luZG93c2VydmljZSAlfSN0b2Mtb3BlbikpLlxuICovXG5jbGFzcyBXaW5kb3dSZWYge1xufVxuXG52YXIgV2luZG93Q29udGFpbmVyU2VydmljZV8xO1xuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmxldCBXaW5kb3dDb250YWluZXJTZXJ2aWNlID0gV2luZG93Q29udGFpbmVyU2VydmljZV8xID0gY2xhc3MgV2luZG93Q29udGFpbmVyU2VydmljZSB7XG4gICAgc2V0IGNvbnRhaW5lcihjb250YWluZXIpIHtcbiAgICAgICAgV2luZG93Q29udGFpbmVyU2VydmljZV8xLmNvbnRhaW5lciA9IGNvbnRhaW5lcjtcbiAgICB9XG4gICAgZ2V0IGNvbnRhaW5lcigpIHtcbiAgICAgICAgcmV0dXJuIFdpbmRvd0NvbnRhaW5lclNlcnZpY2VfMS5jb250YWluZXI7XG4gICAgfVxufTtcbldpbmRvd0NvbnRhaW5lclNlcnZpY2UuY29udGFpbmVyID0gbnVsbDtcbldpbmRvd0NvbnRhaW5lclNlcnZpY2UgPSBXaW5kb3dDb250YWluZXJTZXJ2aWNlXzEgPSBfX2RlY29yYXRlKFtcbiAgICBJbmplY3RhYmxlKClcbl0sIFdpbmRvd0NvbnRhaW5lclNlcnZpY2UpO1xuXG5jb25zdCBpc05vdENvbXBvbmVudCQxID0gKGNvbXBvbmVudCkgPT4gaXNTdHJpbmcoY29tcG9uZW50KSB8fCBjb21wb25lbnQgaW5zdGFuY2VvZiBUZW1wbGF0ZVJlZjtcbmNsYXNzIFdpbmRvd0luamVjdG9yIHtcbiAgICBjb25zdHJ1Y3RvcihnZXRXaW5kb3dSZWYsIHBhcmVudEluamVjdG9yKSB7XG4gICAgICAgIHRoaXMuZ2V0V2luZG93UmVmID0gZ2V0V2luZG93UmVmO1xuICAgICAgICB0aGlzLnBhcmVudEluamVjdG9yID0gcGFyZW50SW5qZWN0b3I7XG4gICAgfVxuICAgIGdldCh0b2tlbiwgbm90Rm91bmRWYWx1ZSkge1xuICAgICAgICBpZiAodG9rZW4gPT09IFdpbmRvd1JlZikge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0V2luZG93UmVmKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMucGFyZW50SW5qZWN0b3IuZ2V0KHRva2VuLCBub3RGb3VuZFZhbHVlKTtcbiAgICB9XG59XG4vKipcbiAqIEEgc2VydmljZSBmb3Igb3BlbmluZyBXaW5kb3dzIGR5bmFtaWNhbGx5XG4gKiAoW3NlZSBleGFtcGxlXSh7JSBzbHVnIHNlcnZpY2Vfd2luZG93ICV9KSkuXG4gKi9cbmxldCBXaW5kb3dTZXJ2aWNlID0gY2xhc3MgV2luZG93U2VydmljZSB7XG4gICAgY29uc3RydWN0b3IoXG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIHJlc29sdmVyLCBjb250YWluZXJTZXJ2aWNlKSB7XG4gICAgICAgIHRoaXMucmVzb2x2ZXIgPSByZXNvbHZlcjtcbiAgICAgICAgdGhpcy5jb250YWluZXJTZXJ2aWNlID0gY29udGFpbmVyU2VydmljZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogT3BlbnMgYSBXaW5kb3cgY29tcG9uZW50LlxuICAgICAqXG4gICAgICogQHBhcmFtIHtXaW5kb3dTZXR0aW5nc30gc2V0dGluZ3MgLSBUaGUgc2V0dGluZ3MgdGhhdCBkZWZpbmUgdGhlIFdpbmRvdy5cbiAgICAgKiBAcmV0dXJucyB7V2luZG93UmVmfSAtIEEgcmVmZXJlbmNlIHRvIHRoZSBXaW5kb3cgb2JqZWN0LlxuICAgICAqXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIGBgYHRzLW5vLXJ1blxuICAgICAqIF9AQ29tcG9uZW50KHtcbiAgICAgKiAgIHNlbGVjdG9yOiAnbXktYXBwJyxcbiAgICAgKiAgIHRlbXBsYXRlOiBgXG4gICAgICogICAgIDxidXR0b24ga2VuZG9CdXR0b24gKGNsaWNrKT1cIm9wZW4oKVwiPk9wZW4gd2luZG93PC9idXR0b24+XG4gICAgICogICAgIDxkaXYga2VuZG9XaW5kb3dDb250YWluZXI+PC9kaXY+XG4gICAgICogICBgXG4gICAgICogfSlcbiAgICAgKiBleHBvcnQgY2xhc3MgQXBwQ29tcG9uZW50IHtcbiAgICAgKiAgICAgY29uc3RydWN0b3IoIHByaXZhdGUgd2luZG93U2VydmljZTogV2luZG93U2VydmljZSApIHt9XG4gICAgICpcbiAgICAgKiAgICAgcHVibGljIG9wZW4oKSB7XG4gICAgICogICAgICAgICB2YXIgd2luZG93ID0gdGhpcy53aW5kb3dTZXJ2aWNlLm9wZW4oe1xuICAgICAqICAgICAgICAgICB0aXRsZTogXCJNeSB3aW5kb3dcIixcbiAgICAgKiAgICAgICAgICAgY29udGVudDogXCJNeSBjb250ZW50IVwiXG4gICAgICogICAgICAgICB9KTtcbiAgICAgKlxuICAgICAqICAgICAgICAgd2luZG93LnJlc3VsdC5zdWJzY3JpYmUoKHJlc3VsdCkgPT4ge1xuICAgICAqICAgICAgICAgICBpZiAocmVzdWx0IGluc3RhbmNlb2YgV2luZG93Q2xvc2VSZXN1bHQpIHtcbiAgICAgKiAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIldpbmRvdyB3YXMgY2xvc2VkXCIpO1xuICAgICAqICAgICAgICAgICB9XG4gICAgICogICAgICAgICB9KTtcbiAgICAgKiAgICAgfVxuICAgICAqIH1cbiAgICAgKiBgYGBcbiAgICAgKlxuICAgICAqL1xuICAgIG9wZW4oc2V0dGluZ3MpIHtcbiAgICAgICAgY29uc3QgZmFjdG9yeSA9IHRoaXMucmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoV2luZG93Q29tcG9uZW50KTtcbiAgICAgICAgY29uc3QgY29udGFpbmVyID0gc2V0dGluZ3MuYXBwZW5kVG8gfHwgdGhpcy5jb250YWluZXJTZXJ2aWNlLmNvbnRhaW5lcjtcbiAgICAgICAgaWYgKCFjb250YWluZXIpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IGF0dGFjaCB3aW5kb3cgdG8gdGhlIHBhZ2UuXG4gICAgICAgICAgICAgICAgQWRkIGFuIGVsZW1lbnQgdGhhdCB1c2VzIHRoZSBrZW5kb1dpbmRvd0NvbnRhaW5lciBkaXJlY3RpdmUsIG9yIHNldCB0aGUgJ2FwcGVuZFRvJyBwcm9wZXJ0eS5cbiAgICAgICAgICAgICAgICBTZWUgaHR0cHM6Ly93d3cudGVsZXJpay5jb20va2VuZG8tYW5ndWxhci11aS9jb21wb25lbnRzL2RpYWxvZ3Mvd2luZG93L3NlcnZpY2UvXG4gICAgICAgICAgICBgKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB3aW5kb3dSZWYgPSB7XG4gICAgICAgICAgICBjbG9zZTogKCkgPT4geyB9LFxuICAgICAgICAgICAgY29udGVudDogbnVsbCxcbiAgICAgICAgICAgIHJlc3VsdDogbnVsbCxcbiAgICAgICAgICAgIHdpbmRvdzogbnVsbFxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBjb250ZW50ID0gdGhpcy5jb250ZW50RnJvbShzZXR0aW5ncy5jb250ZW50LCBjb250YWluZXIsIHdpbmRvd1JlZik7XG4gICAgICAgIGNvbnN0IHdpbmRvdyA9IGNvbnRhaW5lci5jcmVhdGVDb21wb25lbnQoZmFjdG9yeSwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIGNvbnRlbnQubm9kZXMpO1xuICAgICAgICB3aW5kb3dSZWYud2luZG93ID0gd2luZG93O1xuICAgICAgICB0aGlzLmFwcGx5T3B0aW9ucyh3aW5kb3cuaW5zdGFuY2UsIHNldHRpbmdzKTtcbiAgICAgICAgY29uc3QgYXBpQ2xvc2UgPSBuZXcgU3ViamVjdCgpO1xuICAgICAgICBjb25zdCBjbG9zZSA9IChlKSA9PiB7XG4gICAgICAgICAgICBhcGlDbG9zZS5uZXh0KGUgfHwgbmV3IFdpbmRvd0Nsb3NlUmVzdWx0KCkpO1xuICAgICAgICAgICAgaWYgKGNvbnRlbnQuY29tcG9uZW50UmVmKSB7XG4gICAgICAgICAgICAgICAgY29udGVudC5jb21wb25lbnRSZWYuZGVzdHJveSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgd2luZG93LmRlc3Ryb3koKTtcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gbWVyZ2UoYXBpQ2xvc2UsIHdpbmRvdy5pbnN0YW5jZS5jbG9zZS5waXBlKG1hcChlID0+IChlID8gZSA6IG5ldyBXaW5kb3dDbG9zZVJlc3VsdCgpKSksIGZpbHRlcigoZSkgPT4ge1xuICAgICAgICAgICAgaWYgKHNldHRpbmdzLnByZXZlbnRDbG9zZSkge1xuICAgICAgICAgICAgICAgIC8vIGFkZCB3aW5kb3dSZWYgb25seSB3aGVuIHVzaW5nIGNvbXBvbmVudFxuICAgICAgICAgICAgICAgIGNvbnN0IHdpbmRvd1JlZlBhcmFtZXRlciA9IGlzTm90Q29tcG9uZW50JDEoc2V0dGluZ3MuY29udGVudCkgPyB1bmRlZmluZWQgOiB3aW5kb3dSZWY7XG4gICAgICAgICAgICAgICAgcmV0dXJuICFzZXR0aW5ncy5wcmV2ZW50Q2xvc2UoZSwgd2luZG93UmVmUGFyYW1ldGVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9KSkpLnBpcGUodGFrZSgxKSwgXG4gICAgICAgIC8vIFRha2VzIGNhcmUgZm9yIG11bHRpcGxlIHN1YnNjcmlwdGlvbnM6XG4gICAgICAgIC8vIFdlIHN1YnNjcmliZSBpbnRlcm5hbGx5IGFuZCB0aGUgdXNlciBtYXkgc3Vic2NyaWJlIHRvIGdldCBhIGNsb3NlIHJlc3VsdCAtIHdpbmRvdy5yZXN1bHQuc3Vic2NyaWJlKCkuXG4gICAgICAgIC8vIFRoaXMgY2F1c2VzIG11bHRpcGxlIHN1YnNjcmlwdGlvbnMgdG8gdGhlIHNhbWUgc291cmNlIGFuZCB0aHVzIG11bHRpcGxlIGVtaXNzaW9ucy4gc2hhcmUoKSBzb2x2ZXMgdGhhdC5cbiAgICAgICAgc2hhcmUoKSk7XG4gICAgICAgIHJlc3VsdC5zdWJzY3JpYmUoY2xvc2UpO1xuICAgICAgICB3aW5kb3dSZWYuY2xvc2UgPSBjbG9zZTtcbiAgICAgICAgd2luZG93UmVmLnJlc3VsdCA9IHJlc3VsdDtcbiAgICAgICAgd2luZG93LmNoYW5nZURldGVjdG9yUmVmLm1hcmtGb3JDaGVjaygpO1xuICAgICAgICByZXR1cm4gd2luZG93UmVmO1xuICAgIH1cbiAgICBhcHBseU9wdGlvbnMoaW5zdGFuY2UsIG9wdGlvbnMpIHtcbiAgICAgICAgaWYgKGlzUHJlc2VudChvcHRpb25zLnRpdGxlKSkge1xuICAgICAgICAgICAgaW5zdGFuY2UudGl0bGUgPSBvcHRpb25zLnRpdGxlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpc1ByZXNlbnQob3B0aW9ucy5rZWVwQ29udGVudCkpIHtcbiAgICAgICAgICAgIGluc3RhbmNlLmtlZXBDb250ZW50ID0gb3B0aW9ucy5rZWVwQ29udGVudDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNQcmVzZW50KG9wdGlvbnMud2lkdGgpKSB7XG4gICAgICAgICAgICBpbnN0YW5jZS53aWR0aCA9IG9wdGlvbnMud2lkdGg7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzUHJlc2VudChvcHRpb25zLm1pbldpZHRoKSkge1xuICAgICAgICAgICAgaW5zdGFuY2UubWluV2lkdGggPSBvcHRpb25zLm1pbldpZHRoO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpc1ByZXNlbnQob3B0aW9ucy5oZWlnaHQpKSB7XG4gICAgICAgICAgICBpbnN0YW5jZS5oZWlnaHQgPSBvcHRpb25zLmhlaWdodDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNQcmVzZW50KG9wdGlvbnMubWluSGVpZ2h0KSkge1xuICAgICAgICAgICAgaW5zdGFuY2UubWluSGVpZ2h0ID0gb3B0aW9ucy5taW5IZWlnaHQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzUHJlc2VudChvcHRpb25zLmxlZnQpKSB7XG4gICAgICAgICAgICBpbnN0YW5jZS5sZWZ0ID0gb3B0aW9ucy5sZWZ0O1xuICAgICAgICB9XG4gICAgICAgIGlmIChpc1ByZXNlbnQob3B0aW9ucy50b3ApKSB7XG4gICAgICAgICAgICBpbnN0YW5jZS50b3AgPSBvcHRpb25zLnRvcDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNQcmVzZW50KG9wdGlvbnMuZHJhZ2dhYmxlKSkge1xuICAgICAgICAgICAgaW5zdGFuY2UuZHJhZ2dhYmxlID0gb3B0aW9ucy5kcmFnZ2FibGU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzUHJlc2VudChvcHRpb25zLnJlc2l6YWJsZSkpIHtcbiAgICAgICAgICAgIGluc3RhbmNlLnJlc2l6YWJsZSA9IG9wdGlvbnMucmVzaXphYmxlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpc1ByZXNlbnQob3B0aW9ucy5tZXNzYWdlcyAmJiBvcHRpb25zLm1lc3NhZ2VzLmNsb3NlVGl0bGUpKSB7XG4gICAgICAgICAgICBpbnN0YW5jZS5tZXNzYWdlcy5jbG9zZVRpdGxlID0gb3B0aW9ucy5tZXNzYWdlcy5jbG9zZVRpdGxlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpc1ByZXNlbnQob3B0aW9ucy5tZXNzYWdlcyAmJiBvcHRpb25zLm1lc3NhZ2VzLnJlc3RvcmVUaXRsZSkpIHtcbiAgICAgICAgICAgIGluc3RhbmNlLm1lc3NhZ2VzLnJlc3RvcmVUaXRsZSA9IG9wdGlvbnMubWVzc2FnZXMucmVzdG9yZVRpdGxlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpc1ByZXNlbnQob3B0aW9ucy5tZXNzYWdlcyAmJiBvcHRpb25zLm1lc3NhZ2VzLm1heGltaXplVGl0bGUpKSB7XG4gICAgICAgICAgICBpbnN0YW5jZS5tZXNzYWdlcy5tYXhpbWl6ZVRpdGxlID0gb3B0aW9ucy5tZXNzYWdlcy5tYXhpbWl6ZVRpdGxlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpc1ByZXNlbnQob3B0aW9ucy5tZXNzYWdlcyAmJiBvcHRpb25zLm1lc3NhZ2VzLm1pbmltaXplVGl0bGUpKSB7XG4gICAgICAgICAgICBpbnN0YW5jZS5tZXNzYWdlcy5taW5pbWl6ZVRpdGxlID0gb3B0aW9ucy5tZXNzYWdlcy5taW5pbWl6ZVRpdGxlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpc1ByZXNlbnQob3B0aW9ucy5hdXRvRm9jdXNlZEVsZW1lbnQpKSB7XG4gICAgICAgICAgICBpbnN0YW5jZS5hdXRvRm9jdXNlZEVsZW1lbnQgPSBvcHRpb25zLmF1dG9Gb2N1c2VkRWxlbWVudDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNQcmVzZW50KG9wdGlvbnMuc3RhdGUpKSB7XG4gICAgICAgICAgICBpbnN0YW5jZS5zdGF0ZSA9IG9wdGlvbnMuc3RhdGU7XG4gICAgICAgICAgICBpZiAob3B0aW9ucy5zdGF0ZSA9PT0gJ21pbmltaXplZCcpIHtcbiAgICAgICAgICAgICAgICBpbnN0YW5jZS5rZWVwQ29udGVudCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wdGlvbnMuY29udGVudCBpbnN0YW5jZW9mIFRlbXBsYXRlUmVmKSB7XG4gICAgICAgICAgICBpbnN0YW5jZS5jb250ZW50VGVtcGxhdGUgPSBvcHRpb25zLmNvbnRlbnQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wdGlvbnMudGl0bGVCYXJDb250ZW50IGluc3RhbmNlb2YgVGVtcGxhdGVSZWYpIHtcbiAgICAgICAgICAgIGluc3RhbmNlLnRpdGxlQmFyVGVtcGxhdGUgPSBvcHRpb25zLnRpdGxlQmFyQ29udGVudDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb250ZW50RnJvbShjb250ZW50LCBjb250YWluZXIsIHdpbmRvd1JlZikge1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGNvbnRhaW5lci5pbmplY3Rvci5nZXQoUmVuZGVyZXIyKTtcbiAgICAgICAgbGV0IG5vZGVzID0gW107XG4gICAgICAgIGxldCBjb21wb25lbnRSZWYgPSBudWxsO1xuICAgICAgICBpZiAodHlwZW9mIGNvbnRlbnQgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICBub2RlcyA9IFtyZW5kZXJlci5jcmVhdGVUZXh0KGNvbnRlbnQpXTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjb250ZW50ICYmICEoY29udGVudCBpbnN0YW5jZW9mIFRlbXBsYXRlUmVmKSkge1xuICAgICAgICAgICAgY29uc3QgaW5qZWN0b3IgPSBuZXcgV2luZG93SW5qZWN0b3IoKCkgPT4gd2luZG93UmVmLCBjb250YWluZXIuaW5qZWN0b3IpO1xuICAgICAgICAgICAgY29uc3QgZmFjdG9yeSA9IHRoaXMucmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoY29udGVudCk7XG4gICAgICAgICAgICBjb21wb25lbnRSZWYgPSBjb250YWluZXIuY3JlYXRlQ29tcG9uZW50KGZhY3RvcnksIHVuZGVmaW5lZCwgaW5qZWN0b3IpO1xuICAgICAgICAgICAgbm9kZXMgPSBbY29tcG9uZW50UmVmLmxvY2F0aW9uLm5hdGl2ZUVsZW1lbnRdO1xuICAgICAgICAgICAgd2luZG93UmVmLmNvbnRlbnQgPSBjb21wb25lbnRSZWY7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGNvbXBvbmVudFJlZixcbiAgICAgICAgICAgIG5vZGVzOiBbXG4gICAgICAgICAgICAgICAgW10sXG4gICAgICAgICAgICAgICAgbm9kZXMgLy8gQ29udGVudFxuICAgICAgICAgICAgXVxuICAgICAgICB9O1xuICAgIH1cbn07XG5XaW5kb3dTZXJ2aWNlID0gX19kZWNvcmF0ZShbXG4gICAgSW5qZWN0YWJsZSgpLFxuICAgIF9fcGFyYW0oMSwgSW5qZWN0KFdpbmRvd0NvbnRhaW5lclNlcnZpY2UpKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW0NvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcbiAgICAgICAgV2luZG93Q29udGFpbmVyU2VydmljZV0pXG5dLCBXaW5kb3dTZXJ2aWNlKTtcblxuLyoqXG4gKiBQcm92aWRlcyBhbiBpbnNlcnRpb24gcG9pbnQgZm9yIHRoZSBEaWFsb2dzIHdoaWNoIGFyZSBjcmVhdGVkIHRocm91Z2ggdGhlXG4gKiBEaWFsb2cgc2VydmljZSAoW3NlZSBleGFtcGxlXSh7JSBzbHVnIGFwaV9kaWFsb2dfZGlhbG9nc2VydmljZSAlfSN0b2Mtb3BlbikpLlxuICogQ3JlYXRlZCBEaWFsb2dzIHdpbGwgYmUgbW91bnRlZCBhZnRlciB0aGF0IGVsZW1lbnQuXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYGh0bWwtbm8tcnVuXG4gKiA8ZGl2IGtlbmRvRGlhbG9nQ29udGFpbmVyPjwvZGl2PlxuICogYGBgXG4gKi9cbmxldCBEaWFsb2dDb250YWluZXJEaXJlY3RpdmUgPSBjbGFzcyBEaWFsb2dDb250YWluZXJEaXJlY3RpdmUge1xuICAgIGNvbnN0cnVjdG9yKGNvbnRhaW5lciwgc2VydmljZSkge1xuICAgICAgICBzZXJ2aWNlLmNvbnRhaW5lciA9IGNvbnRhaW5lcjtcbiAgICB9XG59O1xuRGlhbG9nQ29udGFpbmVyRGlyZWN0aXZlID0gX19kZWNvcmF0ZShbXG4gICAgRGlyZWN0aXZlKHtcbiAgICAgICAgc2VsZWN0b3I6ICdba2VuZG9EaWFsb2dDb250YWluZXJdJ1xuICAgIH0pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbVmlld0NvbnRhaW5lclJlZixcbiAgICAgICAgRGlhbG9nQ29udGFpbmVyU2VydmljZV0pXG5dLCBEaWFsb2dDb250YWluZXJEaXJlY3RpdmUpO1xuXG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY2xhc3MgTWVzc2FnZXMgZXh0ZW5kcyBDb21wb25lbnRNZXNzYWdlcyB7XG59XG5fX2RlY29yYXRlKFtcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBTdHJpbmcpXG5dLCBNZXNzYWdlcy5wcm90b3R5cGUsIFwiY2xvc2VUaXRsZVwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgSW5wdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgU3RyaW5nKVxuXSwgTWVzc2FnZXMucHJvdG90eXBlLCBcInJlc3RvcmVUaXRsZVwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgSW5wdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgU3RyaW5nKVxuXSwgTWVzc2FnZXMucHJvdG90eXBlLCBcIm1heGltaXplVGl0bGVcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIElucHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIFN0cmluZylcbl0sIE1lc3NhZ2VzLnByb3RvdHlwZSwgXCJtaW5pbWl6ZVRpdGxlXCIsIHZvaWQgMCk7XG5cbnZhciBMb2NhbGl6ZWRNZXNzYWdlc0RpcmVjdGl2ZV8xO1xuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmxldCBMb2NhbGl6ZWRNZXNzYWdlc0RpcmVjdGl2ZSA9IExvY2FsaXplZE1lc3NhZ2VzRGlyZWN0aXZlXzEgPSBjbGFzcyBMb2NhbGl6ZWRNZXNzYWdlc0RpcmVjdGl2ZSBleHRlbmRzIE1lc3NhZ2VzIHtcbiAgICBjb25zdHJ1Y3RvcihzZXJ2aWNlKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMuc2VydmljZSA9IHNlcnZpY2U7XG4gICAgfVxufTtcbkxvY2FsaXplZE1lc3NhZ2VzRGlyZWN0aXZlID0gTG9jYWxpemVkTWVzc2FnZXNEaXJlY3RpdmVfMSA9IF9fZGVjb3JhdGUoW1xuICAgIERpcmVjdGl2ZSh7XG4gICAgICAgIHByb3ZpZGVyczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHByb3ZpZGU6IE1lc3NhZ2VzLFxuICAgICAgICAgICAgICAgIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IExvY2FsaXplZE1lc3NhZ2VzRGlyZWN0aXZlXzEpXG4gICAgICAgICAgICB9XG4gICAgICAgIF0sXG4gICAgICAgIHNlbGVjdG9yOiBgXG4gICAgW2tlbmRvRGlhbG9nTG9jYWxpemVkTWVzc2FnZXNdLFxuICAgIFtrZW5kb1dpbmRvd0xvY2FsaXplZE1lc3NhZ2VzXSxcbiAgICBba2VuZG9EaWFsb2dUaXRsZUJhckxvY2FsaXplZE1lc3NhZ2VzXVxuICBgXG4gICAgfSksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtMb2NhbGl6YXRpb25TZXJ2aWNlXSlcbl0sIExvY2FsaXplZE1lc3NhZ2VzRGlyZWN0aXZlKTtcblxudmFyIEN1c3RvbU1lc3NhZ2VzQ29tcG9uZW50XzE7XG4vKipcbiAqIEN1c3RvbSBjb21wb25lbnQgbWVzc2FnZXMgb3ZlcnJpZGUgZGVmYXVsdCBjb21wb25lbnQgbWVzc2FnZXNcbiAqIChbc2VlIGV4YW1wbGVdKHslIHNsdWcgZ2xvYmFsaXphdGlvbl9kaWFsb2dzICV9I3RvYy1sb2NhbGl6YXRpb24pKS5cbiAqL1xubGV0IEN1c3RvbU1lc3NhZ2VzQ29tcG9uZW50ID0gQ3VzdG9tTWVzc2FnZXNDb21wb25lbnRfMSA9IGNsYXNzIEN1c3RvbU1lc3NhZ2VzQ29tcG9uZW50IGV4dGVuZHMgTWVzc2FnZXMge1xuICAgIGNvbnN0cnVjdG9yKHNlcnZpY2UpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5zZXJ2aWNlID0gc2VydmljZTtcbiAgICB9XG4gICAgZ2V0IG92ZXJyaWRlKCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG59O1xuQ3VzdG9tTWVzc2FnZXNDb21wb25lbnQgPSBDdXN0b21NZXNzYWdlc0NvbXBvbmVudF8xID0gX19kZWNvcmF0ZShbXG4gICAgQ29tcG9uZW50KHtcbiAgICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgcHJvdmlkZTogTWVzc2FnZXMsXG4gICAgICAgICAgICAgICAgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gQ3VzdG9tTWVzc2FnZXNDb21wb25lbnRfMSkgLy8gdHNsaW50OmRpc2FibGUtbGluZTpuby1mb3J3YXJkLXJlZlxuICAgICAgICAgICAgfVxuICAgICAgICBdLFxuICAgICAgICBzZWxlY3RvcjogJ2tlbmRvLWRpYWxvZy1tZXNzYWdlcywga2VuZG8td2luZG93LW1lc3NhZ2VzJyxcbiAgICAgICAgdGVtcGxhdGU6IGBgXG4gICAgfSksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtMb2NhbGl6YXRpb25TZXJ2aWNlXSlcbl0sIEN1c3RvbU1lc3NhZ2VzQ29tcG9uZW50KTtcblxuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmNvbnN0IFNIQVJFRF9ESVJFQ1RJVkVTID0gW1xuICAgIERpYWxvZ0FjdGlvbnNDb21wb25lbnQsXG4gICAgQ3VzdG9tTWVzc2FnZXNDb21wb25lbnQsXG4gICAgTG9jYWxpemVkTWVzc2FnZXNEaXJlY3RpdmVcbl07XG4vKipcbiAqIEBoaWRkZW5cbiAqL1xubGV0IFNoYXJlZE1vZHVsZSA9IGNsYXNzIFNoYXJlZE1vZHVsZSB7XG59O1xuU2hhcmVkTW9kdWxlID0gX19kZWNvcmF0ZShbXG4gICAgTmdNb2R1bGUoe1xuICAgICAgICBkZWNsYXJhdGlvbnM6IFtTSEFSRURfRElSRUNUSVZFU10sXG4gICAgICAgIGV4cG9ydHM6IFtTSEFSRURfRElSRUNUSVZFUywgQ29tbW9uTW9kdWxlXSxcbiAgICAgICAgaW1wb3J0czogW0NvbW1vbk1vZHVsZV1cbiAgICB9KVxuXSwgU2hhcmVkTW9kdWxlKTtcblxuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmNvbnN0IERJQUxPR19ESVJFQ1RJVkVTID0gW1xuICAgIERpYWxvZ0NvbXBvbmVudCxcbiAgICBEaWFsb2dUaXRsZUJhckNvbXBvbmVudFxuXTtcbi8qKlxuICogUmVwcmVzZW50cyB0aGUgW05nTW9kdWxlXSh7eyBzaXRlLmRhdGEudXJscy5hbmd1bGFyWyduZ21vZHVsZWFwaSddIH19KVxuICogZGVmaW5pdGlvbiBmb3IgdGhlIERpYWxvZyBjb21wb25lbnQgdGhhdCBpbmNsdWRlcyBhbGwgRGlhbG9nIGNvbXBvbmVudHMgYW5kIGRpcmVjdGl2ZXMuXG4gKiBJbXBvcnRzIGBEaWFsb2dNb2R1bGVgIGludG8gdGhlIFtyb290IG1vZHVsZV0oe3sgc2l0ZS5kYXRhLnVybHMuYW5ndWxhclsnbmdtb2R1bGVzJ10gfX0jYW5ndWxhci1tb2R1bGFyaXR5KVxuICogb2YgeW91ciBhcHBsaWNhdGlvbiBvciBpbnRvIGFueSBvdGhlciBzdWItbW9kdWxlIHRoYXQgd2lsbCB1c2UgdGhlIERpYWxvZyBjb21wb25lbnQuXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYHRzLW5vLXJ1blxuICogaW1wb3J0IHsgTmdNb2R1bGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbiAqIGltcG9ydCB7IEJyb3dzZXJNb2R1bGUgfSBmcm9tICdAYW5ndWxhci9wbGF0Zm9ybS1icm93c2VyJztcbiAqIGltcG9ydCB7IERpYWxvZ01vZHVsZSB9IGZyb20gJ0Bwcm9ncmVzcy9rZW5kby1hbmd1bGFyLWRpYWxvZyc7XG4gKiBpbXBvcnQgeyBBcHBDb21wb25lbnQgfSBmcm9tICcuL2FwcC5jb21wb25lbnQnO1xuICpcbiAqIF9ATmdNb2R1bGUoe1xuICogICAgIGJvb3RzdHJhcDogICAgW0FwcENvbXBvbmVudF0sXG4gKiAgICAgZGVjbGFyYXRpb25zOiBbQXBwQ29tcG9uZW50XSxcbiAqICAgICBpbXBvcnRzOiAgICAgIFtCcm93c2VyTW9kdWxlLCBEaWFsb2dNb2R1bGVdXG4gKiB9KVxuICogZXhwb3J0IGNsYXNzIEFwcE1vZHVsZSB7XG4gKiB9XG4gKiBgYGBcbiAqL1xubGV0IERpYWxvZ01vZHVsZSA9IGNsYXNzIERpYWxvZ01vZHVsZSB7XG59O1xuRGlhbG9nTW9kdWxlID0gX19kZWNvcmF0ZShbXG4gICAgTmdNb2R1bGUoe1xuICAgICAgICBkZWNsYXJhdGlvbnM6IFtESUFMT0dfRElSRUNUSVZFUywgRGlhbG9nQ29udGFpbmVyRGlyZWN0aXZlXSxcbiAgICAgICAgZW50cnlDb21wb25lbnRzOiBbRElBTE9HX0RJUkVDVElWRVNdLFxuICAgICAgICBleHBvcnRzOiBbRElBTE9HX0RJUkVDVElWRVMsIFNIQVJFRF9ESVJFQ1RJVkVTLCBEaWFsb2dDb250YWluZXJEaXJlY3RpdmVdLFxuICAgICAgICBpbXBvcnRzOiBbU2hhcmVkTW9kdWxlXSxcbiAgICAgICAgcHJvdmlkZXJzOiBbRGlhbG9nQ29udGFpbmVyU2VydmljZSwgRGlhbG9nU2VydmljZV1cbiAgICB9KVxuXSwgRGlhbG9nTW9kdWxlKTtcblxuLyoqXG4gKiBQcm92aWRlcyBhbiBpbnNlcnRpb24gcG9pbnQgZm9yIHRoZSBXaW5kb3dzIHdoaWNoIGFyZSBjcmVhdGVkIHRocm91Z2ggdGhlXG4gKiBXaW5kb3cgc2VydmljZSAoW3NlZSBleGFtcGxlXSh7JSBzbHVnIGFwaV9kaWFsb2dfd2luZG93c2VydmljZSAlfSN0b2Mtb3BlbikpLlxuICogQ3JlYXRlZCBXaW5kb3dzIHdpbGwgYmUgbW91bnRlZCBhZnRlciB0aGF0IGVsZW1lbnQuXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYGh0bWwtbm8tcnVuXG4gKiA8ZGl2IGtlbmRvV2luZG93Q29udGFpbmVyPjwvZGl2PlxuICogYGBgXG4gKi9cbmxldCBXaW5kb3dDb250YWluZXJEaXJlY3RpdmUgPSBjbGFzcyBXaW5kb3dDb250YWluZXJEaXJlY3RpdmUge1xuICAgIGNvbnN0cnVjdG9yKGNvbnRhaW5lciwgc2VydmljZSkge1xuICAgICAgICBzZXJ2aWNlLmNvbnRhaW5lciA9IGNvbnRhaW5lcjtcbiAgICB9XG59O1xuV2luZG93Q29udGFpbmVyRGlyZWN0aXZlID0gX19kZWNvcmF0ZShbXG4gICAgRGlyZWN0aXZlKHtcbiAgICAgICAgc2VsZWN0b3I6ICdba2VuZG9XaW5kb3dDb250YWluZXJdJ1xuICAgIH0pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbVmlld0NvbnRhaW5lclJlZixcbiAgICAgICAgV2luZG93Q29udGFpbmVyU2VydmljZV0pXG5dLCBXaW5kb3dDb250YWluZXJEaXJlY3RpdmUpO1xuXG5jb25zdCBXSU5ET1dfRElSRUNUSVZFUyA9IFtcbiAgICBSZXNpemVIYW5kbGVEaXJlY3RpdmUsXG4gICAgV2luZG93Q29tcG9uZW50LFxuICAgIFdpbmRvd1RpdGxlQmFyQ29tcG9uZW50LFxuICAgIFdpbmRvd0Nsb3NlQWN0aW9uRGlyZWN0aXZlLFxuICAgIFdpbmRvd01pbmltaXplQWN0aW9uRGlyZWN0aXZlLFxuICAgIFdpbmRvd01heGltaXplQWN0aW9uRGlyZWN0aXZlLFxuICAgIFdpbmRvd1Jlc3RvcmVBY3Rpb25EaXJlY3RpdmVcbl07XG5jb25zdCBFTlRSWV9DT01QT05FTlRTID0gW1xuICAgIFdpbmRvd0NvbXBvbmVudCxcbiAgICBXaW5kb3dUaXRsZUJhckNvbXBvbmVudFxuXTtcbmNvbnN0IGV4cG9ydGVkTW9kdWxlcyA9IFtcbiAgICBXaW5kb3dDb21wb25lbnQsXG4gICAgV2luZG93Q2xvc2VBY3Rpb25EaXJlY3RpdmUsXG4gICAgV2luZG93TWluaW1pemVBY3Rpb25EaXJlY3RpdmUsXG4gICAgV2luZG93TWF4aW1pemVBY3Rpb25EaXJlY3RpdmUsXG4gICAgV2luZG93UmVzdG9yZUFjdGlvbkRpcmVjdGl2ZSxcbiAgICBXaW5kb3dUaXRsZUJhckNvbXBvbmVudFxuXTtcbi8qKlxuICogUmVwcmVzZW50cyB0aGUgW05nTW9kdWxlXSh7eyBzaXRlLmRhdGEudXJscy5hbmd1bGFyWyduZ21vZHVsZWFwaSddIH19KVxuICogZGVmaW5pdGlvbiBmb3IgdGhlIFdpbmRvdyBjb21wb25lbnQuIEltcG9ydHMgYFdpbmRvd01vZHVsZWAgaW50byB0aGVcbiAqIFtyb290IG1vZHVsZV0oe3sgc2l0ZS5kYXRhLnVybHMuYW5ndWxhclsnbmdtb2R1bGVzJ10gfX0jYW5ndWxhci1tb2R1bGFyaXR5KVxuICogb2YgeW91ciBhcHBsaWNhdGlvbiBvciBpbnRvIGFueSBvdGhlciBzdWItbW9kdWxlIHRoYXQgd2lsbCB1c2UgdGhlIFdpbmRvdyBjb21wb25lbnQuXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYHRzLW5vLXJ1blxuICogaW1wb3J0IHsgTmdNb2R1bGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbiAqIGltcG9ydCB7IEJyb3dzZXJNb2R1bGUgfSBmcm9tICdAYW5ndWxhci9wbGF0Zm9ybS1icm93c2VyJztcbiAqIGltcG9ydCB7IFdpbmRvd01vZHVsZSB9IGZyb20gJ0Bwcm9ncmVzcy9rZW5kby1hbmd1bGFyLXdpbmRvdyc7XG4gKiBpbXBvcnQgeyBBcHBDb21wb25lbnQgfSBmcm9tICcuL2FwcC5jb21wb25lbnQnO1xuICpcbiAqIF9ATmdNb2R1bGUoe1xuICogICAgIGJvb3RzdHJhcDogICAgW0FwcENvbXBvbmVudF0sXG4gKiAgICAgZGVjbGFyYXRpb25zOiBbQXBwQ29tcG9uZW50XSxcbiAqICAgICBpbXBvcnRzOiAgICAgIFtCcm93c2VyTW9kdWxlLCBXaW5kb3dNb2R1bGVdXG4gKiB9KVxuICogZXhwb3J0IGNsYXNzIEFwcE1vZHVsZSB7XG4gKiB9XG4gKiBgYGBcbiAqL1xubGV0IFdpbmRvd01vZHVsZSA9IGNsYXNzIFdpbmRvd01vZHVsZSB7XG59O1xuV2luZG93TW9kdWxlID0gX19kZWNvcmF0ZShbXG4gICAgTmdNb2R1bGUoe1xuICAgICAgICBkZWNsYXJhdGlvbnM6IFtXSU5ET1dfRElSRUNUSVZFUywgV2luZG93Q29udGFpbmVyRGlyZWN0aXZlXSxcbiAgICAgICAgZW50cnlDb21wb25lbnRzOiBbRU5UUllfQ09NUE9ORU5UU10sXG4gICAgICAgIGV4cG9ydHM6IFtleHBvcnRlZE1vZHVsZXMsIFNIQVJFRF9ESVJFQ1RJVkVTLCBXaW5kb3dDb250YWluZXJEaXJlY3RpdmVdLFxuICAgICAgICBpbXBvcnRzOiBbU2hhcmVkTW9kdWxlLCBEcmFnZ2FibGVNb2R1bGVdLFxuICAgICAgICBwcm92aWRlcnM6IFtXaW5kb3dDb250YWluZXJTZXJ2aWNlLCBXaW5kb3dTZXJ2aWNlXVxuICAgIH0pXG5dLCBXaW5kb3dNb2R1bGUpO1xuXG4vKipcbiAqIFJlcHJlc2VudHMgdGhlIFtOZ01vZHVsZV0oe3sgc2l0ZS5kYXRhLnVybHMuYW5ndWxhclsnbmdtb2R1bGVhcGknXSB9fSlcbiAqIGRlZmluaXRpb24gZm9yIHRoZSBEaWFsb2dzIGNvbXBvbmVudHMuXG4gKlxuICogQGV4YW1wbGVcbiAqXG4gKiBgYGB0cy1uby1ydW5cbiAqIGltcG9ydCB7IERpYWxvZ3NNb2R1bGUgfSBmcm9tICdAcHJvZ3Jlc3Mva2VuZG8tYW5ndWxhci1kaWFsb2cnO1xuICpcbiAqIGltcG9ydCB7IHBsYXRmb3JtQnJvd3NlckR5bmFtaWMgfSBmcm9tICdAYW5ndWxhci9wbGF0Zm9ybS1icm93c2VyLWR5bmFtaWMnO1xuICogaW1wb3J0IHsgTmdNb2R1bGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbiAqXG4gKiBpbXBvcnQgeyBBcHBDb21wb25lbnQgfSBmcm9tICcuL2FwcC5jb21wb25lbnQnO1xuICpcbiAqIF9ATmdNb2R1bGUoe1xuICogICAgIGRlY2xhcmF0aW9uczogW0FwcENvbXBvbmVudF0sXG4gKiAgICAgaW1wb3J0czogICAgICBbQnJvd3Nlck1vZHVsZSwgRGlhbG9nc01vZHVsZV0sXG4gKiAgICAgYm9vdHN0cmFwOiAgICBbQXBwQ29tcG9uZW50XVxuICogfSlcbiAqIGV4cG9ydCBjbGFzcyBBcHBNb2R1bGUge31cbiAqXG4gKiBwbGF0Zm9ybUJyb3dzZXJEeW5hbWljKCkuYm9vdHN0cmFwTW9kdWxlKEFwcE1vZHVsZSk7XG4gKlxuICogYGBgXG4gKi9cbmxldCBEaWFsb2dzTW9kdWxlID0gY2xhc3MgRGlhbG9nc01vZHVsZSB7XG59O1xuRGlhbG9nc01vZHVsZSA9IF9fZGVjb3JhdGUoW1xuICAgIE5nTW9kdWxlKHtcbiAgICAgICAgZXhwb3J0czogW0RpYWxvZ01vZHVsZSwgV2luZG93TW9kdWxlXVxuICAgIH0pXG5dLCBEaWFsb2dzTW9kdWxlKTtcblxuLyoqXG4gKiBHZW5lcmF0ZWQgYnVuZGxlIGluZGV4LiBEbyBub3QgZWRpdC5cbiAqL1xuXG5leHBvcnQgeyBESUFMT0dfRElSRUNUSVZFUywgRGlhbG9nQ29udGFpbmVyRGlyZWN0aXZlLCBEaWFsb2dDb250YWluZXJTZXJ2aWNlLCBDdXN0b21NZXNzYWdlc0NvbXBvbmVudCwgRElBTE9HX0xPQ0FMSVpBVElPTl9TRVJWSUNFLCBMb2NhbGl6ZWRNZXNzYWdlc0RpcmVjdGl2ZSwgTWVzc2FnZXMsIFRpdGxlQmFyTG9jYWxpemF0aW9uU2VydmljZSwgU0hBUkVEX0RJUkVDVElWRVMsIFNoYXJlZE1vZHVsZSwgRHJhZ1Jlc2l6ZVNlcnZpY2UsIE5hdmlnYXRpb25TZXJ2aWNlLCBXaW5kb3dDb250YWluZXJEaXJlY3RpdmUsIFdpbmRvd0NvbnRhaW5lclNlcnZpY2UsIFJlc2l6ZUhhbmRsZURpcmVjdGl2ZSwgRGlhbG9nQ29tcG9uZW50LCBEaWFsb2dUaXRsZUJhckNvbXBvbmVudCwgRGlhbG9nQ29udGVudEJhc2UsIERpYWxvZ0FjdGlvbnNDb21wb25lbnQsIERpYWxvZ1NlcnZpY2UsIERpYWxvZ0Nsb3NlUmVzdWx0LCBEaWFsb2dSZWYsIERpYWxvZ1NldHRpbmdzLCBEaWFsb2dBY3Rpb24sIFdpbmRvd0NvbXBvbmVudCwgV2luZG93VGl0bGVCYXJDb21wb25lbnQsIFdpbmRvd01heGltaXplQWN0aW9uRGlyZWN0aXZlLCBXaW5kb3dNaW5pbWl6ZUFjdGlvbkRpcmVjdGl2ZSwgV2luZG93Q2xvc2VBY3Rpb25EaXJlY3RpdmUsIFdpbmRvd1Jlc3RvcmVBY3Rpb25EaXJlY3RpdmUsIFdpbmRvd1NldHRpbmdzLCBXaW5kb3dSZWYsIFdpbmRvd0Nsb3NlUmVzdWx0LCBXaW5kb3dTZXJ2aWNlLCBEaWFsb2dNb2R1bGUsIFdpbmRvd01vZHVsZSwgRGlhbG9nc01vZHVsZSB9O1xuIl19